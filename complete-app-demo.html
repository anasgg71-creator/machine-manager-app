<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Manager - Complete App Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #f5f5f5;
            color: #231628;
        }

        .phone-container {
            max-width: 375px;
            margin: 20px auto;
            background: white;
            border-radius: 30px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-height: 700px;
            position: relative;
            overflow: hidden;
        }

        .demo-header {
            background: #6A57FF;
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .demo-header h1 {
            font-size: 18px;
            font-weight: 600;
        }

        .demo-header p {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .screen {
            display: none;
            animation: slideIn 0.3s ease-in-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Login Screen */
        .login-screen {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            min-height: 100vh;
            border-radius: 20px;
        }

        .logo-icon {
            width: 140px;
            height: 140px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.95);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            padding: 10px;
        }

        .app-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #ffffff;
            letter-spacing: 2px;
        }

        .app-subtitle {
            color: #FFD700;
            margin-bottom: 40px;
            font-size: 18px;
            font-weight: 500;
        }

        .input-field {
            background: #F5F5F5;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            text-align: left;
            border: none;
            width: 100%;
            font-size: 16px;
        }

        .login-button {
            background: #6A57FF;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 24px;
        }

        .demo-creds {
            background: #F5F5F5;
            border-radius: 12px;
            padding: 16px;
            margin-top: 32px;
            text-align: center;
        }

        .demo-creds h4 {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .demo-creds p {
            font-size: 14px;
            color: #898491;
            margin: 4px 0;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #E6E3EB;
            margin-bottom: 20px;
        }

        .back-button {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: #F5F5F5;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
        }

        .header-subtitle {
            font-size: 14px;
            color: #898491;
        }

        /* Rooms Grid */
        .rooms-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .room-card {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .room-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .room-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: #E3F2FD;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #2196F3;
        }

        .room-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .room-status {
            font-size: 12px;
            color: #4CAF50;
        }

        /* Navigation */
        .nav-item {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .nav-item-left {
            display: flex;
            align-items: center;
        }

        .nav-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: #E3F2FD;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
            color: #2196F3;
        }

        .nav-text h3 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .nav-text p {
            font-size: 14px;
            color: #898491;
        }

        /* History Items */
        .history-item {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .item-left {
            display: flex;
            flex: 1;
        }

        .type-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 16px;
        }

        .question-icon {
            background: #E3F2FD;
            color: #2196F3;
        }

        .problem-icon {
            background: #FFEBEE;
            color: #F44336;
        }

        .item-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .item-description {
            font-size: 14px;
            color: #898491;
            line-height: 1.4;
        }

        .item-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .tag {
            background: #F5F5F5;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-tag {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
        }

        .solved-tag {
            background: #E8F5E8;
            color: #4CAF50;
        }

        .unsolved-tag {
            background: #FFEBEE;
            color: #F44336;
        }

        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #898491;
        }

        /* Chat Modal */
        .chat-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ECE5DD;
            z-index: 1000;
            display: none;
            flex-direction: column;
        }

        .chat-modal.show {
            display: flex;
        }

        .chat-header {
            background: #075E54;
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header-left {
            display: flex;
            align-items: center;
        }

        .chat-back {
            margin-right: 12px;
            font-size: 20px;
            cursor: pointer;
        }

        .chat-info h3 {
            font-size: 16px;
            margin-bottom: 2px;
        }

        .chat-info p {
            font-size: 12px;
            color: #4CAF50;
        }

        .chat-actions {
            display: flex;
            gap: 8px;
        }

        .chat-action {
            padding: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            max-height: 400px;
        }

        .message {
            max-width: 75%;
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.own {
            background: #DCF8C6;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .message.other {
            background: white;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }

        .message-user {
            font-size: 12px;
            font-weight: 600;
            color: #075E54;
            margin-bottom: 2px;
        }

        .message-text {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 4px;
        }

        .message-time {
            font-size: 11px;
            color: #898491;
            text-align: right;
        }

        .chat-input {
            background: #F0F0F0;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-container {
            flex: 1;
            background: white;
            border-radius: 20px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
        }

        .input-container input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 14px;
        }

        .send-button {
            background: #25D366;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Chat Todos Styles */
        .chat-todos {
            background: #F8F9FF;
            border-bottom: 1px solid #E6E3EB;
            padding: 12px 16px;
            max-height: 200px;
            overflow-y: auto;
        }

        .todos-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .todos-header h4 {
            margin: 0;
            font-size: 14px;
            color: #333;
            font-weight: 600;
        }

        .add-todo-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .add-todo-btn:hover {
            background: #45a049;
        }

        .todos-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 6px;
            padding: 8px 10px;
            font-size: 13px;
        }

        .todo-item.completed {
            background: #F0F8F0;
            border-color: #4CAF50;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .todo-text {
            flex: 1;
            margin-right: 8px;
        }

        .todo-actions {
            display: flex;
            gap: 4px;
        }

        .todo-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 2px;
            font-size: 12px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .todo-action-btn:hover {
            opacity: 1;
        }

        .todo-action-btn.complete {
            color: #4CAF50;
        }

        .todo-action-btn.delete {
            color: #F44336;
        }

        .add-todo-form {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 6px;
            padding: 8px;
            margin-top: 8px;
        }

        .add-todo-form input {
            width: 100%;
            border: none;
            outline: none;
            font-size: 13px;
            padding: 4px 0;
            margin-bottom: 8px;
        }

        .todo-form-actions {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }

        .todo-form-actions button {
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .todo-form-actions button:first-child {
            background: #4CAF50;
            color: white;
        }

        .todo-form-actions button:last-child {
            background: #F5F5F5;
            color: #666;
        }

        /* Solver Modal Styles */
        .solver-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .solver-modal.show {
            display: flex;
        }

        .solver-modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .solver-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #E6E3EB;
        }

        .solver-header h3 {
            margin: 0;
            font-size: 18px;
            color: #231628;
        }

        .close-solver {
            font-size: 24px;
            cursor: pointer;
            color: #898491;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .close-solver:hover {
            background: #F5F5F5;
        }

        .solver-body {
            padding: 24px;
        }

        .solver-section {
            margin-bottom: 24px;
        }

        .solver-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #231628;
        }

        .solver-select {
            width: 100%;
            background: #F5F5F5;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 14px;
            color: #231628;
            cursor: pointer;
        }

        .solver-select:focus {
            outline: none;
            border-color: #6A57FF;
            box-shadow: 0 0 0 3px rgba(106, 87, 255, 0.1);
        }

        .star-rating {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }

        .star {
            font-size: 28px;
            color: #E6E3EB;
            cursor: pointer;
            transition: color 0.2s ease;
            user-select: none;
        }

        .star.active,
        .star:hover {
            color: #FFD700;
        }

        .rating-text {
            font-size: 14px;
            color: #898491;
        }

        .solver-comment {
            width: 100%;
            background: #F5F5F5;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 14px;
            color: #231628;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .solver-comment:focus {
            outline: none;
            border-color: #6A57FF;
            box-shadow: 0 0 0 3px rgba(106, 87, 255, 0.1);
        }

        .solver-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 32px;
        }

        .solver-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .solver-btn.cancel {
            background: #F5F5F5;
            color: #898491;
        }

        .solver-btn.cancel:hover {
            background: #E6E3EB;
        }

        .solver-btn.submit {
            background: #6A57FF;
            color: white;
        }

        .solver-btn.submit:hover {
            background: #5a47e6;
            transform: translateY(-1px);
        }

        .solver-btn.submit:disabled {
            background: #E6E3EB;
            color: #898491;
            cursor: not-allowed;
            transform: none;
        }

        .highlight {
            background: #FFE082 !important;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            border-left: 4px solid #FF9800;
        }

        .highlight h4 {
            color: #F57C00;
            margin-bottom: 8px;
        }

        /* Submission Form Styles */
        .submission-form {
            padding: 0 4px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #231628;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: #F5F5F5;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            color: #231628;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #6A57FF;
            background: white;
            box-shadow: 0 0 0 3px rgba(106, 87, 255, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .file-upload-area {
            border: 2px dashed #E6E3EB;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #FAFAFA;
        }

        .file-upload-area:hover {
            border-color: #6A57FF;
            background: #F8F7FF;
        }

        .file-upload-icon {
            font-size: 32px;
            margin-bottom: 12px;
            opacity: 0.6;
        }

        .file-upload-text p {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 4px;
            color: #231628;
        }

        .file-upload-text small {
            font-size: 12px;
            color: #898491;
        }

        .attached-files {
            margin-top: 12px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
        }

        .file-info {
            display: flex;
            align-items: center;
        }

        .file-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: #E3F2FD;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 16px;
            color: #2196F3;
        }

        .file-details h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .file-details p {
            font-size: 12px;
            color: #898491;
        }

        .file-remove {
            color: #F44336;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            padding-top: 20px;
            border-top: 1px solid #E6E3EB;
        }

        .btn-primary, .btn-secondary {
            flex: 1;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #6A57FF;
            color: white;
        }

        .btn-primary:hover {
            background: #5647E6;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #F5F5F5;
            color: #231628;
            border: 1px solid #E6E3EB;
        }

        .btn-secondary:hover {
            background: #EEEEEE;
            transform: translateY(-1px);
        }

        /* Fishbone Diagram Styles */
        .fishbone-section {
            background: linear-gradient(135deg, #F8F9FF 0%, #FFFFFF 100%);
            border: 2px solid #E3DCFF;
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
        }

        .fishbone-header .form-label {
            font-size: 16px;
            color: #6A57FF;
            margin-bottom: 4px;
        }

        .fishbone-diagram {
            margin: 24px 0;
            position: relative;
        }

        .fishbone-top-row, .fishbone-bottom-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }

        .fishbone-category {
            position: relative;
        }

        .category-bone {
            position: relative;
            margin-bottom: 8px;
        }

        .category-bone-top {
            text-align: center;
        }

        .category-bone-bottom {
            text-align: center;
            margin-top: 8px;
            margin-bottom: 0;
        }

        .bone-line {
            width: 80%;
            height: 2px;
            background: linear-gradient(90deg, #6A57FF 0%, #9C88FF 100%);
            margin: 8px auto;
            position: relative;
        }

        .category-bone-top .bone-line::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            width: 30px;
            height: 2px;
            background: linear-gradient(135deg, #6A57FF 0%, #9C88FF 100%);
            transform: rotate(45deg);
            transform-origin: right;
        }

        .category-bone-bottom .bone-line::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            width: 30px;
            height: 2px;
            background: linear-gradient(135deg, #6A57FF 0%, #9C88FF 100%);
            transform: rotate(-45deg);
            transform-origin: right;
        }

        .category-label {
            font-size: 12px;
            font-weight: 700;
            color: #6A57FF;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: white;
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
            border: 2px solid #6A57FF;
            box-shadow: 0 2px 8px rgba(106, 87, 255, 0.15);
        }

        .cause-items {
            background: white;
            border-radius: 12px;
            padding: 12px;
            border: 1px solid #E6E3EB;
        }

        .cause-checkbox {
            display: flex;
            align-items: center;
            padding: 8px;
            margin: 4px 0;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .cause-checkbox:hover {
            background: #F8F7FF;
        }

        .cause-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            cursor: pointer;
            accent-color: #6A57FF;
        }

        .cause-checkbox span {
            font-size: 13px;
            color: #231628;
        }

        .cause-checkbox input[type="checkbox"]:checked + span {
            color: #6A57FF;
            font-weight: 600;
        }

        .cause-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            font-size: 13px;
            margin-top: 8px;
            transition: all 0.2s ease;
        }

        .cause-input:focus {
            outline: none;
            border-color: #6A57FF;
            background: #F8F7FF;
        }

        .fishbone-spine {
            position: relative;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        .spine-line {
            flex: 1;
            height: 4px;
            background: linear-gradient(90deg, #6A57FF 0%, #9C88FF 100%);
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(106, 87, 255, 0.2);
        }

        .problem-effect {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #6A57FF 0%, #9C88FF 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 0 24px 24px 0;
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.3);
        }

        .effect-arrow {
            font-size: 20px;
        }

        .effect-label {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .fishbone-summary {
            background: white;
            border: 2px solid #6A57FF;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }

        /* Active Ticket Styles */
        .active-ticket {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .active-ticket:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .active-ticket.warning {
            border-left: 4px solid #FF9800;
            background: #FFF8E1;
        }

        .active-ticket.urgent {
            border-left: 4px solid #F44336;
            background: #FFEBEE;
        }

        .ticket-timer {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #E3F2FD;
            color: #1976D2;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .ticket-timer.warning {
            background: #FFF3E0;
            color: #F57C00;
        }

        .ticket-timer.urgent {
            background: #FFEBEE;
            color: #D32F2F;
        }

        .ticket-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #F0F0F0;
        }

        .ticket-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .ticket-btn.edit {
            background: #FFF3E0;
            color: #E65100;
        }

        .ticket-btn.edit:hover {
            background: #FFE0B2;
        }

        .ticket-btn.extend {
            background: #E3F2FD;
            color: #1976D2;
        }

        .ticket-btn.extend:hover {
            background: #BBDEFB;
        }

        .ticket-btn.close {
            background: #F5F5F5;
            color: #666;
        }

        .ticket-btn.close:hover {
            background: #EEEEEE;
        }

        .ticket-btn.solve {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .ticket-btn.solve:hover {
            background: #C8E6C9;
        }

        .ticket-btn.unsolve {
            background: #FFEBEE;
            color: #C62828;
        }

        .ticket-btn.unsolve:hover {
            background: #FFCDD2;
        }

        .creator-badge {
            background: #6A57FF;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }

        .updated-badge {
            background: #FF9800;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
            animation: pulseOrange 2s infinite;
        }

        @keyframes pulseOrange {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .warning-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #FF9800;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 2000;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Tab System Styles */
        .tab-container {
            margin-bottom: 20px;
        }

        .tab-header {
            display: flex;
            background: #F5F5F5;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 16px;
        }

        .tab-button {
            flex: 1;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #898491;
            text-align: center;
            position: relative;
        }

        .tab-button.active {
            background: white;
            color: #6A57FF;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-button:hover:not(.active) {
            color: #6A57FF;
            background: rgba(106, 87, 255, 0.05);
        }

        .tab-badge {
            background: #E3F2FD;
            color: #1976D2;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            margin-left: 6px;
            display: inline-block;
        }

        .tab-button.active .tab-badge {
            background: #6A57FF;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Filter Section Styles */
        .filter-section {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .filter-title {
            font-size: 16px;
            font-weight: 600;
            color: #231628;
        }

        .clear-filters {
            background: transparent;
            border: none;
            color: #6A57FF;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .clear-filters:hover {
            background: rgba(106, 87, 255, 0.1);
        }

        .filter-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .filter-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #898491;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .filter-input, .filter-select {
            width: 100%;
            background: #F5F5F5;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
            color: #231628;
            transition: all 0.2s ease;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: #6A57FF;
            background: white;
            box-shadow: 0 0 0 3px rgba(106, 87, 255, 0.1);
        }

        .search-input {
            position: relative;
        }

        .search-input::before {
            content: 'üîç';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            pointer-events: none;
        }

        .search-input input {
            padding-left: 36px;
        }

        .filter-chips {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .filter-chip {
            background: #E3F2FD;
            color: #1976D2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .filter-chip .remove {
            cursor: pointer;
            font-size: 14px;
            opacity: 0.7;
        }

        .filter-chip .remove:hover {
            opacity: 1;
        }

        .results-count {
            font-size: 14px;
            color: #898491;
            margin-bottom: 16px;
        }

        /* Summary Modal Styles */
        .summary-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .summary-modal.show {
            display: flex;
        }

        .summary-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .summary-header {
            background: #6A57FF;
            color: white;
            padding: 20px;
            border-radius: 16px 16px 0 0;
            position: relative;
        }

        .summary-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .summary-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .summary-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            padding-right: 40px;
        }

        .summary-meta {
            font-size: 14px;
            opacity: 0.9;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .summary-body {
            padding: 24px;
        }

        .summary-section {
            margin-bottom: 24px;
        }

        .summary-section h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #231628;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .summary-tag {
            background: #F5F5F5;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .summary-tag.status {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .summary-tag.status.unsolved {
            background: #FFEBEE;
            color: #C62828;
        }

        .summary-description {
            background: #F9F9F9;
            padding: 16px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .attachments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .attachment-card {
            background: #F9F9F9;
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #E0E0E0;
        }

        .attachment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: #6A57FF;
        }

        .attachment-icon {
            font-size: 32px;
            margin-bottom: 4px;
        }

        .attachment-preview {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 4px;
        }

        .attachment-name {
            font-size: 11px;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .attachment-size {
            font-size: 10px;
            color: #999;
            margin-top: 2px;
        }

        .no-attachments {
            text-align: center;
            padding: 24px;
            color: #999;
            font-size: 14px;
        }

        .attachment-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #6A57FF;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .history-item-footer {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #f0f0f0;
            font-size: 12px;
            color: #666;
        }

        .chat-summary {
            background: #F0F7FF;
            border: 1px solid #E3F2FD;
            border-radius: 8px;
            padding: 16px;
        }

        .chat-message-summary {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #E3F2FD;
        }

        .chat-message-summary:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #E3F2FD;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #1976D2;
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
        }

        .message-author {
            font-size: 12px;
            font-weight: 600;
            color: #1976D2;
            margin-bottom: 4px;
        }

        .message-text {
            font-size: 14px;
            color: #231628;
            line-height: 1.4;
        }

        .resolution-info {
            background: #E8F5E8;
            border: 1px solid #C8E6C9;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .resolution-info.unsolved {
            background: #FFEBEE;
            border-color: #FFCDD2;
        }

        .resolution-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .resolution-text {
            font-size: 16px;
            font-weight: 600;
            color: #2E7D32;
        }

        .resolution-text.unsolved {
            color: #C62828;
        }

        /* Meeting Points Styles */
        .meeting-points {
            background: #F8F9FA;
            border: 1px solid #E9ECEF;
            border-radius: 8px;
            padding: 16px;
        }

        .meeting-point {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid #E9ECEF;
        }

        .meeting-point:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .point-icon {
            font-size: 16px;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .point-text {
            font-size: 14px;
            line-height: 1.5;
            color: #231628;
            flex: 1;
        }

        /* Statistics Dashboard Styles */
        .stats-section {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .stats-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #F0F0F0;
        }

        .stats-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 600;
            color: #231628;
        }

        .stats-icon {
            font-size: 18px;
        }

        .stats-content {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            padding: 20px;
        }

        .stat-card {
            background: #F8F9FA;
            border: 1px solid #E9ECEF;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-icon {
            font-size: 16px;
        }

        .stat-label {
            font-size: 14px;
            font-weight: 600;
            color: #6C757D;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #231628;
            margin-bottom: 8px;
        }

        .stat-subtext {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .stat-detail {
            font-size: 12px;
            color: #6C757D;
        }

        .stat-bar {
            width: 100%;
            height: 6px;
            background: #E9ECEF;
            border-radius: 3px;
            overflow: hidden;
        }

        .stat-progress {
            height: 100%;
            background: linear-gradient(90deg, #28A745, #20C997);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Problem Types Card */
        .problem-types-card .stat-value {
            display: none;
        }

        .problem-type-list {
            margin-top: 8px;
        }

        .problem-type-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .problem-type-item:last-child {
            margin-bottom: 0;
        }

        .type-label {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
            min-width: 70px;
        }

        .type-count {
            font-size: 12px;
            font-weight: 700;
            color: #231628;
            min-width: 20px;
        }

        .type-bar {
            flex: 1;
            height: 4px;
            background: #E9ECEF;
            border-radius: 2px;
            overflow: hidden;
        }

        .type-progress {
            height: 100%;
            background: linear-gradient(90deg, #6A57FF, #8B7CFF);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Priority Card */
        .priority-card .stat-value {
            display: none;
        }

        .priority-list {
            margin-top: 8px;
        }

        .priority-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .priority-item:last-child {
            margin-bottom: 0;
        }

        .priority-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .priority-item.critical .priority-dot {
            background: #DC3545;
        }

        .priority-item.high .priority-dot {
            background: #FD7E14;
        }

        .priority-item.medium .priority-dot {
            background: #FFC107;
        }

        .priority-item.low .priority-dot {
            background: #28A745;
        }

        .priority-label {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
            flex: 1;
        }

        .priority-count {
            font-size: 12px;
            font-weight: 700;
            color: #231628;
        }

        /* Leaderboard Card Styles */
        .leaderboard-card .stat-value {
            display: none;
        }

        .leaderboard-list {
            margin-top: 8px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .leaderboard-item:last-child {
            margin-bottom: 0;
        }

        .leaderboard-item:hover {
            background: rgba(106, 87, 255, 0.05);
            transform: translateX(2px);
        }

        .leaderboard-item.gold {
            border-left: 3px solid #FFD700;
        }

        .leaderboard-item.silver {
            border-left: 3px solid #C0C0C0;
        }

        .leaderboard-item.bronze {
            border-left: 3px solid #CD7F32;
        }

        .rank-medal {
            font-size: 18px;
            flex-shrink: 0;
        }

        .performer-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .performer-name {
            font-size: 13px;
            font-weight: 600;
            color: #231628;
        }

        .performer-stats {
            font-size: 11px;
            color: #898491;
        }

        /* Team Page Styles */
        .profile-section {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #6A57FF 0%, #9C88FF 100%);
            color: white;
        }

        .profile-icon {
            font-size: 20px;
        }

        .profile-info h3 {
            margin: 0;
            font-size: 16px;
        }

        .profile-info p {
            margin: 0;
            font-size: 12px;
            opacity: 0.9;
        }

        .profile-card {
            padding: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .profile-card.current {
            background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
            border: 2px solid #6A57FF;
        }

        .profile-avatar {
            position: relative;
        }

        .avatar-circle {
            width: 60px;
            height: 60px;
            background: #6A57FF;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 600;
        }

        .status-badge {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .profile-details {
            flex: 1;
        }

        .profile-details h4 {
            margin: 0 0 4px 0;
            font-size: 18px;
            color: #231628;
        }

        .profile-role {
            margin: 0 0 16px 0;
            color: #898491;
            font-size: 14px;
        }

        .profile-stats {
            display: flex;
            gap: 24px;
            margin-bottom: 16px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: #6A57FF;
            line-height: 1;
        }

        .stat-label {
            font-size: 12px;
            color: #898491;
            text-transform: uppercase;
            font-weight: 600;
        }

        .achievement-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.helper {
            background: #E3F2FD;
            color: #1976D2;
        }

        .badge.solver {
            background: #FFF3E0;
            color: #F57C00;
        }

        .badge.expert {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .badge.speed {
            background: #FFF8E1;
            color: #F9A825;
        }

        .badge.helpful {
            background: #F3E5F5;
            color: #7B1FA2;
        }

        /* Leaderboard Section */
        .leaderboard-section {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            overflow: hidden;
        }

        .section-header {
            padding: 20px;
            border-bottom: 1px solid #E6E3EB;
            background: #F8F9FA;
        }

        .section-header h3 {
            margin: 0 0 4px 0;
            font-size: 18px;
            color: #231628;
        }

        .section-header p {
            margin: 0;
            color: #898491;
            font-size: 14px;
        }

        .leaderboard-grid {
            padding: 20px;
        }

        /* Podium Styles */
        .podium-container {
            display: flex;
            align-items: end;
            justify-content: center;
            gap: 8px;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .podium-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .podium-item:hover {
            transform: translateY(-5px);
        }

        .podium-profile {
            position: relative;
            margin-bottom: 8px;
        }

        .podium-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #6A57FF;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .podium-medal {
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 20px;
            background: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .podium-info {
            text-align: center;
            margin-bottom: 12px;
        }

        .podium-info h4 {
            margin: 0 0 4px 0;
            font-size: 14px;
            color: #231628;
        }

        .podium-info p {
            margin: 0;
            font-size: 12px;
            color: #898491;
            font-weight: 600;
        }

        .podium-bar {
            width: 60px;
            border-radius: 4px 4px 0 0;
        }

        .podium-bar.first {
            height: 80px;
            background: linear-gradient(to top, #FFD700, #FFF700);
        }

        .podium-bar.second {
            height: 60px;
            background: linear-gradient(to top, #C0C0C0, #E5E5E5);
        }

        .podium-bar.third {
            height: 40px;
            background: linear-gradient(to top, #CD7F32, #DAA520);
        }

        /* Team List */
        .team-list {
            border-top: 1px solid #E6E3EB;
            padding-top: 20px;
        }

        .team-member {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
        }

        .team-member:hover {
            background: #F8F9FA;
            transform: translateX(4px);
        }

        .team-member.current-user-row {
            background: rgba(106, 87, 255, 0.05);
            border: 1px solid rgba(106, 87, 255, 0.2);
        }

        .member-rank {
            font-size: 16px;
            font-weight: 700;
            color: #898491;
            width: 30px;
        }

        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6A57FF;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .member-avatar.current {
            background: linear-gradient(135deg, #6A57FF, #9C88FF);
            border: 2px solid white;
            box-shadow: 0 0 0 2px #6A57FF;
        }

        .member-info {
            flex: 1;
        }

        .member-info h4 {
            margin: 0 0 4px 0;
            font-size: 14px;
            color: #231628;
        }

        .member-info p {
            margin: 0;
            font-size: 12px;
            color: #898491;
        }

        .you-badge {
            background: #6A57FF;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            margin-left: 8px;
        }

        .member-trend {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .member-trend.up {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .member-trend.down {
            background: #FFEBEE;
            color: #C62828;
        }

        /* Profile Modal Styles */
        .profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .profile-modal.show {
            display: flex;
        }

        .profile-modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .profile-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #E6E3EB;
            background: linear-gradient(135deg, #6A57FF 0%, #9C88FF 100%);
            color: white;
            border-radius: 16px 16px 0 0;
        }

        .profile-modal-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .close-profile {
            font-size: 24px;
            cursor: pointer;
            color: white;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .close-profile:hover {
            background: rgba(255,255,255,0.2);
        }

        .profile-modal-body {
            padding: 24px;
        }

        .modal-profile-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .modal-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #6A57FF;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
            border: 4px solid white;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .modal-profile-info h4 {
            margin: 0 0 4px 0;
            font-size: 20px;
            color: #231628;
        }

        .modal-profile-info p {
            margin: 0 0 24px 0;
            color: #898491;
            font-size: 14px;
        }

        .modal-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
            width: 100%;
        }

        .modal-stat {
            text-align: center;
            padding: 16px;
            background: #F8F9FA;
            border-radius: 12px;
        }

        .modal-stat-number {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: #6A57FF;
            line-height: 1;
            margin-bottom: 4px;
        }

        .modal-stat-label {
            font-size: 12px;
            color: #898491;
            text-transform: uppercase;
            font-weight: 600;
        }

        .modal-achievements {
            width: 100%;
        }

        .modal-achievements h5 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: #231628;
            text-align: left;
        }

        .modal-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Supplier Management Styles */
        .supplier-search-section {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(106, 87, 255, 0.08);
        }

        .search-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .search-header h3 {
            margin: 0;
            font-size: 18px;
            color: #231628;
        }

        .search-icon {
            font-size: 24px;
        }

        .search-input-group {
            display: flex;
            gap: 12px;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #E6E3EB;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #6A57FF;
            box-shadow: 0 0 0 3px rgba(106, 87, 255, 0.1);
        }

        .search-btn {
            background: #6A57FF;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-btn:hover {
            background: #5142CC;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.3);
        }

        .search-results {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .results-header h3 {
            margin: 0;
            color: #231628;
        }

        .clear-btn {
            background: #F5F5F5;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .clear-btn:hover {
            background: #E8E8E8;
        }

        /* Suppliers Overview */
        .suppliers-overview {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            margin: 0;
            font-size: 18px;
            color: #231628;
        }

        .add-supplier-btn {
            background: #6A57FF;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .add-supplier-btn:hover {
            background: #5142CC;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.3);
        }

        .add-supplier-btn span {
            font-size: 20px;
        }

        .suppliers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .supplier-card {
            background: linear-gradient(135deg, #F8F9FF 0%, #FFFFFF 100%);
            border: 2px solid #E6E3EB;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .supplier-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6A57FF, #9C88FF);
        }

        .supplier-card:hover {
            border-color: #6A57FF;
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(106, 87, 255, 0.15);
        }

        .supplier-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .supplier-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6A57FF, #9C88FF);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .supplier-info h3 {
            margin: 0 0 4px 0;
            font-size: 16px;
            color: #231628;
        }

        .supplier-category {
            font-size: 12px;
            color: #6A57FF;
            font-weight: 600;
        }

        .supplier-meta {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            font-size: 13px;
        }

        .meta-stat {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-number {
            font-size: 18px;
            font-weight: 700;
            color: #6A57FF;
        }

        .stat-label {
            font-size: 11px;
            color: #898491;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Supplier Dashboard */
        .supplier-info-card {
            background: linear-gradient(135deg, #6A57FF 0%, #9C88FF 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            color: white;
            box-shadow: 0 8px 24px rgba(106, 87, 255, 0.2);
        }

        .supplier-header {
            display: flex;
            gap: 20px;
            align-items: start;
        }

        .supplier-header .supplier-avatar {
            width: 64px;
            height: 64px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            font-size: 24px;
        }

        .supplier-details {
            flex: 1;
        }

        .supplier-details h2 {
            margin: 0 0 8px 0;
            font-size: 24px;
            font-weight: 700;
        }

        .supplier-details p {
            margin: 4px 0;
            opacity: 0.9;
            font-size: 14px;
        }

        .supplier-stats {
            display: flex;
            gap: 20px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px 20px;
            text-align: center;
            min-width: 120px;
        }

        .stat-box .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .stat-box .stat-label {
            font-size: 12px;
            opacity: 0.9;
            color: white;
        }

        /* Add Part Section */
        .add-part-section {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .section-header h3 {
            margin: 0;
            font-size: 18px;
            color: #231628;
        }

        .add-part-form {
            margin-top: 16px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }

        .form-group label {
            font-size: 14px;
            font-weight: 600;
            color: #231628;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 16px;
            border: 2px solid #E6E3EB;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #6A57FF;
            box-shadow: 0 0 0 3px rgba(106, 87, 255, 0.1);
        }

        .form-select {
            cursor: pointer;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .submit-btn {
            background: #6A57FF;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 14px 24px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: #5142CC;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.3);
        }

        /* Supplier Inventory */
        .supplier-inventory-section {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 24px;
        }

        .inventory-filters {
            display: flex;
            gap: 12px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #E6E3EB;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        .parts-inventory-list {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .inventory-part-card {
            background: #F9F9F9;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s;
        }

        .inventory-part-card:hover {
            border-color: #6A57FF;
            box-shadow: 0 2px 8px rgba(106, 87, 255, 0.1);
        }

        .part-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .part-main-info h4 {
            margin: 0 0 4px 0;
            font-size: 16px;
            color: #231628;
        }

        .part-number {
            font-size: 13px;
            color: #898491;
            font-weight: 600;
        }

        .part-category-badge {
            background: #ECE8FF;
            color: #6A57FF;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .part-price-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .part-price {
            font-size: 24px;
            font-weight: 700;
            color: #6A57FF;
        }

        .part-stock {
            font-size: 13px;
            color: #898491;
        }

        .part-stock.low-stock {
            color: #FF5722;
            font-weight: 600;
        }

        .part-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .part-action-btn {
            padding: 6px 12px;
            border: 1px solid #E6E3EB;
            background: white;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .part-action-btn:hover {
            background: #F5F5F5;
        }

        .part-action-btn.delete {
            color: #D32F2F;
            border-color: #D32F2F;
        }

        .part-action-btn.delete:hover {
            background: #FFEBEE;
        }

        /* Supplier Modal */
        .supplier-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .supplier-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            animation: slideUp 0.3s;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.2);
        }

        .supplier-modal-header {
            padding: 24px;
            border-bottom: 1px solid #E6E3EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .supplier-modal-header h3 {
            margin: 0;
            font-size: 20px;
            color: #231628;
        }

        .close-modal {
            font-size: 28px;
            font-weight: bold;
            color: #898491;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-modal:hover {
            color: #231628;
        }

        .supplier-modal form {
            padding: 24px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .btn-secondary {
            padding: 12px 24px;
            border: 1px solid #E6E3EB;
            background: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: #F5F5F5;
        }

        .btn-primary {
            padding: 12px 24px;
            background: #6A57FF;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: #5142CC;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.3);
        }

        /* Search Results */
        .result-card {
            background: #F9F9F9;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .part-info h4 {
            margin: 0 0 4px 0;
            font-size: 16px;
            color: #231628;
        }

        .supplier-list {
            margin-top: 12px;
        }

        .supplier-item {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 6px;
            padding: 12px 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .supplier-item:hover {
            border-color: #6A57FF;
            box-shadow: 0 2px 8px rgba(106, 87, 255, 0.1);
        }

        .supplier-item.best-price {
            border: 2px solid #4CAF50;
            background: #E8F5E8;
        }

        .supplier-name {
            font-weight: 600;
            color: #231628;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .best-price-badge {
            background: #4CAF50;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
        }

        .supplier-price {
            color: #6A57FF;
            font-weight: 700;
            font-size: 18px;
        }

        .supplier-stock {
            font-size: 12px;
            color: #898491;
            margin-top: 4px;
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #898491;
        }

        .no-results-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Quality LAB Styles */
        .lab-report-section {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .lab-form {
            margin-top: 16px;
        }

        .form-input {
            width: 100%;
            box-sizing: border-box;
        }

        .file-upload-area {
            border: 2px dashed #E6E3EB;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-area:hover {
            border-color: #6A57FF;
            background: #F8F9FF;
        }

        .file-upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .file-upload-text p {
            margin: 0 0 4px 0;
            color: #231628;
            font-weight: 600;
        }

        .file-upload-text small {
            color: #898491;
        }

        .attached-files {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .attached-file {
            background: #F8F9FF;
            border: 1px solid #E6E3EB;
            border-radius: 6px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .attached-file .remove-file {
            color: #D32F2F;
            cursor: pointer;
            font-weight: bold;
        }

        /* Diagnostic Results */
        .diagnostic-results {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .diagnostic-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .diagnostic-header h3 {
            margin: 0;
            color: #231628;
        }

        .diagnostic-card {
            background: linear-gradient(135deg, #F8F9FF 0%, #FFFFFF 100%);
            border: 2px solid #6A57FF;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .diagnostic-section {
            margin-bottom: 20px;
        }

        .diagnostic-section h4 {
            color: #6A57FF;
            margin: 0 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .diagnostic-section ul {
            margin: 0;
            padding-left: 20px;
        }

        .diagnostic-section li {
            margin-bottom: 8px;
            color: #231628;
            line-height: 1.6;
        }

        .severity-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .severity-high {
            background: #FFEBEE;
            color: #D32F2F;
        }

        .severity-medium {
            background: #FFF3E0;
            color: #FF9800;
        }

        .severity-low {
            background: #E8F5E8;
            color: #4CAF50;
        }

        /* Lab Reports List */
        .lab-reports-section {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 12px;
            padding: 24px;
        }

        .lab-reports-list {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .lab-report-card {
            background: #F9F9F9;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lab-report-card:hover {
            border-color: #6A57FF;
            box-shadow: 0 2px 8px rgba(106, 87, 255, 0.1);
        }

        .lab-report-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .lab-report-title {
            font-weight: 600;
            color: #231628;
            margin-bottom: 4px;
        }

        .lab-report-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: #898491;
        }

        .defect-badge {
            background: #FFEBEE;
            color: #D32F2F;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .bacteria-badge {
            background: #ECE8FF;
            color: #6A57FF;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        /* Lab Detail Modal */
        .lab-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .lab-modal-content {
            background-color: white;
            margin: 3% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.2);
        }

        .lab-modal-header {
            padding: 24px;
            border-bottom: 1px solid #E6E3EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .lab-modal-header h3 {
            margin: 0;
            color: #231628;
        }

        .lab-modal-body {
            padding: 24px;
        }

        /* Lab Chat Section */
        .lab-chat-section {
            margin-top: 24px;
            border-top: 2px solid #E6E3EB;
            padding-top: 24px;
        }

        .lab-chat-section h4 {
            margin: 0 0 16px 0;
            color: #231628;
        }

        .lab-chat-messages {
            background: #F9F9F9;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .lab-chat-message {
            background: white;
            border: 1px solid #E6E3EB;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .lab-chat-message:last-child {
            margin-bottom: 0;
        }

        .lab-chat-sender {
            font-weight: 600;
            color: #6A57FF;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .lab-chat-text {
            color: #231628;
            font-size: 14px;
            line-height: 1.5;
        }

        .lab-chat-time {
            font-size: 11px;
            color: #898491;
            margin-top: 4px;
        }

        .lab-chat-input {
            display: flex;
            gap: 12px;
        }

        .lab-chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #E6E3EB;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .lab-chat-input input:focus {
            outline: none;
            border-color: #6A57FF;
            box-shadow: 0 0 0 3px rgba(106, 87, 255, 0.1);
        }

        .lab-chat-input button {
            background: #6A57FF;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lab-chat-input button:hover {
            background: #5142CC;
        }

        /* Fishbone Diagram Styles */
        .fishbone-container {
            background: linear-gradient(135deg, #F8F9FF 0%, #FFFFFF 100%);
            border: 2px solid #6A57FF;
            border-radius: 12px;
            padding: 24px;
            margin-top: 16px;
            position: relative;
        }

        .fishbone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .fishbone-category {
            background: white;
            border: 2px solid #E6E3EB;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.3s;
        }

        .fishbone-category:hover {
            border-color: #6A57FF;
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.1);
        }

        .fishbone-category-header {
            background: linear-gradient(135deg, #6A57FF, #9C88FF);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 14px;
            text-align: center;
            margin-bottom: 12px;
        }

        .fishbone-causes {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .fishbone-cause-item {
            background: #F9F9F9;
            border: 1px solid #E6E3EB;
            border-radius: 6px;
            padding: 8px;
        }

        .fishbone-cause-item input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
            width: 16px;
            height: 16px;
        }

        .fishbone-cause-item label {
            cursor: pointer;
            font-size: 13px;
            color: #231628;
            line-height: 1.5;
        }

        .fishbone-cause-item input[type="checkbox"]:checked + label {
            color: #4CAF50;
            font-weight: 600;
            text-decoration: line-through;
        }

        .cause-notes {
            width: 100%;
            margin-top: 8px;
            padding: 6px 8px;
            border: 1px solid #E6E3EB;
            border-radius: 4px;
            font-size: 12px;
            font-family: inherit;
            resize: vertical;
            min-height: 40px;
            transition: all 0.3s;
        }

        .cause-notes:focus {
            outline: none;
            border-color: #6A57FF;
            box-shadow: 0 0 0 2px rgba(106, 87, 255, 0.1);
        }

        .fishbone-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 16px;
            position: relative;
        }

        .arrow-line {
            flex: 1;
            height: 4px;
            background: linear-gradient(90deg, #6A57FF, #9C88FF);
            border-radius: 2px;
        }

        .arrow-head {
            font-size: 32px;
            color: #6A57FF;
            line-height: 1;
        }

        .arrow-label {
            position: absolute;
            right: 20px;
            top: -20px;
            background: #6A57FF;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        /* Action Items Tracking Styles */
        .action-progress {
            display: flex;
            align-items: center;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #E6E3EB;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6A57FF, #9C88FF);
            transition: width 0.5s ease;
        }

        .action-items-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-item {
            background: white;
            border: 2px solid #E6E3EB;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s;
        }

        .action-item:hover {
            border-color: #6A57FF;
            box-shadow: 0 2px 8px rgba(106, 87, 255, 0.1);
        }

        .action-item.completed {
            background: #E8F5E8;
            border-color: #4CAF50;
        }

        .action-checkbox-container {
            display: flex;
            align-items: start;
            margin-bottom: 8px;
        }

        .action-checkbox-container input[type="checkbox"] {
            margin-right: 12px;
            cursor: pointer;
            width: 20px;
            height: 20px;
            margin-top: 2px;
            flex-shrink: 0;
        }

        .action-checkbox-container label {
            cursor: pointer;
            font-size: 14px;
            color: #231628;
            line-height: 1.6;
            font-weight: 500;
        }

        .action-item.completed .action-checkbox-container label {
            color: #4CAF50;
            text-decoration: line-through;
        }

        .action-notes {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #E6E3EB;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
            transition: all 0.3s;
        }

        .action-notes:focus {
            outline: none;
            border-color: #6A57FF;
            box-shadow: 0 0 0 3px rgba(106, 87, 255, 0.1);
        }

        .action-item.completed .action-notes {
            background: white;
            border-color: #4CAF50;
        }

        /* Support Services Styling */
        .support-request-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .support-type-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .support-type-card {
            position: relative;
            border: 2px solid #E6E3EB;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .support-type-card:hover {
            border-color: #6A57FF;
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.15);
            transform: translateY(-2px);
        }

        .support-type-card input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .support-type-card input[type="radio"]:checked + label {
            color: #6A57FF;
        }

        .support-type-card input[type="radio"]:checked ~ * {
            border-color: #6A57FF;
        }

        .support-type-card.selected {
            border-color: #6A57FF;
            background: #F8F9FF;
            box-shadow: 0 0 0 3px rgba(106, 87, 255, 0.1);
        }

        .support-type-icon {
            font-size: 32px;
            text-align: center;
            margin-bottom: 8px;
        }

        .support-type-name {
            font-weight: 700;
            font-size: 14px;
            text-align: center;
            color: #231628;
            margin-bottom: 4px;
        }

        .support-type-desc {
            font-size: 12px;
            text-align: center;
            color: #898491;
        }

        .support-requests-list {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .requests-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
        }

        .request-card {
            background: white;
            border: 2px solid #E6E3EB;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .request-card:hover {
            border-color: #6A57FF;
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.15);
            transform: translateY(-2px);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .request-id {
            font-size: 12px;
            font-weight: 700;
            color: #6A57FF;
            background: #F8F9FF;
            padding: 4px 10px;
            border-radius: 6px;
        }

        .request-status {
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 6px;
            text-transform: uppercase;
        }

        .request-status.pending {
            background: #FFF3E0;
            color: #FF9800;
        }

        .request-status.quoted {
            background: #E3F2FD;
            color: #2196F3;
        }

        .request-status.approved {
            background: #E8F5E8;
            color: #4CAF50;
        }

        .request-status.in-progress {
            background: #F8F9FF;
            color: #6A57FF;
        }

        .request-status.completed {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .request-title {
            font-weight: 700;
            font-size: 16px;
            color: #231628;
            margin-bottom: 8px;
        }

        .request-meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 13px;
            color: #898491;
        }

        .request-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Support Detail Modal */
        .support-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .support-detail-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .support-detail-header {
            background: linear-gradient(135deg, #6A57FF, #9C88FF);
            color: white;
            padding: 24px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        .support-detail-header h3 {
            margin: 0;
            font-size: 20px;
        }

        .support-detail-body {
            padding: 24px;
        }

        .detail-section {
            margin-bottom: 24px;
        }

        .detail-section h4 {
            font-size: 14px;
            font-weight: 700;
            color: #6A57FF;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .detail-item {
            background: #F8F9FF;
            padding: 12px;
            border-radius: 8px;
        }

        .detail-label {
            font-size: 12px;
            color: #898491;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 14px;
            font-weight: 600;
            color: #231628;
        }

        /* Optirva Quote Section */
        .optirva-quote-section {
            background: linear-gradient(135deg, #F8F9FF 0%, #FFFFFF 100%);
            border: 2px solid #6A57FF;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .quote-header {
            margin-bottom: 20px;
        }

        .quote-header h4 {
            margin: 0 0 4px 0;
            font-size: 18px;
            color: #6A57FF;
        }

        .quote-form {
            margin-bottom: 0;
        }

        .quote-display {
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 12px;
            padding: 20px;
        }

        .quote-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .quote-item {
            text-align: center;
            padding: 12px;
            background: #F8F9FF;
            border-radius: 8px;
        }

        .quote-item-label {
            font-size: 12px;
            color: #898491;
            margin-bottom: 4px;
        }

        .quote-item-value {
            font-size: 20px;
            font-weight: 700;
            color: #6A57FF;
        }

        .quote-total {
            background: linear-gradient(135deg, #6A57FF, #9C88FF);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-top: 16px;
        }

        .quote-total-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .quote-total-value {
            font-size: 36px;
            font-weight: 700;
        }

        .quote-status {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            margin-top: 12px;
        }

        /* Quote Form Validation & Professional Styling */
        .quote-required {
            position: relative;
        }

        .quote-required.invalid {
            border: 2px solid #D32F2F !important;
            background: #FFEBEE !important;
            animation: shake 0.3s ease;
        }

        .quote-required.valid {
            border: 2px solid #4CAF50 !important;
            background: #E8F5E8 !important;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .required-indicator {
            font-size: 11px;
            color: #D32F2F;
            background: #FFEBEE;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            font-weight: 600;
        }

        .calculated-badge {
            font-size: 11px;
            color: #6A57FF;
            background: #F8F9FF;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            font-weight: 600;
        }

        .field-hint {
            display: block;
            font-size: 11px;
            color: #898491;
            margin-top: 4px;
            font-style: italic;
        }

        .calculation-formula {
            color: #6A57FF;
            font-weight: 600;
            font-style: normal;
        }

        .total-price-field {
            background: linear-gradient(135deg, #F8F9FF 0%, #E3DCFF 100%) !important;
            font-weight: 700 !important;
            color: #6A57FF !important;
            font-size: 24px !important;
            text-align: center !important;
            border: 2px solid #6A57FF !important;
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.2) !important;
        }

        .quote-validation-message {
            background: #FFEBEE;
            border: 2px solid #D32F2F;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 16px 0;
            color: #D32F2F;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quote-validation-message::before {
            content: '‚ö†Ô∏è';
            font-size: 20px;
        }

        .quote-submit-btn {
            position: relative;
            overflow: hidden;
        }

        .quote-submit-btn:disabled {
            background: #BDBDBD !important;
            cursor: not-allowed !important;
            opacity: 0.6;
        }

        .quote-submit-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(106, 87, 255, 0.4);
        }

        /* Support Chat Section */
        .support-chat-section {
            background: #F8F9FA;
            border-radius: 12px;
            padding: 20px;
        }

        .chat-header {
            margin-bottom: 16px;
        }

        .chat-header h4 {
            margin: 0;
            font-size: 16px;
            color: #231628;
        }

        .support-chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 16px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            min-height: 150px;
        }

        .support-chat-input {
            display: flex;
            gap: 12px;
        }

        .support-chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #E6E3EB;
            border-radius: 8px;
            font-size: 14px;
        }

        .support-chat-input input:focus {
            outline: none;
            border-color: #6A57FF;
        }

        .support-chat-input button {
            padding: 12px 24px;
            background: #6A57FF;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .support-chat-input button:hover {
            background: #5142CC;
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.3);
        }

        .chat-message {
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 8px;
            max-width: 80%;
        }

        .chat-message.customer {
            background: #E3F2FD;
            margin-left: 0;
            margin-right: auto;
        }

        .chat-message.optirva {
            background: #F8F9FF;
            margin-left: auto;
            margin-right: 0;
            border: 2px solid #6A57FF;
        }

        .chat-message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 11px;
            color: #898491;
        }

        .chat-message-sender {
            font-weight: 700;
            color: #6A57FF;
        }

        .chat-message-text {
            font-size: 14px;
            color: #231628;
            line-height: 1.5;
        }

        /* Machine Marketplace Styling */
        .marketplace-listing-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .marketplace-form {
            margin-top: 20px;
        }

        .radio-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border: 2px solid #E6E3EB;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }

        .radio-option:hover {
            border-color: #6A57FF;
            background: #F8F9FF;
        }

        .radio-option input[type="radio"] {
            margin: 0;
        }

        .radio-option input[type="radio"]:checked + span {
            color: #6A57FF;
            font-weight: 600;
        }

        .price-input {
            font-size: 18px !important;
            font-weight: 600 !important;
            color: #4CAF50 !important;
        }

        .marketplace-listings {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .marketplace-filters {
            display: flex;
            gap: 12px;
        }

        .filter-select {
            padding: 8px 16px;
            border: 2px solid #E6E3EB;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: #6A57FF;
        }

        .listings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .machine-listing-card {
            background: white;
            border: 2px solid #E6E3EB;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .machine-listing-card:hover {
            border-color: #6A57FF;
            box-shadow: 0 8px 24px rgba(106, 87, 255, 0.2);
            transform: translateY(-4px);
        }

        .machine-listing-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .machine-type-badge {
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 12px;
            background: #F8F9FF;
            color: #6A57FF;
        }

        .machine-condition-badge {
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 12px;
        }

        .machine-condition-badge.excellent {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .machine-condition-badge.very-good {
            background: #E3F2FD;
            color: #1976D2;
        }

        .machine-condition-badge.good {
            background: #F8F9FF;
            color: #6A57FF;
        }

        .machine-condition-badge.fair {
            background: #FFF3E0;
            color: #F57C00;
        }

        .machine-condition-badge.needs-repair {
            background: #FFEBEE;
            color: #C62828;
        }

        .machine-listing-title {
            font-size: 18px;
            font-weight: 700;
            color: #231628;
            margin-bottom: 8px;
        }

        .machine-listing-model {
            font-size: 14px;
            color: #898491;
            margin-bottom: 12px;
        }

        .machine-listing-specs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .spec-item {
            font-size: 12px;
            color: #898491;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .spec-value {
            font-weight: 600;
            color: #231628;
        }

        .machine-listing-price {
            font-size: 24px;
            font-weight: 700;
            color: #4CAF50;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px solid #E6E3EB;
        }

        .tetrapak-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 10px;
            background: #4CAF50;
            color: white;
        }

        /* Marketplace Detail Modal */
        .marketplace-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }

        .marketplace-detail-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
        }

        .marketplace-detail-header {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            padding: 24px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        .marketplace-detail-header h3 {
            margin: 0;
            font-size: 22px;
        }

        .marketplace-detail-body {
            padding: 24px;
        }

        .machine-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        .machine-detail-item {
            background: #F8F9FF;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #6A57FF;
        }

        .machine-detail-label {
            font-size: 12px;
            color: #898491;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .machine-detail-value {
            font-size: 16px;
            font-weight: 600;
            color: #231628;
        }

        .machine-photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .machine-photo {
            aspect-ratio: 1;
            background: #F8F9FF;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #E6E3EB;
            font-size: 48px;
        }

        .price-highlight {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }

        .price-highlight-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .price-highlight-value {
            font-size: 36px;
            font-weight: 700;
        }

        /* Negotiation Chat Section */
        .negotiation-chat-section {
            background: #F8F9FA;
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
        }

        .negotiation-chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 16px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            min-height: 150px;
        }

        .negotiation-chat-input {
            display: flex;
            gap: 12px;
        }

        .negotiation-chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #E6E3EB;
            border-radius: 8px;
            font-size: 14px;
        }

        .negotiation-chat-input input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .negotiation-chat-input button {
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .negotiation-chat-input button:hover {
            background: #2E7D32;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .negotiation-message {
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 8px;
            max-width: 80%;
        }

        .negotiation-message.buyer {
            background: #E3F2FD;
            margin-left: 0;
            margin-right: auto;
        }

        .negotiation-message.seller {
            background: #E8F5E8;
            margin-left: auto;
            margin-right: 0;
            border: 2px solid #4CAF50;
        }

        .negotiation-message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 11px;
            color: #898491;
        }

        .negotiation-message-sender {
            font-weight: 700;
            color: #4CAF50;
        }

        .negotiation-message-text {
            font-size: 14px;
            color: #231628;
            line-height: 1.5;
        }

        /* Marketplace Role Selector */
        .marketplace-role-selector {
            background: linear-gradient(135deg, #F8F9FF 0%, #FFFFFF 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 2px solid #E6E3EB;
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.08);
        }

        .role-selector-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .role-selector-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: #231628;
            margin: 0;
        }

        .role-selector-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .role-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
            background: white;
            border: 3px solid #E6E3EB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .role-btn:hover {
            border-color: #6A57FF;
            box-shadow: 0 4px 16px rgba(106, 87, 255, 0.15);
            transform: translateY(-2px);
        }

        .role-btn.active {
            border-color: #6A57FF;
            background: linear-gradient(135deg, #F8F9FF 0%, #E3DCFF 100%);
            box-shadow: 0 6px 20px rgba(106, 87, 255, 0.25);
        }

        .role-icon {
            font-size: 32px;
        }

        .role-name {
            font-size: 18px;
            font-weight: 700;
            color: #231628;
        }

        .role-btn.active .role-name {
            color: #6A57FF;
        }

        .role-desc {
            font-size: 12px;
            color: #898491;
            margin-top: 4px;
        }

        /* Marketplace Search Section */
        .marketplace-search-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 2px solid #E6E3EB;
        }

        .search-section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .search-section-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: #231628;
            margin: 0;
        }

        .search-filters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .search-filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .search-filter-group label {
            font-size: 14px;
            font-weight: 600;
            color: #231628;
        }

        .search-btn-large {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #6A57FF 0%, #9C88FF 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(106, 87, 255, 0.3);
        }

        .search-btn-large:hover {
            box-shadow: 0 6px 20px rgba(106, 87, 255, 0.4);
            transform: translateY(-2px);
        }

        .search-btn-large:active {
            transform: translateY(0);
        }

        /* Remote Support Timer Styling */
        .remote-support-timer-screen {
            padding: 20px;
        }

        .timer-card {
            background: linear-gradient(135deg, #F8F9FF 0%, #FFFFFF 100%);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(106, 87, 255, 0.15);
            border: 2px solid #E6E3EB;
            text-align: center;
        }

        .timer-display {
            font-size: 56px;
            font-weight: 700;
            color: #6A57FF;
            margin: 24px 0;
            font-family: 'Courier New', monospace;
            letter-spacing: 4px;
        }

        .timer-display.running {
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .timer-status {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .timer-status.running {
            background: #E8F5E8;
            color: #4CAF50;
        }

        .timer-status.paused {
            background: #FFF3E0;
            color: #FF9800;
        }

        .timer-status.stopped {
            background: #FFEBEE;
            color: #D32F2F;
        }

        .timer-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 24px;
        }

        .timer-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .timer-btn-start {
            background: #4CAF50;
            color: white;
        }

        .timer-btn-start:hover {
            background: #2E7D32;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .timer-btn-pause {
            background: #FF9800;
            color: white;
        }

        .timer-btn-pause:hover {
            background: #E65100;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }

        .timer-btn-stop {
            background: #D32F2F;
            color: white;
        }

        .timer-btn-stop:hover {
            background: #B71C1C;
            box-shadow: 0 4px 12px rgba(211, 47, 47, 0.3);
        }

        .timer-btn:disabled {
            background: #BDBDBD;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .cost-calculator {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .cost-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #E6E3EB;
        }

        .cost-row:last-child {
            border-bottom: none;
            padding-top: 16px;
            margin-top: 8px;
            border-top: 2px solid #6A57FF;
        }

        .cost-label {
            font-size: 16px;
            color: #231628;
            font-weight: 500;
        }

        .cost-value {
            font-size: 18px;
            font-weight: 700;
            color: #6A57FF;
        }

        .total-cost {
            font-size: 32px !important;
            color: #4CAF50 !important;
            background: linear-gradient(135deg, #E8F5E8 0%, #C8E6C9 100%);
            padding: 12px 20px;
            border-radius: 8px;
        }

        .session-info {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #E6E3EB;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 14px;
            color: #898491;
        }

        .info-value {
            font-size: 14px;
            font-weight: 600;
            color: #231628;
        }

        .minimum-hours-badge {
            display: inline-block;
            background: #FFF3E0;
            color: #FF9800;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .support-team-badge {
            display: inline-block;
            background: #F8F9FF;
            color: #6A57FF;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid #6A57FF;
            margin-top: 12px;
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <h1>üöÄ Complete Machine Manager App Demo</h1>
        <p>All original features + NEW chat integration</p>
    </div>

    <div class="phone-container">
        <!-- Login Screen -->
        <div class="screen active" id="loginScreen">
            <div class="login-screen">
                <div class="logo-icon">
                    <svg width="120" height="120" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <!-- 3D Sphere gradient for Earth - Vibrant Cyan to Deep Blue -->
                            <radialGradient id="earth3D" cx="35%" cy="35%">
                                <stop offset="0%" style="stop-color:#00E5FF;stop-opacity:1" />
                                <stop offset="25%" style="stop-color:#00B8D4;stop-opacity:1" />
                                <stop offset="60%" style="stop-color:#0091EA;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#01579B;stop-opacity:1" />
                            </radialGradient>

                            <!-- Highlight gradient - Enhanced shimmer -->
                            <radialGradient id="highlight" cx="30%" cy="30%">
                                <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.9" />
                                <stop offset="30%" style="stop-color:#E1F5FE;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0" />
                            </radialGradient>

                            <!-- Premium Gold gradient for primary nodes -->
                            <radialGradient id="gold3D" cx="30%" cy="30%">
                                <stop offset="0%" style="stop-color:#FFEB3B;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#FFC107;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FF6F00;stop-opacity:1" />
                            </radialGradient>

                            <!-- Emerald green gradient for nodes -->
                            <radialGradient id="emerald3D" cx="30%" cy="30%">
                                <stop offset="0%" style="stop-color:#69F0AE;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#00E676;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#00C853;stop-opacity:1" />
                            </radialGradient>

                            <!-- Purple gradient for nodes -->
                            <radialGradient id="purple3D" cx="30%" cy="30%">
                                <stop offset="0%" style="stop-color:#E040FB;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#D500F9;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#AA00FF;stop-opacity:1" />
                            </radialGradient>

                            <!-- Orange gradient for nodes -->
                            <radialGradient id="orange3D" cx="30%" cy="30%">
                                <stop offset="0%" style="stop-color:#FFB74D;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#FF9800;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#E65100;stop-opacity:1" />
                            </radialGradient>

                            <!-- Shadow filter -->
                            <filter id="shadow3D">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                                <feOffset dx="2" dy="3" result="offsetblur"/>
                                <feComponentTransfer>
                                    <feFuncA type="linear" slope="0.5"/>
                                </feComponentTransfer>
                                <feMerge>
                                    <feMergeNode/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>

                            <!-- Glow filter -->
                            <filter id="glow3D">
                                <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>

                        <!-- Outer orbital rings with vibrant colors -->
                        <circle cx="60" cy="60" r="52" fill="none" stroke="#00E5FF" stroke-width="0.5" opacity="0.2"/>
                        <ellipse cx="60" cy="60" rx="55" ry="20" fill="none" stroke="#E040FB" stroke-width="0.5" opacity="0.3" transform="rotate(-15 60 60)"/>

                        <!-- Earth shadow (behind) with colored tint -->
                        <circle cx="62" cy="63" r="28" fill="#01579B" opacity="0.4" filter="url(#shadow3D)"/>

                        <!-- Main Earth Globe - 3D sphere with vibrant cyan-blue gradient -->
                        <circle cx="60" cy="60" r="28" fill="url(#earth3D)"/>

                        <!-- Earth rim glow for depth -->
                        <circle cx="60" cy="60" r="28" fill="none" stroke="#00E5FF" stroke-width="2" opacity="0.6"/>

                        <!-- 3D Highlight on top - Enhanced shimmer -->
                        <circle cx="60" cy="60" r="28" fill="url(#highlight)"/>

                        <!-- Stylized continents - Vibrant Emerald Green -->
                        <g opacity="0.85">
                            <path d="M 50 52 Q 52 50 55 51 L 58 54 Q 60 56 57 58 L 54 56 Q 52 55 50 52 Z" fill="#00E676" stroke="#00C853" stroke-width="0.8"/>
                            <path d="M 62 48 Q 65 46 68 48 L 70 52 Q 72 54 69 56 L 66 54 Q 64 52 62 48 Z" fill="#00E676" stroke="#00C853" stroke-width="0.8"/>
                            <path d="M 56 63 Q 58 61 61 63 L 64 67 Q 65 69 62 71 L 59 69 Q 57 67 56 63 Z" fill="#00E676" stroke="#00C853" stroke-width="0.8"/>
                            <path d="M 44 57 Q 46 55 49 57 L 51 61 Q 52 63 49 65 L 46 63 Q 44 61 44 57 Z" fill="#00E676" stroke="#00C853" stroke-width="0.8"/>
                        </g>

                        <!-- Latitude/Longitude grid - Glowing cyan lines -->
                        <g opacity="0.35" stroke="#E1F5FE" stroke-width="0.5" fill="none">
                            <ellipse cx="60" cy="60" rx="28" ry="8"/>
                            <ellipse cx="60" cy="60" rx="28" ry="16"/>
                            <ellipse cx="60" cy="60" rx="8" ry="28"/>
                            <ellipse cx="60" cy="60" rx="16" ry="28"/>
                        </g>

                        <!-- Network nodes with vibrant multi-color 3D effect -->
                        <!-- Top - Premium Gold -->
                        <g filter="url(#glow3D)">
                            <circle cx="60" cy="10" r="5" fill="url(#gold3D)"/>
                            <circle cx="59" cy="9" r="2.5" fill="#FFEB3B"/>
                        </g>
                        <!-- Top-right - Emerald Green -->
                        <g filter="url(#glow3D)">
                            <circle cx="95" cy="35" r="5" fill="url(#emerald3D)"/>
                            <circle cx="94" cy="34" r="2.5" fill="#69F0AE"/>
                        </g>
                        <!-- Right - Purple -->
                        <g filter="url(#glow3D)">
                            <circle cx="110" cy="60" r="5" fill="url(#purple3D)"/>
                            <circle cx="109" cy="59" r="2.5" fill="#E040FB"/>
                        </g>
                        <!-- Bottom-right - Orange -->
                        <g filter="url(#glow3D)">
                            <circle cx="95" cy="85" r="5" fill="url(#orange3D)"/>
                            <circle cx="94" cy="84" r="2.5" fill="#FFB74D"/>
                        </g>
                        <!-- Bottom - Premium Gold -->
                        <g filter="url(#glow3D)">
                            <circle cx="60" cy="110" r="5" fill="url(#gold3D)"/>
                            <circle cx="59" cy="109" r="2.5" fill="#FFEB3B"/>
                        </g>
                        <!-- Bottom-left - Emerald Green -->
                        <g filter="url(#glow3D)">
                            <circle cx="25" cy="85" r="5" fill="url(#emerald3D)"/>
                            <circle cx="24" cy="84" r="2.5" fill="#69F0AE"/>
                        </g>
                        <!-- Left - Purple -->
                        <g filter="url(#glow3D)">
                            <circle cx="10" cy="60" r="5" fill="url(#purple3D)"/>
                            <circle cx="9" cy="59" r="2.5" fill="#E040FB"/>
                        </g>
                        <!-- Top-left - Orange -->
                        <g filter="url(#glow3D)">
                            <circle cx="25" cy="35" r="5" fill="url(#orange3D)"/>
                            <circle cx="24" cy="34" r="2.5" fill="#FFB74D"/>
                        </g>

                        <!-- Animated connection lines - Multi-color vibrant -->
                        <line x1="25" y1="35" x2="60" y2="60" stroke="#FF9800" stroke-width="2" opacity="0.7">
                            <animate attributeName="opacity" values="0.4;0.9;0.4" dur="2s" repeatCount="indefinite"/>
                        </line>
                        <line x1="95" y1="35" x2="60" y2="60" stroke="#00E676" stroke-width="2" opacity="0.7">
                            <animate attributeName="opacity" values="0.9;0.4;0.9" dur="2s" repeatCount="indefinite"/>
                        </line>
                        <line x1="25" y1="85" x2="60" y2="60" stroke="#00E676" stroke-width="2" opacity="0.7">
                            <animate attributeName="opacity" values="0.5;1.0;0.5" dur="2s" repeatCount="indefinite"/>
                        </line>
                        <line x1="95" y1="85" x2="60" y2="60" stroke="#FF9800" stroke-width="2" opacity="0.7">
                            <animate attributeName="opacity" values="1.0;0.5;1.0" dur="2s" repeatCount="indefinite"/>
                        </line>
                        <line x1="60" y1="10" x2="60" y2="60" stroke="#FFC107" stroke-width="2" opacity="0.7">
                            <animate attributeName="opacity" values="0.5;0.8;0.5" dur="2s" repeatCount="indefinite"/>
                        </line>
                        <line x1="60" y1="110" x2="60" y2="60" stroke="#FFC107" stroke-width="2" opacity="0.7">
                            <animate attributeName="opacity" values="0.8;0.5;0.8" dur="2s" repeatCount="indefinite"/>
                        </line>
                        <line x1="10" y1="60" x2="60" y2="60" stroke="#E040FB" stroke-width="2" opacity="0.7">
                            <animate attributeName="opacity" values="0.7;1.0;0.7" dur="2s" repeatCount="indefinite"/>
                        </line>
                        <line x1="110" y1="60" x2="60" y2="60" stroke="#E040FB" stroke-width="2" opacity="0.7">
                            <animate attributeName="opacity" values="1.0;0.6;1.0" dur="2s" repeatCount="indefinite"/>
                        </line>

                        <!-- Rotating orbital path - Vibrant gradient effect -->
                        <ellipse cx="60" cy="60" rx="45" ry="18" fill="none" stroke="#00E5FF" stroke-width="1.5" opacity="0.5" stroke-dasharray="5,3" transform="rotate(0 60 60)">
                            <animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 60 60" to="360 60 60" dur="20s" repeatCount="indefinite"/>
                        </ellipse>

                        <!-- Pulsing signal waves - Rainbow colors -->
                        <circle cx="60" cy="60" r="28" fill="none" stroke="#FFC107" stroke-width="2" opacity="0">
                            <animate attributeName="r" values="28;48;28" dur="3s" repeatCount="indefinite"/>
                            <animate attributeName="opacity" values="0.8;0;0.8" dur="3s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="60" cy="60" r="28" fill="none" stroke="#00E5FF" stroke-width="1.5" opacity="0">
                            <animate attributeName="r" values="28;42;28" dur="2.5s" repeatCount="indefinite"/>
                            <animate attributeName="opacity" values="0.6;0;0.6" dur="2.5s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="60" cy="60" r="28" fill="none" stroke="#E040FB" stroke-width="1.5" opacity="0">
                            <animate attributeName="r" values="28;38;28" dur="2s" repeatCount="indefinite"/>
                            <animate attributeName="opacity" values="0.5;0;0.5" dur="2s" repeatCount="indefinite"/>
                        </circle>
                    </svg>
                </div>
                <h1 class="app-title">OPTIRVA</h1>
                <p class="app-subtitle">Dairy Group Communications</p>

                <input type="text" class="input-field" placeholder="Username" id="username" value="admin">
                <input type="password" class="input-field" placeholder="Password" id="password" value="admin123">

                <button class="login-button" onclick="login()">Sign In</button>

                <div class="demo-creds">
                    <h4>Demo Credentials:</h4>
                    <p>Username: admin</p>
                    <p>Password: admin123</p>
                </div>
            </div>
        </div>

        <!-- Rooms Screen -->
        <div class="screen" id="roomsScreen">
            <div class="header">
                <button class="back-button" onclick="logout()">‚Üê</button>
                <div>
                    <div class="header-title">Rooms</div>
                    <div class="header-subtitle">Tetrapack Facility</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="rooms-grid">
                <div class="room-card" onclick="goToRoom(1)">
                    <div class="room-icon">üè≠</div>
                    <div class="room-name">Room 1</div>
                    <div class="room-status">Running</div>
                </div>
                <div class="room-card" onclick="goToRoom(2)">
                    <div class="room-icon">üì¶</div>
                    <div class="room-name">Supplier Parts</div>
                    <div class="room-status">Active</div>
                </div>
                <div class="room-card" onclick="goToRoom(3)">
                    <div class="room-icon">üî¨</div>
                    <div class="room-name">Quality LAB</div>
                    <div class="room-status">‚úì Active</div>
                </div>
                <div class="room-card" onclick="goToRoom(4)">
                    <div class="room-icon">üõ†Ô∏è</div>
                    <div class="room-name">Optirva Support</div>
                    <div class="room-status">‚úì Available</div>
                </div>
                <div class="room-card" onclick="goToRoom(5)">
                    <div class="room-icon">üè™</div>
                    <div class="room-name">Machine Marketplace</div>
                    <div class="room-status">‚úì Open</div>
                </div>
            </div>
        </div>

        <!-- Room Detail Screen -->
        <div class="screen" id="roomDetailScreen">
            <div class="header">
                <button class="back-button" onclick="showScreen('roomsScreen')">‚Üê</button>
                <div>
                    <div class="header-title">Tetrapack Room 1</div>
                    <div class="header-subtitle">Machine Management</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="nav-item" onclick="showScreen('activeIssuesScreen')">
                <div class="nav-item-left">
                    <div class="nav-icon">üî•</div>
                    <div class="nav-text">
                        <h3>Active Issues</h3>
                        <p>Current open tickets & discussions</p>
                    </div>
                </div>
                <span>‚Üí</span>
            </div>

            <div class="nav-item" onclick="showScreen('historyScreen')">
                <div class="nav-item-left">
                    <div class="nav-icon">üìú</div>
                    <div class="nav-text">
                        <h3>History</h3>
                        <p>Closed tickets & past issues</p>
                    </div>
                </div>
                <span>‚Üí</span>
            </div>

            <div class="nav-item" onclick="showScreen('teamScreen')">
                <div class="nav-item-left">
                    <div class="nav-icon">üë•</div>
                    <div class="nav-text">
                        <h3>Team</h3>
                        <p>Leaderboard & profiles</p>
                    </div>
                </div>
                <span>‚Üí</span>
            </div>

            <div class="nav-item" onclick="showMachineCategories()">
                <div class="nav-item-left">
                    <div class="nav-icon">‚öôÔ∏è</div>
                    <div class="nav-text">
                        <h3>Machine Categories</h3>
                        <p>Browse by machine type</p>
                    </div>
                </div>
                <span>‚Üí</span>
            </div>

            <div class="nav-item" onclick="reportProblem()">
                <div class="nav-item-left">
                    <div class="nav-icon">‚ö†Ô∏è</div>
                    <div class="nav-text">
                        <h3>Report Problem</h3>
                        <p>Submit machine issues</p>
                    </div>
                </div>
                <span>‚Üí</span>
            </div>

            <div class="nav-item" onclick="askQuestion()">
                <div class="nav-item-left">
                    <div class="nav-icon">‚ùì</div>
                    <div class="nav-text">
                        <h3>Ask Question</h3>
                        <p>Get help from team</p>
                    </div>
                </div>
                <span>‚Üí</span>
            </div>
        </div>

        <!-- Active Issues Screen -->
        <div class="screen" id="activeIssuesScreen">
            <div class="header">
                <button class="back-button" onclick="showScreen('roomDetailScreen')">‚Üê</button>
                <div>
                    <div class="header-title">Active Issues</div>
                    <div class="header-subtitle">Tetrapack Room 1</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="highlight">
                <h4>‚è∞ ACTIVE TICKETS</h4>
                <p>These tickets will auto-close in 3 days unless extended. Click to join discussions!</p>
            </div>

            <div class="tab-container">
                <div class="tab-header">
                    <button class="tab-button active" onclick="switchTab('myTickets')" id="myTicketsTab">
                        My Tickets <span class="tab-badge" id="myTicketsCount">0</span>
                    </button>
                    <button class="tab-button" onclick="switchTab('allTickets')" id="allTicketsTab">
                        All Tickets <span class="tab-badge" id="allTicketsCount">0</span>
                    </button>
                </div>

                <!-- My Tickets Tab -->
                <div class="tab-content active" id="myTicketsContent">
                    <div id="myTicketsContainer">
                        <!-- My active tickets will be populated here -->
                    </div>
                    <div class="empty-state" id="myTicketsEmptyState" style="display: none;">
                        <div style="text-align: center; padding: 40px 20px; color: #898491;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                            <h3>No Active Tickets</h3>
                            <p>You don't have any active tickets.<br>Create one by reporting a problem or asking a question!</p>
                        </div>
                    </div>
                </div>

                <!-- All Tickets Tab -->
                <div class="tab-content" id="allTicketsContent">
                    <div id="allTicketsContainer">
                        <!-- All active tickets will be populated here -->
                    </div>
                    <div class="empty-state" id="allTicketsEmptyState" style="display: none;">
                        <div style="text-align: center; padding: 40px 20px; color: #898491;">
                            <div style="font-size: 48px; margin-bottom: 16px;">‚úÖ</div>
                            <h3>No Active Issues</h3>
                            <p>All tickets are resolved or closed!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Screen -->
        <div class="screen" id="historyScreen">
            <div class="header">
                <button class="back-button" onclick="showScreen('roomDetailScreen')">‚Üê</button>
                <div>
                    <div class="header-title">History</div>
                    <div class="header-subtitle">Tetrapack Room 1</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="highlight">
                <h4>üîç FILTER & SEARCH</h4>
                <p>Find tickets by status, machine, or search terms!</p>
            </div>

            <!-- Statistics Section -->
            <div class="stats-section">
                <div class="stats-header">
                    <div class="stats-title">
                        <span class="stats-icon">üìä</span>
                        <span>Statistics Dashboard</span>
                    </div>
                </div>

                <div class="stats-content">
                    <div class="stats-grid">
                        <!-- Resolution Rate Card -->
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">‚úÖ</span>
                                <span class="stat-label">Resolution Rate</span>
                            </div>
                            <div class="stat-value" id="resolutionRate">85%</div>
                            <div class="stat-subtext">
                                <span class="stat-detail" id="solvedCount">17 solved</span>
                                <span class="stat-detail" id="unsolvedCount">3 unsolved</span>
                            </div>
                            <div class="stat-bar">
                                <div class="stat-progress" id="resolutionProgress" style="width: 85%"></div>
                            </div>
                        </div>

                        <!-- Total Tickets Card -->
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-icon">üìã</span>
                                <span class="stat-label">Total Tickets</span>
                            </div>
                            <div class="stat-value" id="totalTickets">20</div>
                            <div class="stat-subtext">
                                <span class="stat-detail" id="thisMonth">This month</span>
                            </div>
                        </div>

                        <!-- Problem Types Card -->
                        <div class="stat-card problem-types-card">
                            <div class="stat-header">
                                <span class="stat-icon">‚öôÔ∏è</span>
                                <span class="stat-label">Problem Types</span>
                            </div>
                            <div class="problem-type-list" id="problemTypeStats">
                                <div class="problem-type-item">
                                    <span class="type-label">Mechanical</span>
                                    <span class="type-count">8</span>
                                    <div class="type-bar">
                                        <div class="type-progress" style="width: 40%"></div>
                                    </div>
                                </div>
                                <div class="problem-type-item">
                                    <span class="type-label">Electrical</span>
                                    <span class="type-count">6</span>
                                    <div class="type-bar">
                                        <div class="type-progress" style="width: 30%"></div>
                                    </div>
                                </div>
                                <div class="problem-type-item">
                                    <span class="type-label">Questions</span>
                                    <span class="type-count">4</span>
                                    <div class="type-bar">
                                        <div class="type-progress" style="width: 20%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Priority Distribution Card -->
                        <div class="stat-card priority-card">
                            <div class="stat-header">
                                <span class="stat-icon">üî•</span>
                                <span class="stat-label">Priority Levels</span>
                            </div>
                            <div class="priority-list" id="priorityStats">
                                <div class="priority-item critical">
                                    <span class="priority-dot"></span>
                                    <span class="priority-label">Critical</span>
                                    <span class="priority-count">2</span>
                                </div>
                                <div class="priority-item high">
                                    <span class="priority-dot"></span>
                                    <span class="priority-label">High</span>
                                    <span class="priority-count">5</span>
                                </div>
                                <div class="priority-item medium">
                                    <span class="priority-dot"></span>
                                    <span class="priority-label">Medium</span>
                                    <span class="priority-count">10</span>
                                </div>
                                <div class="priority-item low">
                                    <span class="priority-dot"></span>
                                    <span class="priority-label">Low</span>
                                    <span class="priority-count">3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="filter-section">
                <div class="filter-header">
                    <div class="filter-title">üîß Filter Tickets</div>
                    <button class="clear-filters" onclick="clearAllFilters()">Clear All</button>
                </div>

                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Search</label>
                        <div class="search-input">
                            <input type="text" class="filter-input" id="searchInput" placeholder="Search title, description..." oninput="applyFilters()">
                        </div>
                    </div>
                </div>

                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Resolution Status</label>
                        <select class="filter-select" id="resolutionFilter" onchange="applyFilters()">
                            <option value="">All Statuses</option>
                            <option value="SOLVED">Solved Only</option>
                            <option value="UNSOLVED">Unsolved Only</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Machine Category</label>
                        <select class="filter-select" id="machineFilter" onchange="applyFilters()">
                            <option value="">All Machines</option>
                            <option value="Alpha Machine">Alpha Machine</option>
                            <option value="Beta Machine">Beta Machine</option>
                            <option value="Gamma Machine">Gamma Machine</option>
                            <option value="Delta Machine">Delta Machine</option>
                            <option value="Packaging Line A">Packaging Line A</option>
                            <option value="Packaging Line B">Packaging Line B</option>
                            <option value="Quality Control">Quality Control</option>
                            <option value="Conveyor System">Conveyor System</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Problem Type</label>
                        <select class="filter-select" id="problemTypeFilter" onchange="applyFilters()">
                            <option value="">All Types</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Software">Software</option>
                            <option value="Quality">Quality</option>
                            <option value="Safety">Safety</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Both">Both (Mech & Elec)</option>
                            <option value="General Question">General Question</option>
                        </select>
                    </div>
                </div>

                <!-- Active Filter Chips -->
                <div class="filter-chips" id="activeFilters"></div>
            </div>

            <!-- Results Count -->
            <div class="results-count" id="resultsCount">
                Showing all tickets
            </div>

            <div class="history-item" onclick="openDemoSummary('Machine overheating issue', 'Alpha Machine temperature exceeding normal range', 'Alpha Machine', 'Mechanical', 'UNSOLVED', '1234', 'John Smith', 'Dec 18, 2:30 PM', [{type: 'image', name: 'temperature-reading.jpg', size: '2.4 MB', url: 'https://via.placeholder.com/200x200/ff6b6b/ffffff?text=Temp+Reading'}, {type: 'video', name: 'machine-noise.mp4', size: '15.2 MB', url: '#'}, {type: 'document', name: 'maintenance-log.pdf', size: '450 KB', url: '#'}])">
                <div class="item-header">
                    <div class="item-left">
                        <div class="type-icon problem-icon">‚ö†Ô∏è</div>
                        <div>
                            <div class="item-title">Machine overheating issue</div>
                            <div class="item-description">Alpha Machine temperature exceeding normal range</div>
                        </div>
                    </div>
                    <span>‚Üí</span>
                </div>
                <div class="item-tags">
                    <div class="tag">Alpha Machine</div>
                    <div class="tag">Mechanical</div>
                    <div class="status-tag unsolved-tag">UNSOLVED</div>
                </div>
                <div class="item-footer">
                    <span>by John Smith</span>
                    <span>Dec 18, 2:30 PM</span>
                    <span style="color: #2196F3; font-weight: 600;">#1234</span>
                </div>
                <div class="history-item-footer">
                    <span class="attachment-badge">üìé 3 attachments</span>
                    <span style="margin-left: 8px; color: #999;">Tap to view ticket & files</span>
                </div>
            </div>

            <div class="history-item" onclick="openDemoSummary('Production line question', 'How to optimize packaging speed for new product line', 'Beta Machine', 'General Question', 'SOLVED', '1233', 'Sarah Johnson', 'Dec 17, 11:45 AM', [{type: 'image', name: 'line-setup.jpg', size: '1.8 MB', url: 'https://via.placeholder.com/200x200/4ecdc4/ffffff?text=Line+Setup'}, {type: 'document', name: 'speed-analysis.xlsx', size: '125 KB', url: '#'}])">
                <div class="item-header">
                    <div class="item-left">
                        <div class="type-icon question-icon">‚ùì</div>
                        <div>
                            <div class="item-title">Production line question</div>
                            <div class="item-description">How to optimize packaging speed for new product line</div>
                        </div>
                    </div>
                    <span>‚Üí</span>
                </div>
                <div class="item-tags">
                    <div class="tag">Beta Machine</div>
                    <div class="tag">General Question</div>
                    <div class="status-tag solved-tag">SOLVED</div>
                </div>
                <div class="item-footer">
                    <span>by Sarah Johnson</span>
                    <span>Dec 17, 11:45 AM</span>
                    <span style="color: #2196F3; font-weight: 600;">#1233</span>
                </div>
                <div class="history-item-footer">
                    <span class="attachment-badge">üìé 2 attachments</span>
                    <span style="margin-left: 8px; color: #999;">Tap to view ticket & files</span>
                </div>
            </div>

            <div class="history-item" onclick="openDemoSummary('Electrical fault detected', 'Power fluctuations in main control panel', 'Gamma Machine', 'Electrical', 'SOLVED', '1232', 'Mike Wilson', 'Dec 16, 3:15 PM', [{type: 'image', name: 'control-panel.jpg', size: '3.1 MB', url: 'https://via.placeholder.com/200x200/f39c12/ffffff?text=Control+Panel'}, {type: 'image', name: 'voltage-meter.jpg', size: '2.7 MB', url: 'https://via.placeholder.com/200x200/e74c3c/ffffff?text=Voltage'}, {type: 'video', name: 'fluctuation-test.mp4', size: '22.5 MB', url: '#'}, {type: 'document', name: 'electrical-report.pdf', size: '890 KB', url: '#'}])">
                <div class="item-header">
                    <div class="item-left">
                        <div class="type-icon problem-icon">‚ö†Ô∏è</div>
                        <div>
                            <div class="item-title">Electrical fault detected</div>
                            <div class="item-description">Power fluctuations in main control panel</div>
                        </div>
                    </div>
                    <span>‚Üí</span>
                </div>
                <div class="item-tags">
                    <div class="tag">Gamma Machine</div>
                    <div class="tag">Electrical</div>
                    <div class="status-tag solved-tag">SOLVED</div>
                </div>
                <div class="item-footer">
                    <span>by Mike Wilson</span>
                    <span>Dec 16, 3:15 PM</span>
                    <span style="color: #2196F3; font-weight: 600;">#1232</span>
                </div>
                <div class="history-item-footer">
                    <span class="attachment-badge">üìé 4 attachments</span>
                    <span style="margin-left: 8px; color: #999;">Tap to view ticket & files</span>
                </div>
            </div>
        </div>

        <!-- Submission Form Screen -->
        <div class="screen" id="submissionScreen">
            <div class="header">
                <button class="back-button" onclick="showScreen('roomDetailScreen')">‚Üê</button>
                <div>
                    <div class="header-title" id="submissionTitle">Report Problem</div>
                    <div class="header-subtitle">Tetrapack Room 1</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <form class="submission-form" id="submissionForm">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" class="form-input" id="submissionTitleInput" placeholder="Brief description of the issue/question" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Machine Category *</label>
                    <select class="form-select" id="machineCategory" required>
                        <option value="">Select a machine category</option>
                        <option value="Alpha Machine">Alpha Machine</option>
                        <option value="Beta Machine">Beta Machine</option>
                        <option value="Gamma Machine">Gamma Machine</option>
                        <option value="Delta Machine">Delta Machine</option>
                        <option value="Packaging Line A">Packaging Line A</option>
                        <option value="Packaging Line B">Packaging Line B</option>
                        <option value="Quality Control">Quality Control</option>
                        <option value="Conveyor System">Conveyor System</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Problem Type *</label>
                    <select class="form-select" id="problemType" required>
                        <option value="">Select problem type</option>
                        <option value="Mechanical">Mechanical</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Software">Software</option>
                        <option value="Quality">Quality</option>
                        <option value="Safety">Safety</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Both">Both (Mechanical & Electrical)</option>
                        <option value="General Question">General Question</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Priority Level</label>
                    <select class="form-select" id="priorityLevel">
                        <option value="Low">Low - Can wait</option>
                        <option value="Medium" selected>Medium - Normal priority</option>
                        <option value="High">High - Urgent</option>
                        <option value="Critical">Critical - Production stopped</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <textarea class="form-textarea" id="submissionDescription" placeholder="Provide detailed description of the issue or question..." required rows="4"></textarea>
                </div>

                <!-- Fishbone Diagram Root Cause Analysis -->
                <div class="form-group fishbone-section">
                    <div class="fishbone-header">
                        <label class="form-label">üêü Root Cause Analysis (Fishbone Diagram)</label>
                        <p style="font-size: 13px; color: #898491; margin: 4px 0 12px 0;">
                            Help identify potential root causes to make the issue clearer for the support team
                        </p>
                    </div>

                    <div class="fishbone-diagram">
                        <!-- Top bones (Man, Machine, Method) -->
                        <div class="fishbone-top-row">
                            <!-- Man / People -->
                            <div class="fishbone-category">
                                <div class="category-bone category-bone-top">
                                    <div class="bone-line"></div>
                                    <div class="category-label">üë∑ MAN (People)</div>
                                </div>
                                <div class="cause-items">
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_man" value="Training">
                                        <span>Insufficient training</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_man" value="Experience">
                                        <span>Operator inexperience</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_man" value="Communication">
                                        <span>Poor communication</span>
                                    </label>
                                    <input type="text" class="cause-input" placeholder="Other cause..." id="fishbone_man_other">
                                </div>
                            </div>

                            <!-- Machine -->
                            <div class="fishbone-category">
                                <div class="category-bone category-bone-top">
                                    <div class="bone-line"></div>
                                    <div class="category-label">‚öôÔ∏è MACHINE</div>
                                </div>
                                <div class="cause-items">
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_machine" value="Worn Parts">
                                        <span>Worn/damaged parts</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_machine" value="Calibration">
                                        <span>Poor calibration</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_machine" value="Age">
                                        <span>Equipment age</span>
                                    </label>
                                    <input type="text" class="cause-input" placeholder="Other cause..." id="fishbone_machine_other">
                                </div>
                            </div>

                            <!-- Method -->
                            <div class="fishbone-category">
                                <div class="category-bone category-bone-top">
                                    <div class="bone-line"></div>
                                    <div class="category-label">üìã METHOD</div>
                                </div>
                                <div class="cause-items">
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_method" value="Procedure">
                                        <span>Incorrect procedure</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_method" value="Documentation">
                                        <span>Missing documentation</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_method" value="Standards">
                                        <span>No standard process</span>
                                    </label>
                                    <input type="text" class="cause-input" placeholder="Other cause..." id="fishbone_method_other">
                                </div>
                            </div>
                        </div>

                        <!-- Center spine -->
                        <div class="fishbone-spine">
                            <div class="spine-line"></div>
                            <div class="problem-effect">
                                <div class="effect-arrow">‚ñ∂</div>
                                <div class="effect-label">PROBLEM EFFECT</div>
                            </div>
                        </div>

                        <!-- Bottom bones (Material, Measurement, Environment) -->
                        <div class="fishbone-bottom-row">
                            <!-- Material -->
                            <div class="fishbone-category">
                                <div class="cause-items">
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_material" value="Quality">
                                        <span>Poor material quality</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_material" value="Supplier">
                                        <span>Supplier issue</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_material" value="Storage">
                                        <span>Improper storage</span>
                                    </label>
                                    <input type="text" class="cause-input" placeholder="Other cause..." id="fishbone_material_other">
                                </div>
                                <div class="category-bone category-bone-bottom">
                                    <div class="category-label">üì¶ MATERIAL</div>
                                    <div class="bone-line"></div>
                                </div>
                            </div>

                            <!-- Measurement -->
                            <div class="fishbone-category">
                                <div class="cause-items">
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_measurement" value="Accuracy">
                                        <span>Measurement accuracy</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_measurement" value="Tools">
                                        <span>Faulty measuring tools</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_measurement" value="Frequency">
                                        <span>Infrequent checks</span>
                                    </label>
                                    <input type="text" class="cause-input" placeholder="Other cause..." id="fishbone_measurement_other">
                                </div>
                                <div class="category-bone category-bone-bottom">
                                    <div class="category-label">üìè MEASUREMENT</div>
                                    <div class="bone-line"></div>
                                </div>
                            </div>

                            <!-- Environment -->
                            <div class="fishbone-category">
                                <div class="cause-items">
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_environment" value="Temperature">
                                        <span>Temperature/humidity</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_environment" value="Cleanliness">
                                        <span>Cleanliness issues</span>
                                    </label>
                                    <label class="cause-checkbox">
                                        <input type="checkbox" name="fishbone_environment" value="Vibration">
                                        <span>Vibration/noise</span>
                                    </label>
                                    <input type="text" class="cause-input" placeholder="Other cause..." id="fishbone_environment_other">
                                </div>
                                <div class="category-bone category-bone-bottom">
                                    <div class="category-label">üå°Ô∏è ENVIRONMENT</div>
                                    <div class="bone-line"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="fishbone-summary" id="fishboneSummary" style="display: none;">
                        <h4 style="font-size: 14px; color: #231628; margin: 0 0 8px 0;">üìã Selected Root Causes:</h4>
                        <div id="fishboneSummaryContent" style="font-size: 13px; color: #6A57FF;"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Attach Files</label>
                    <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                        <div class="file-upload-icon">üìé</div>
                        <div class="file-upload-text">
                            <p>Click to attach photos, videos, or documents</p>
                            <small>Support: JPG, PNG, MP4, PDF, DOC (Max 10MB each)</small>
                        </div>
                    </div>
                    <input type="file" id="fileInput" multiple accept="image/*,video/*,.pdf,.doc,.docx" style="display: none;">
                    <div class="attached-files" id="attachedFiles"></div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="showScreen('roomDetailScreen')">Cancel</button>
                    <button type="submit" class="btn-primary">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Team Screen -->
    <div class="screen" id="teamScreen">
        <div class="container">
            <div class="header">
                <span class="back-btn" onclick="showScreen('roomDetailScreen')">‚Üê</span>
                <div class="header-content">
                    <div class="header-title">Team</div>
                    <div class="header-subtitle">Leaderboard & Profiles</div>
                </div>
            </div>

            <!-- Current User Profile Section -->
            <div class="profile-section">
                <div class="profile-header">
                    <div class="profile-icon">üë§</div>
                    <div class="profile-info">
                        <h3>Your Profile</h3>
                        <p>Performance overview & achievements</p>
                    </div>
                </div>
                <div class="profile-card current">
                    <div class="profile-avatar">
                        <div class="avatar-circle">CU</div>
                        <div class="status-badge online">üü¢</div>
                    </div>
                    <div class="profile-details">
                        <h4 id="currentUserName">Current User</h4>
                        <p class="profile-role">Team Member</p>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="currentUserPoints">45</span>
                                <span class="stat-label">Points</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="currentUserSolved">8</span>
                                <span class="stat-label">Solved</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="currentUserRating">4.2</span>
                                <span class="stat-label">Rating</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="currentUserRank">#4</span>
                                <span class="stat-label">Rank</span>
                            </div>
                        </div>
                        <div class="achievement-badges">
                            <span class="badge helper">ü§ù Team Helper</span>
                            <span class="badge solver">‚ö° Problem Solver</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Section -->
            <div class="leaderboard-section">
                <div class="section-header">
                    <h3>üèÜ Leaderboard</h3>
                    <p>Top performers this month</p>
                </div>

                <div class="leaderboard-grid" id="leaderboardGrid">
                    <!-- Top 3 - Podium Style -->
                    <div class="podium-container" id="podiumContainer">
                        <!-- Podium will be populated dynamically -->
                    </div>

                    <!-- Rest of Team List -->
                    <div class="team-list" id="teamList">
                        <!-- Team list will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Parts Screen -->
    <!-- Supplier Management Main Screen -->
    <div class="screen" id="supplierPartsScreen">
        <div class="container">
            <div class="header">
                <span class="back-btn" onclick="showScreen('roomsScreen')">‚Üê</span>
                <div class="header-content">
                    <div class="header-title">Supplier Management</div>
                    <div class="header-subtitle">Manage suppliers and search parts</div>
                </div>
            </div>

            <!-- Quick Search Across All Suppliers -->
            <div class="supplier-search-section">
                <div class="search-header">
                    <div class="search-icon">üîç</div>
                    <h3>Search Parts Across All Suppliers</h3>
                </div>
                <div class="search-input-group">
                    <input type="text" id="globalPartSearch" class="search-input" placeholder="Enter part number (e.g., P-1001)" />
                    <button class="search-btn" onclick="globalSearchPart()">Search</button>
                </div>
            </div>

            <!-- Global Search Results -->
            <div class="search-results" id="globalSearchResults" style="display: none;">
                <div class="results-header">
                    <h3>Search Results</h3>
                    <button class="clear-btn" onclick="clearGlobalSearch()">Clear</button>
                </div>
                <div id="globalResultsContainer"></div>
            </div>

            <!-- Suppliers Overview -->
            <div class="suppliers-overview">
                <div class="section-header">
                    <div>
                        <h3>üì¶ Registered Suppliers (<span id="suppliersCount">0</span>)</h3>
                        <p style="font-size: 14px; color: #898491; margin-top: 4px;">Click a supplier to view their inventory</p>
                    </div>
                    <button class="add-supplier-btn" onclick="showAddSupplierForm()">
                        <span>+</span> Add Supplier
                    </button>
                </div>
                <div id="suppliersList" class="suppliers-grid"></div>
            </div>
        </div>
    </div>

    <!-- Individual Supplier Dashboard Screen -->
    <div class="screen" id="supplierDashboardScreen">
        <div class="container">
            <div class="header">
                <span class="back-btn" onclick="showScreen('supplierPartsScreen')">‚Üê</span>
                <div class="header-content">
                    <div class="header-title" id="supplierDashTitle">Supplier Dashboard</div>
                    <div class="header-subtitle" id="supplierDashSubtitle">Manage inventory</div>
                </div>
            </div>

            <!-- Supplier Info Card -->
            <div class="supplier-info-card">
                <div class="supplier-header">
                    <div class="supplier-avatar" id="dashSupplierAvatar">AB</div>
                    <div class="supplier-details">
                        <h2 id="dashSupplierName">Supplier Name</h2>
                        <p id="dashSupplierContact">Contact info</p>
                        <p id="dashSupplierEmail">email@example.com</p>
                    </div>
                    <div class="supplier-stats">
                        <div class="stat-box">
                            <div class="stat-number" id="dashTotalParts">0</div>
                            <div class="stat-label">Total Parts</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="dashTotalValue">$0</div>
                            <div class="stat-label">Inventory Value</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Part to This Supplier -->
            <div class="add-part-section">
                <div class="section-header">
                    <h3>‚ûï Add New Part to Inventory</h3>
                </div>
                <form class="add-part-form" id="supplierPartForm" onsubmit="addPartToSupplier(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Part Number *</label>
                            <input type="text" id="dashPartNumber" required placeholder="e.g., P-1001" />
                        </div>
                        <div class="form-group">
                            <label>Part Name *</label>
                            <input type="text" id="dashPartName" required placeholder="e.g., Bearing 6205" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Price (USD) *</label>
                            <input type="number" id="dashPartPrice" required placeholder="0.00" step="0.01" min="0" />
                        </div>
                        <div class="form-group">
                            <label>Stock Quantity *</label>
                            <input type="number" id="dashPartStock" required placeholder="0" min="0" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="dashPartCategory" class="form-select">
                            <option value="Bearings">Bearings</option>
                            <option value="Motors">Motors</option>
                            <option value="Hydraulics">Hydraulics</option>
                            <option value="Electrical">Electrical Components</option>
                            <option value="Mechanical">Mechanical Parts</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="dashPartDescription" class="form-textarea" rows="2" placeholder="Optional: Add part description, specifications, or notes..."></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Add Part to Inventory</button>
                </form>
            </div>

            <!-- Supplier's Parts Inventory -->
            <div class="supplier-inventory-section">
                <div class="section-header">
                    <h3>üìã Parts Inventory (<span id="dashPartsCount">0</span>)</h3>
                    <div class="inventory-filters">
                        <select id="categoryFilter" class="filter-select" onchange="filterSupplierParts()">
                            <option value="">All Categories</option>
                            <option value="Bearings">Bearings</option>
                            <option value="Motors">Motors</option>
                            <option value="Hydraulics">Hydraulics</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <div id="supplierInventoryList" class="parts-inventory-list"></div>
            </div>
        </div>
    </div>

    <!-- Quality LAB Screen -->
    <div class="screen" id="qualityLabScreen">
        <div class="container">
            <div class="header">
                <span class="back-btn" onclick="showScreen('roomsScreen')">‚Üê</span>
                <div class="header-content">
                    <div class="header-title">Quality Control LAB</div>
                    <div class="header-subtitle">Bacteria diagnostics & defect analysis</div>
                </div>
            </div>

            <!-- New Lab Report Form -->
            <div class="lab-report-section">
                <div class="section-header">
                    <div>
                        <h3>üß™ New Quality Report</h3>
                        <p style="font-size: 14px; color: #898491; margin-top: 4px;">Report product defects and get diagnostic advice</p>
                    </div>
                </div>

                <form id="labReportForm" class="lab-form" onsubmit="submitLabReport(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Machine Type *</label>
                            <select id="labMachineType" required class="form-select">
                                <option value="">Select machine</option>
                                <option value="Filling Machine A">Filling Machine A</option>
                                <option value="Filling Machine B">Filling Machine B</option>
                                <option value="Pasteurizer Unit 1">Pasteurizer Unit 1</option>
                                <option value="Pasteurizer Unit 2">Pasteurizer Unit 2</option>
                                <option value="Packaging Line 1">Packaging Line 1</option>
                                <option value="Packaging Line 2">Packaging Line 2</option>
                                <option value="Storage Tank A">Storage Tank A</option>
                                <option value="Storage Tank B">Storage Tank B</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Defect Type *</label>
                            <select id="labDefectType" required class="form-select" onchange="updateDefectInfo()">
                                <option value="">Select defect type</option>
                                <option value="Blow">Blow (Gas production)</option>
                                <option value="Curdle">Curdle (Coagulation)</option>
                                <option value="Both">Both (Blow & Curdle)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Bacteria Type *</label>
                            <select id="labBacteriaType" required class="form-select" onchange="updateBacteriaDiagnostics()">
                                <option value="">Select bacteria type</option>
                                <option value="Clostridium">Clostridium (Anaerobic spore-former)</option>
                                <option value="Bacillus">Bacillus (Aerobic spore-former)</option>
                                <option value="Coliform">Coliform bacteria</option>
                                <option value="Lactobacillus">Lactobacillus (Lactic acid bacteria)</option>
                                <option value="Yeast">Yeast contamination</option>
                                <option value="Mold">Mold contamination</option>
                                <option value="Unknown">Unknown / Not tested yet</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Batch Number</label>
                            <input type="text" id="labBatchNumber" placeholder="e.g., BATCH-2024-001" class="form-input" />
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Number of Defect Packs *</label>
                            <input type="number" id="labDefectPacks" required placeholder="0" min="0" class="form-input" oninput="calculateDefectRate()" />
                        </div>
                        <div class="form-group">
                            <label>Total Packs Inspected *</label>
                            <input type="number" id="labTotalPacks" required placeholder="0" min="1" class="form-input" oninput="calculateDefectRate()" />
                        </div>
                        <div class="form-group">
                            <label>Defect Rate (%)</label>
                            <input type="text" id="labDefectRate" readonly placeholder="0.00%" class="form-input" style="background: #F5F5F5;" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Detailed Description</label>
                        <textarea id="labDescription" class="form-textarea" rows="3" placeholder="Describe the defect symptoms, appearance, timing, etc..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Attach Photos/Documents</label>
                        <div class="file-upload-area" onclick="document.getElementById('labFileInput').click()">
                            <div class="file-upload-icon">üìé</div>
                            <div class="file-upload-text">
                                <p>Click to attach photos or documents</p>
                                <small>JPG, PNG, PDF (Max 10MB each)</small>
                            </div>
                        </div>
                        <input type="file" id="labFileInput" multiple accept="image/*,.pdf" style="display: none;" onchange="displayLabFiles()" />
                        <div id="labAttachedFiles" class="attached-files"></div>
                    </div>

                    <button type="submit" class="submit-btn">Submit for Diagnosis</button>
                </form>
            </div>

            <!-- Diagnostic Results (shown after form submission) -->
            <div id="diagnosticResults" class="diagnostic-results" style="display: none;">
                <div class="diagnostic-header">
                    <h3>üî¨ Diagnostic Analysis</h3>
                    <button class="clear-btn" onclick="clearDiagnostics()">Clear</button>
                </div>

                <div id="diagnosticContent"></div>
            </div>

            <!-- Previous Lab Reports -->
            <div class="lab-reports-section">
                <div class="section-header">
                    <h3>üìã Previous Lab Reports (<span id="labReportsCount">0</span>)</h3>
                </div>
                <div id="labReportsList" class="lab-reports-list"></div>
            </div>
        </div>
    </div>

    <!-- Lab Report Detail Modal (with chat) -->
    <div class="lab-modal" id="labDetailModal">
        <div class="lab-modal-content">
            <div class="lab-modal-header">
                <h3 id="labDetailTitle">Lab Report Details</h3>
                <span class="close-modal" onclick="closeLabDetail()">&times;</span>
            </div>
            <div class="lab-modal-body">
                <div id="labDetailContent"></div>

                <!-- Chat Section -->
                <div class="lab-chat-section">
                    <h4>üí¨ Discussion & Advice</h4>
                    <div class="lab-chat-messages" id="labChatMessages">
                        <!-- Chat messages will be populated here -->
                    </div>
                    <div class="lab-chat-input">
                        <input type="text" id="labChatInput" placeholder="Type your advice or question..." />
                        <button onclick="sendLabChat()">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Optirva Support Services Screen -->
    <div class="screen" id="supportServicesScreen">
        <div class="container">
            <div class="header">
                <span class="back-btn" onclick="showScreen('roomsScreen')">‚Üê</span>
                <div class="header-content">
                    <div class="header-title">Optirva Support Services</div>
                    <div class="header-subtitle">Remote support, on-site service & TPMS maintenance</div>
                </div>
            </div>

            <!-- New Service Request Form -->
            <div class="support-request-section">
                <!-- Add back button for easy navigation -->
                <div style="margin-bottom: 16px;">
                    <button onclick="showScreen('roomsScreen')" type="button" style="padding: 10px 20px; background: #6A57FF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ‚Üê Back to Rooms
                    </button>
                </div>
                <div class="section-header">
                    <div>
                        <h3>üõ†Ô∏è New Service Request</h3>
                        <p style="font-size: 14px; color: #898491; margin-top: 4px;">Request technical support for your machines</p>
                    </div>
                </div>

                <form id="supportRequestForm" class="support-form" onsubmit="submitSupportRequest(event)">
                    <!-- Support Type Selection -->
                    <div class="form-group">
                        <label>Support Type *</label>
                        <div class="support-type-cards">
                            <div class="support-type-card" onclick="selectSupportType('remote')">
                                <input type="radio" name="supportType" id="supportRemote" value="remote" required />
                                <label for="supportRemote">
                                    <div class="support-type-icon">üåê</div>
                                    <div class="support-type-name">Remote Support</div>
                                    <div class="support-type-desc">Online troubleshooting</div>
                                </label>
                            </div>
                            <div class="support-type-card" onclick="selectSupportType('onsite')">
                                <input type="radio" name="supportType" id="supportOnsite" value="onsite" required />
                                <label for="supportOnsite">
                                    <div class="support-type-icon">üë®‚Äçüîß</div>
                                    <div class="support-type-name">On-Site Support</div>
                                    <div class="support-type-desc">Engineer visit</div>
                                </label>
                            </div>
                            <div class="support-type-card" onclick="selectSupportType('tpms')">
                                <input type="radio" name="supportType" id="supportTPMS" value="tpms" required />
                                <label for="supportTPMS">
                                    <div class="support-type-icon">‚öôÔ∏è</div>
                                    <div class="support-type-name">TPMS Service</div>
                                    <div class="support-type-desc">Machine maintenance</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Machine Details -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tetra Pak Machine Type *</label>
                            <select id="supportMachineType" required class="form-select">
                                <option value="">Select Tetra Pak machine type</option>

                                <optgroup label="üè≠ Aseptic Filling Machines">
                                    <option value="Tetra Pak A1">Tetra Pak A1</option>
                                    <option value="Tetra Pak A3/Speed">Tetra Pak A3/Speed</option>
                                    <option value="Tetra Pak A3/Flex">Tetra Pak A3/Flex</option>
                                    <option value="Tetra Pak A3/Compact Flex">Tetra Pak A3/Compact Flex</option>
                                    <option value="Tetra Pak A6">Tetra Pak A6</option>
                                    <option value="Tetra Pak D/Flex">Tetra Pak D/Flex</option>
                                    <option value="Tetra Pak E3/Speed">Tetra Pak E3/Speed</option>
                                    <option value="Tetra Pak E/Flex">Tetra Pak E/Flex</option>
                                </optgroup>

                                <optgroup label="üì¶ Aseptic Carton Packages">
                                    <option value="Tetra Brik Aseptic">Tetra Brik Aseptic</option>
                                    <option value="Tetra Classic Aseptic">Tetra Classic Aseptic</option>
                                    <option value="Tetra Evero Aseptic">Tetra Evero Aseptic</option>
                                    <option value="Tetra Fino Aseptic">Tetra Fino Aseptic</option>
                                    <option value="Tetra Gemina Aseptic">Tetra Gemina Aseptic</option>
                                    <option value="Tetra Prisma Aseptic">Tetra Prisma Aseptic</option>
                                    <option value="Tetra Wedge Aseptic">Tetra Wedge Aseptic</option>
                                </optgroup>

                                <optgroup label="ü•õ Chilled Products">
                                    <option value="Tetra Brik">Tetra Brik (Chilled)</option>
                                    <option value="Tetra Rex">Tetra Rex (Gable Top)</option>
                                    <option value="Tetra Stelo Aseptic">Tetra Stelo Aseptic</option>
                                    <option value="Tetra Top">Tetra Top</option>
                                </optgroup>

                                <optgroup label="üç® Specialty Packaging">
                                    <option value="Tetra Recart">Tetra Recart (Retort)</option>
                                    <option value="Tetra Therm Aseptic">Tetra Therm Aseptic (Ice Cream)</option>
                                </optgroup>

                                <optgroup label="üî• Processing - Heat Treatment">
                                    <option value="Tetra Pak Pasteurizer">Tetra Pak Pasteurizer</option>
                                    <option value="Tetra Pak UHT System">Tetra Pak UHT System (Direct)</option>
                                    <option value="Tetra Pak UHT Indirect">Tetra Pak UHT (Indirect)</option>
                                    <option value="Tetra Therm Aseptic VTIS">Tetra Therm Aseptic VTIS</option>
                                    <option value="Tetra Spiraflo">Tetra Spiraflo (Tubular Heat Exchanger)</option>
                                    <option value="Tetra Pak Heat Exchanger">Tetra Pak Plate Heat Exchanger</option>
                                </optgroup>

                                <optgroup label="‚öôÔ∏è Processing - Separation & Mixing">
                                    <option value="Tetra Pak Homogenizer">Tetra Pak Homogenizer</option>
                                    <option value="Tetra Pak Separator">Tetra Pak Separator</option>
                                    <option value="Tetra Pak Mixer">Tetra Pak Mixer (Static)</option>
                                    <option value="Tetra Pak Blender">Tetra Pak Blender</option>
                                    <option value="Tetra Almix">Tetra Almix (Powder Mixing)</option>
                                    <option value="Tetra Lactenso">Tetra Lactenso (Evaporator)</option>
                                </optgroup>

                                <optgroup label="üßº Cleaning & Sterilization">
                                    <option value="Tetra Pak CIP System">Tetra Pak CIP System</option>
                                    <option value="Tetra Pak SIP System">Tetra Pak SIP System</option>
                                    <option value="Tetra Pak CIP/SIP">Tetra Pak CIP/SIP Combined</option>
                                </optgroup>

                                <optgroup label="üóÑÔ∏è Storage & Tanks">
                                    <option value="Tetra Pak Buffer Tank">Tetra Pak Buffer Tank</option>
                                    <option value="Tetra Pak Storage Tank">Tetra Pak Storage Tank (Aseptic)</option>
                                    <option value="Tetra Pak Balance Tank">Tetra Pak Balance Tank</option>
                                    <option value="Tetra Pak Surge Tank">Tetra Pak Surge Tank</option>
                                </optgroup>

                                <optgroup label="üöö Material Handling">
                                    <option value="Tetra Pak Conveyor">Tetra Pak Conveyor System</option>
                                    <option value="Tetra Pak Accumulator">Tetra Pak Accumulator</option>
                                    <option value="Tetra Pak Distribution Unit">Tetra Pak Distribution Unit</option>
                                    <option value="Tetra Pak Loader">Tetra Pak Case Loader</option>
                                    <option value="Tetra Pak Palletizer">Tetra Pak Palletizer</option>
                                </optgroup>

                                <optgroup label="üî¨ Quality Control">
                                    <option value="Tetra Pak Laboratory Equipment">Laboratory Equipment</option>
                                    <option value="Tetra Pak Leak Detector">Leak Detector</option>
                                </optgroup>

                                <optgroup label="üí° Utilities & Support">
                                    <option value="Tetra Pak Boiler">Boiler/Steam Generator</option>
                                    <option value="Tetra Pak Chiller">Chiller/Cooling System</option>
                                    <option value="Tetra Pak Compressor">Air Compressor</option>
                                    <option value="Tetra Pak Water Treatment">Water Treatment System</option>
                                </optgroup>

                                <option value="Other Tetra Pak Equipment">Other Tetra Pak Equipment</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Machine Model</label>
                            <input type="text" id="supportMachineId" placeholder="e.g., A3/Speed Model 2020" class="form-input" />
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Package Volume</label>
                            <select id="supportPackageVolume" class="form-select">
                                <option value="Not Applicable">Not Applicable</option>
                                <option value="200ml">200 ml</option>
                                <option value="250ml">250 ml</option>
                                <option value="330ml">330 ml</option>
                                <option value="500ml">500 ml</option>
                                <option value="1000ml">1000 ml (1 Liter)</option>
                                <option value="1500ml">1500 ml (1.5 Liter)</option>
                                <option value="2000ml">2000 ml (2 Liter)</option>
                                <option value="Multiple">Multiple Volumes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Support Type / Service Required</label>
                            <select id="supportServiceType" class="form-select">
                                <option value="">Select service type</option>
                                <optgroup label="üîß Filling Machine Services">
                                    <option value="Preventive Maintenance">Preventive Maintenance</option>
                                    <option value="Emergency Repair">Emergency Repair</option>
                                    <option value="Performance Optimization">Performance Optimization</option>
                                    <option value="Filling Accuracy Issues">Filling Accuracy Issues</option>
                                    <option value="Speed/Output Problems">Speed/Output Problems</option>
                                    <option value="Sealing Problems">Sealing Problems</option>
                                    <option value="Sterilization Issues">Sterilization Issues</option>
                                    <option value="Clean-in-Place (CIP)">Clean-in-Place (CIP) Issues</option>
                                    <option value="Package Format Change">Package Format Change</option>
                                </optgroup>
                                <optgroup label="üî• Processing Equipment">
                                    <option value="UHT Temperature Issues">UHT Temperature Issues</option>
                                    <option value="Pasteurization Problems">Pasteurization Problems</option>
                                    <option value="Homogenizer Service">Homogenizer Service</option>
                                    <option value="Heat Exchanger Cleaning">Heat Exchanger Cleaning</option>
                                </optgroup>
                                <optgroup label="üì¶ Packaging Systems">
                                    <option value="Carton Feeding Issues">Carton Feeding Issues</option>
                                    <option value="Material Web Problems">Material Web Problems</option>
                                    <option value="Package Quality Issues">Package Quality Issues</option>
                                    <option value="Packaging Material Change">Packaging Material Change</option>
                                </optgroup>
                                <optgroup label="‚ö° Utilities & Support">
                                    <option value="Boiler/Steam Service">Boiler/Steam Service</option>
                                    <option value="Chiller Maintenance">Chiller Maintenance</option>
                                    <option value="Compressor Service">Compressor Service</option>
                                    <option value="Water Treatment">Water Treatment</option>
                                    <option value="Electrical Issues">Electrical Issues</option>
                                    <option value="PLC/Control System">PLC/Control System</option>
                                </optgroup>
                                <optgroup label="üìã Other Services">
                                    <option value="Training Request">Training Request</option>
                                    <option value="Spare Parts Installation">Spare Parts Installation</option>
                                    <option value="Equipment Upgrade">Equipment Upgrade</option>
                                    <option value="Quality Audit">Quality Audit</option>
                                    <option value="General Consultation">General Consultation</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Running Hours</label>
                            <input type="number" id="supportRunningHours" placeholder="0" min="0" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label>Production Volume (units/day)</label>
                            <input type="number" id="supportVolume" placeholder="0" min="0" class="form-input" />
                        </div>
                    </div>

                    <!-- Issue Description -->
                    <div class="form-group">
                        <label>Issue Description / Service Required *</label>
                        <textarea id="supportDescription" required class="form-textarea" rows="4" placeholder="Describe the problem, symptoms, or maintenance service needed..."></textarea>
                    </div>

                    <!-- Priority & Urgency -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Priority Level</label>
                            <select id="supportPriority" class="form-select">
                                <option value="low">üü¢ Low - Routine maintenance</option>
                                <option value="medium" selected>üü° Medium - Performance issue</option>
                                <option value="high">üü† High - Production affected</option>
                                <option value="critical">üî¥ Critical - Production stopped</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Preferred Date</label>
                            <input type="date" id="supportPreferredDate" class="form-input" />
                        </div>
                    </div>

                    <!-- Attachments -->
                    <div class="form-group">
                        <label>Attach Photos/Documents</label>
                        <div class="file-upload-area" onclick="document.getElementById('supportFileInput').click()">
                            <div class="file-upload-icon">üìé</div>
                            <div class="file-upload-text">
                                <p>Click to attach photos or documents</p>
                                <small>JPG, PNG, PDF, Videos (Max 20MB each)</small>
                            </div>
                        </div>
                        <input type="file" id="supportFileInput" multiple accept="image/*,.pdf,video/*" style="display: none;" onchange="displaySupportFiles()" />
                        <div id="supportAttachedFiles" class="attached-files"></div>
                    </div>

                    <button type="submit" class="submit-btn">Submit Service Request</button>
                </form>
            </div>

            <!-- Service Requests List -->
            <div class="support-requests-list">
                <div class="section-header">
                    <h3>üìã Service Requests</h3>
                </div>
                <div id="supportRequestsList" class="requests-list">
                    <!-- Service requests will be populated here -->
                </div>
            </div>

            <!-- Service Request Detail Modal -->
            <div class="support-detail-modal" id="supportDetailModal" style="display: none;">
                <div class="support-detail-content">
                    <div class="support-detail-header">
                        <div>
                            <h3 id="supportDetailTitle">Service Request Details</h3>
                            <p id="supportDetailSubtitle" style="color: #898491; margin-top: 4px;"></p>
                        </div>
                        <span class="close-modal" onclick="closeSupportDetail()">&times;</span>
                    </div>

                    <div class="support-detail-body" id="supportDetailBody">
                        <!-- Request details will be populated here -->
                    </div>

                    <!-- Optirva Quote Section -->
                    <div class="optirva-quote-section" id="optirvaQuoteSection">
                        <div class="quote-header">
                            <h4>üíº Optirva Service Quote</h4>
                            <p style="font-size: 13px; color: #898491;">Provide service estimate to customer</p>
                        </div>
                        <div class="quote-form" id="quoteForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Number of Engineers * <span class="required-indicator">Required</span></label>
                                    <input type="number" id="quoteEngineers" min="1" placeholder="e.g., 2" class="form-input quote-required" oninput="calculateQuote(); validateQuoteField(this)" />
                                    <small class="field-hint">How many engineers are needed?</small>
                                </div>
                                <div class="form-group">
                                    <label>Number of Hours * <span class="required-indicator">Required</span></label>
                                    <input type="number" id="quoteHours" min="1" step="1" placeholder="e.g., 24" class="form-input quote-required" oninput="calculateQuote(); validateQuoteField(this)" />
                                    <small class="field-hint">Total service hours required</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Hour Rate ($/hr) * <span class="required-indicator">Required</span></label>
                                    <input type="number" id="quoteHourRate" min="0" step="0.01" placeholder="e.g., 75.00" class="form-input quote-required" oninput="calculateQuote(); validateQuoteField(this)" />
                                    <small class="field-hint">Rate per hour per engineer</small>
                                </div>
                                <div class="form-group">
                                    <label>Total Price ($) <span class="calculated-badge">Auto-calculated</span></label>
                                    <input type="text" id="quoteTotal" readonly class="form-input total-price-field" placeholder="$0.00" />
                                    <small class="field-hint calculation-formula" id="calculationFormula"></small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Additional Notes / Terms</label>
                                <textarea id="quoteNotes" class="form-textarea" rows="3" placeholder="Include: Parts cost, travel expenses, payment terms, warranty, etc..."></textarea>
                            </div>
                            <div class="quote-validation-message" id="quoteValidationMessage" style="display: none;"></div>
                            <button onclick="submitQuote()" class="submit-btn quote-submit-btn">üíº Send Quote to Customer</button>
                        </div>

                        <!-- Quote Display (after submitted) -->
                        <div class="quote-display" id="quoteDisplay" style="display: none;">
                            <!-- Quote details will be shown here -->
                        </div>
                    </div>

                    <!-- Chat Section -->
                    <div class="support-chat-section">
                        <div class="chat-header">
                            <h4>üí¨ Discussion</h4>
                        </div>
                        <div class="support-chat-messages" id="supportChatMessages">
                            <!-- Chat messages will be populated here -->
                        </div>
                        <div class="support-chat-input">
                            <input type="text" id="supportChatInput" placeholder="Type your message..." />
                            <button onclick="sendSupportChat()">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Machine Marketplace Screen -->
    <div class="screen" id="machineMarketplaceScreen">
        <div class="container">
            <div class="header">
                <span class="back-btn" onclick="showScreen('roomsScreen')">‚Üê</span>
                <div class="header-content">
                    <div class="header-title">Machine Marketplace</div>
                    <div class="header-subtitle">Buy & sell industrial equipment</div>
                </div>
            </div>

            <!-- User Role Selection -->
            <div class="marketplace-role-selector">
                <div class="role-selector-header">
                    <h3>üë§ I am a:</h3>
                </div>
                <div class="role-selector-buttons">
                    <button class="role-btn active" id="supplierRoleBtn" onclick="switchMarketplaceRole('supplier')">
                        <span class="role-icon">üè≠</span>
                        <span class="role-name">Supplier</span>
                        <span class="role-desc">List machines for sale</span>
                    </button>
                    <button class="role-btn" id="customerRoleBtn" onclick="switchMarketplaceRole('customer')">
                        <span class="role-icon">üõí</span>
                        <span class="role-name">Customer</span>
                        <span class="role-desc">Search & buy machines</span>
                    </button>
                </div>
            </div>

            <!-- Customer Search Section -->
            <div class="marketplace-search-section" id="customerSearchSection" style="display: none;">
                <!-- Add back button inside this section for easy navigation -->
                <div style="margin-bottom: 16px;">
                    <button onclick="showScreen('roomsScreen')" style="padding: 10px 20px; background: #6A57FF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ‚Üê Back to Rooms
                    </button>
                </div>
                <div class="section-header">
                    <div>
                        <h3>üîç Find Your Perfect Machine</h3>
                        <p style="font-size: 14px; color: #898491; margin-top: 4px;">Search through available industrial equipment</p>
                    </div>
                </div>
                <div class="search-filters-grid">
                    <div class="search-filter-group">
                        <label>Tetra Pak Machine Type</label>
                        <select id="searchMachineType" class="form-select" onchange="performMarketplaceSearch()">
                            <option value="">All Machine Types</option>

                            <optgroup label="üè≠ Aseptic Filling Machines">
                                <option value="Tetra Pak A1">Tetra Pak A1</option>
                                <option value="Tetra Pak A3/Speed">Tetra Pak A3/Speed</option>
                                <option value="Tetra Pak A3/Flex">Tetra Pak A3/Flex</option>
                                <option value="Tetra Pak A3/Compact Flex">Tetra Pak A3/Compact Flex</option>
                                <option value="Tetra Pak A6">Tetra Pak A6</option>
                                <option value="Tetra Pak D/Flex">Tetra Pak D/Flex</option>
                                <option value="Tetra Pak E3/Speed">Tetra Pak E3/Speed</option>
                                <option value="Tetra Pak E/Flex">Tetra Pak E/Flex</option>
                            </optgroup>

                            <optgroup label="üì¶ Aseptic Carton Packages">
                                <option value="Tetra Brik Aseptic">Tetra Brik Aseptic</option>
                                <option value="Tetra Classic Aseptic">Tetra Classic Aseptic</option>
                                <option value="Tetra Evero Aseptic">Tetra Evero Aseptic</option>
                                <option value="Tetra Fino Aseptic">Tetra Fino Aseptic</option>
                                <option value="Tetra Gemina Aseptic">Tetra Gemina Aseptic</option>
                                <option value="Tetra Prisma Aseptic">Tetra Prisma Aseptic</option>
                                <option value="Tetra Wedge Aseptic">Tetra Wedge Aseptic</option>
                            </optgroup>

                            <optgroup label="ü•õ Chilled Products">
                                <option value="Tetra Brik">Tetra Brik (Chilled)</option>
                                <option value="Tetra Rex">Tetra Rex (Gable Top)</option>
                                <option value="Tetra Stelo Aseptic">Tetra Stelo Aseptic</option>
                                <option value="Tetra Top">Tetra Top</option>
                            </optgroup>

                            <optgroup label="üç® Specialty Packaging">
                                <option value="Tetra Recart">Tetra Recart (Retort)</option>
                                <option value="Tetra Therm Aseptic">Tetra Therm Aseptic (Ice Cream)</option>
                            </optgroup>

                            <optgroup label="üî• Processing - Heat Treatment">
                                <option value="Tetra Pak Pasteurizer">Tetra Pak Pasteurizer</option>
                                <option value="Tetra Pak UHT System">Tetra Pak UHT System (Direct)</option>
                                <option value="Tetra Pak UHT Indirect">Tetra Pak UHT (Indirect)</option>
                                <option value="Tetra Therm Aseptic VTIS">Tetra Therm Aseptic VTIS</option>
                                <option value="Tetra Spiraflo">Tetra Spiraflo (Tubular Heat Exchanger)</option>
                                <option value="Tetra Pak Heat Exchanger">Tetra Pak Plate Heat Exchanger</option>
                            </optgroup>

                            <optgroup label="‚öôÔ∏è Processing - Separation & Mixing">
                                <option value="Tetra Pak Homogenizer">Tetra Pak Homogenizer</option>
                                <option value="Tetra Pak Separator">Tetra Pak Separator</option>
                                <option value="Tetra Pak Mixer">Tetra Pak Mixer (Static)</option>
                                <option value="Tetra Pak Blender">Tetra Pak Blender</option>
                                <option value="Tetra Almix">Tetra Almix (Powder Mixing)</option>
                                <option value="Tetra Lactenso">Tetra Lactenso (Evaporator)</option>
                            </optgroup>

                            <optgroup label="üßº Cleaning & Sterilization">
                                <option value="Tetra Pak CIP System">Tetra Pak CIP System</option>
                                <option value="Tetra Pak SIP System">Tetra Pak SIP System</option>
                                <option value="Tetra Pak CIP/SIP">Tetra Pak CIP/SIP Combined</option>
                            </optgroup>

                            <optgroup label="üóÑÔ∏è Storage & Tanks">
                                <option value="Tetra Pak Buffer Tank">Tetra Pak Buffer Tank</option>
                                <option value="Tetra Pak Storage Tank">Tetra Pak Storage Tank (Aseptic)</option>
                                <option value="Tetra Pak Balance Tank">Tetra Pak Balance Tank</option>
                                <option value="Tetra Pak Surge Tank">Tetra Pak Surge Tank</option>
                            </optgroup>

                            <optgroup label="üöö Material Handling">
                                <option value="Tetra Pak Conveyor">Tetra Pak Conveyor System</option>
                                <option value="Tetra Pak Accumulator">Tetra Pak Accumulator</option>
                                <option value="Tetra Pak Distribution Unit">Tetra Pak Distribution Unit</option>
                                <option value="Tetra Pak Loader">Tetra Pak Case Loader</option>
                                <option value="Tetra Pak Palletizer">Tetra Pak Palletizer</option>
                            </optgroup>

                            <optgroup label="üî¨ Quality Control">
                                <option value="Tetra Pak Laboratory Equipment">Laboratory Equipment</option>
                                <option value="Tetra Pak Leak Detector">Leak Detector</option>
                            </optgroup>

                            <optgroup label="üí° Utilities & Support">
                                <option value="Tetra Pak Boiler">Boiler/Steam Generator</option>
                                <option value="Tetra Pak Chiller">Chiller/Cooling System</option>
                                <option value="Tetra Pak Compressor">Air Compressor</option>
                                <option value="Tetra Pak Water Treatment">Water Treatment System</option>
                            </optgroup>

                            <option value="Other Tetra Pak Equipment">Other Tetra Pak Equipment</option>
                        </select>
                    </div>
                    <div class="search-filter-group">
                        <label>Package Volume</label>
                        <select id="searchPackageVolume" class="form-select" onchange="performMarketplaceSearch()">
                            <option value="">All Volumes</option>
                            <option value="200ml">200 ml</option>
                            <option value="250ml">250 ml</option>
                            <option value="330ml">330 ml</option>
                            <option value="500ml">500 ml</option>
                            <option value="1000ml">1000 ml (1 Liter)</option>
                            <option value="1500ml">1500 ml (1.5 Liter)</option>
                            <option value="2000ml">2000 ml (2 Liter)</option>
                            <option value="Multiple">Multiple Volumes</option>
                        </select>
                    </div>
                    <div class="search-filter-group">
                        <label>Price Range (USD)</label>
                        <select id="searchPriceRange" class="form-select" onchange="performMarketplaceSearch()">
                            <option value="">Any Price</option>
                            <option value="0-50000">$0 - $50,000</option>
                            <option value="50000-100000">$50,000 - $100,000</option>
                            <option value="100000-250000">$100,000 - $250,000</option>
                            <option value="250000-500000">$250,000 - $500,000</option>
                            <option value="500000+">$500,000+</option>
                        </select>
                    </div>
                    <div class="search-filter-group">
                        <label>Condition</label>
                        <select id="searchCondition" class="form-select" onchange="performMarketplaceSearch()">
                            <option value="">Any Condition</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Very Good">Very Good</option>
                            <option value="Good">Good</option>
                            <option value="Fair">Fair</option>
                        </select>
                    </div>
                </div>
                <button class="search-btn-large" onclick="performMarketplaceSearch()">
                    üîç Search Machines
                </button>
            </div>

            <!-- List Your Machine Form -->
            <div class="marketplace-listing-section" id="supplierFormSection" style="display: block;">
                <!-- Add back button inside this section for easy navigation -->
                <div style="margin-bottom: 16px;">
                    <button onclick="showScreen('roomsScreen')" style="padding: 10px 20px; background: #6A57FF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ‚Üê Back to Rooms
                    </button>
                </div>
                <div class="section-header">
                    <div>
                        <h3>üè™ List Your Machine</h3>
                        <p style="font-size: 14px; color: #898491; margin-top: 4px;">Sell your industrial equipment to verified buyers</p>
                    </div>
                </div>

                <form id="machineListingForm" class="marketplace-form" onsubmit="submitMachineListing(event)">
                    <!-- Machine Details -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tetra Pak Machine Type * <span class="required-indicator">Required</span></label>
                            <select id="marketplaceMachineType" required class="form-select">
                                <option value="">Select Tetra Pak machine type</option>

                                <optgroup label="üè≠ Aseptic Filling Machines">
                                    <option value="Tetra Pak A1">Tetra Pak A1</option>
                                    <option value="Tetra Pak A3/Speed">Tetra Pak A3/Speed</option>
                                    <option value="Tetra Pak A3/Flex">Tetra Pak A3/Flex</option>
                                    <option value="Tetra Pak A3/Compact Flex">Tetra Pak A3/Compact Flex</option>
                                    <option value="Tetra Pak A6">Tetra Pak A6</option>
                                    <option value="Tetra Pak D/Flex">Tetra Pak D/Flex</option>
                                    <option value="Tetra Pak E3/Speed">Tetra Pak E3/Speed</option>
                                    <option value="Tetra Pak E/Flex">Tetra Pak E/Flex</option>
                                </optgroup>

                                <optgroup label="üì¶ Aseptic Carton Packages">
                                    <option value="Tetra Brik Aseptic">Tetra Brik Aseptic</option>
                                    <option value="Tetra Classic Aseptic">Tetra Classic Aseptic</option>
                                    <option value="Tetra Evero Aseptic">Tetra Evero Aseptic</option>
                                    <option value="Tetra Fino Aseptic">Tetra Fino Aseptic</option>
                                    <option value="Tetra Gemina Aseptic">Tetra Gemina Aseptic</option>
                                    <option value="Tetra Prisma Aseptic">Tetra Prisma Aseptic</option>
                                    <option value="Tetra Wedge Aseptic">Tetra Wedge Aseptic</option>
                                </optgroup>

                                <optgroup label="ü•õ Chilled Products">
                                    <option value="Tetra Brik">Tetra Brik (Chilled)</option>
                                    <option value="Tetra Rex">Tetra Rex (Gable Top)</option>
                                    <option value="Tetra Stelo Aseptic">Tetra Stelo Aseptic</option>
                                    <option value="Tetra Top">Tetra Top</option>
                                </optgroup>

                                <optgroup label="üç® Specialty Packaging">
                                    <option value="Tetra Recart">Tetra Recart (Retort)</option>
                                    <option value="Tetra Therm Aseptic">Tetra Therm Aseptic (Ice Cream)</option>
                                </optgroup>

                                <optgroup label="üî• Processing - Heat Treatment">
                                    <option value="Tetra Pak Pasteurizer">Tetra Pak Pasteurizer</option>
                                    <option value="Tetra Pak UHT System">Tetra Pak UHT System (Direct)</option>
                                    <option value="Tetra Pak UHT Indirect">Tetra Pak UHT (Indirect)</option>
                                    <option value="Tetra Therm Aseptic VTIS">Tetra Therm Aseptic VTIS</option>
                                    <option value="Tetra Spiraflo">Tetra Spiraflo (Tubular Heat Exchanger)</option>
                                    <option value="Tetra Pak Heat Exchanger">Tetra Pak Plate Heat Exchanger</option>
                                </optgroup>

                                <optgroup label="‚öôÔ∏è Processing - Separation & Mixing">
                                    <option value="Tetra Pak Homogenizer">Tetra Pak Homogenizer</option>
                                    <option value="Tetra Pak Separator">Tetra Pak Separator</option>
                                    <option value="Tetra Pak Mixer">Tetra Pak Mixer (Static)</option>
                                    <option value="Tetra Pak Blender">Tetra Pak Blender</option>
                                    <option value="Tetra Almix">Tetra Almix (Powder Mixing)</option>
                                    <option value="Tetra Lactenso">Tetra Lactenso (Evaporator)</option>
                                </optgroup>

                                <optgroup label="üßº Cleaning & Sterilization">
                                    <option value="Tetra Pak CIP System">Tetra Pak CIP System</option>
                                    <option value="Tetra Pak SIP System">Tetra Pak SIP System</option>
                                    <option value="Tetra Pak CIP/SIP">Tetra Pak CIP/SIP Combined</option>
                                </optgroup>

                                <optgroup label="üóÑÔ∏è Storage & Tanks">
                                    <option value="Tetra Pak Buffer Tank">Tetra Pak Buffer Tank</option>
                                    <option value="Tetra Pak Storage Tank">Tetra Pak Storage Tank (Aseptic)</option>
                                    <option value="Tetra Pak Balance Tank">Tetra Pak Balance Tank</option>
                                    <option value="Tetra Pak Surge Tank">Tetra Pak Surge Tank</option>
                                </optgroup>

                                <optgroup label="üöö Material Handling">
                                    <option value="Tetra Pak Conveyor">Tetra Pak Conveyor System</option>
                                    <option value="Tetra Pak Accumulator">Tetra Pak Accumulator</option>
                                    <option value="Tetra Pak Distribution Unit">Tetra Pak Distribution Unit</option>
                                    <option value="Tetra Pak Loader">Tetra Pak Case Loader</option>
                                    <option value="Tetra Pak Palletizer">Tetra Pak Palletizer</option>
                                </optgroup>

                                <optgroup label="üî¨ Quality Control">
                                    <option value="Tetra Pak Laboratory Equipment">Laboratory Equipment</option>
                                    <option value="Tetra Pak Leak Detector">Leak Detector</option>
                                </optgroup>

                                <optgroup label="üí° Utilities & Support">
                                    <option value="Tetra Pak Boiler">Boiler/Steam Generator</option>
                                    <option value="Tetra Pak Chiller">Chiller/Cooling System</option>
                                    <option value="Tetra Pak Compressor">Air Compressor</option>
                                    <option value="Tetra Pak Water Treatment">Water Treatment System</option>
                                </optgroup>

                                <option value="Other Tetra Pak Equipment">Other Tetra Pak Equipment</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Package Volume</label>
                            <select id="marketplacePackageVolume" class="form-select">
                                <option value="Not Applicable">Not Applicable</option>
                                <option value="200ml">200 ml</option>
                                <option value="250ml">250 ml</option>
                                <option value="330ml">330 ml</option>
                                <option value="500ml">500 ml</option>
                                <option value="1000ml">1000 ml (1 Liter)</option>
                                <option value="1500ml">1500 ml (1.5 Liter)</option>
                                <option value="2000ml">2000 ml (2 Liter)</option>
                                <option value="Multiple">Multiple Volumes</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Year of Manufacture</label>
                            <input type="number" id="marketplaceYear" placeholder="e.g., 2018" min="1980" max="2025" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label>Running Hours *</label>
                            <input type="number" id="marketplaceRunningHours" required placeholder="e.g., 15000" min="0" class="form-input" />
                        </div>
                    </div>

                    <!-- Condition & Service -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Machine Condition * <span class="required-indicator">Required</span></label>
                            <select id="marketplaceCondition" required class="form-select">
                                <option value="">Select condition</option>
                                <option value="Excellent">‚≠ê Excellent - Like new, minimal wear</option>
                                <option value="Very Good">‚úÖ Very Good - Well maintained</option>
                                <option value="Good">üëç Good - Normal wear, fully functional</option>
                                <option value="Fair">‚ö†Ô∏è Fair - Needs minor repairs</option>
                                <option value="Needs Repair">üîß Needs Repair - Not operational</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Service Status *</label>
                            <select id="marketplaceServiceStatus" required class="form-select">
                                <option value="">Select service status</option>
                                <option value="Up to Date">‚úÖ Up to Date - Recently serviced</option>
                                <option value="Overdue">‚ö†Ô∏è Overdue - Service needed</option>
                                <option value="Never Serviced">‚ùå Never Serviced</option>
                                <option value="Unknown">‚ùì Unknown</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Tetrapak Service Contract? *</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="tetrapakService" value="Yes" required />
                                    <span>‚úÖ Yes - Tetrapak servicing</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="tetrapakService" value="No" required />
                                    <span>‚ùå No - Third-party or self-serviced</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Price (USD) * <span class="required-indicator">Required</span></label>
                            <input type="number" id="marketplacePrice" required placeholder="e.g., 50000" min="0" step="100" class="form-input price-input" />
                            <small class="field-hint">Enter your asking price or "Negotiable"</small>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label>Machine Description *</label>
                        <textarea id="marketplaceDescription" required class="form-textarea" rows="4" placeholder="Describe the machine: features, specifications, reason for selling, any additional information..."></textarea>
                    </div>

                    <!-- Location -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Location (Country/City)</label>
                            <input type="text" id="marketplaceLocation" placeholder="e.g., Germany, Munich" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label>Supplier Contact</label>
                            <input type="text" id="marketplaceContact" placeholder="Your company name" class="form-input" />
                        </div>
                    </div>

                    <!-- Photos & Videos -->
                    <div class="form-group">
                        <label>Attach Photos & Videos *</label>
                        <div class="file-upload-area" onclick="document.getElementById('marketplaceFiles').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">
                                <p>Click to upload machine photos & videos</p>
                                <small>JPG, PNG, MP4, MOV (Max 50MB per file)</small>
                            </div>
                        </div>
                        <input type="file" id="marketplaceFiles" multiple accept="image/*,video/*" style="display: none;" onchange="displayMarketplaceFiles()" />
                        <div id="marketplaceAttachedFiles" class="attached-files"></div>
                    </div>

                    <button type="submit" class="submit-btn">üè™ List Machine for Sale</button>
                </form>
            </div>

            <!-- Marketplace Listings -->
            <div class="marketplace-listings">
                <!-- Add back button -->
                <div style="margin-bottom: 16px;">
                    <button onclick="showScreen('roomsScreen')" style="padding: 10px 20px; background: #6A57FF; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ‚Üê Back to Rooms
                    </button>
                </div>
                <div class="section-header">
                    <h3>üìã Available Machines (<span id="machineListingsCount">0</span>)</h3>
                    <div class="marketplace-filters">
                        <select id="filterMachineType" class="filter-select" onchange="filterMarketplace()">
                            <option value="">All Types</option>
                            <option value="Filling Machine">Filling Machine</option>
                            <option value="Pasteurizer">Pasteurizer</option>
                            <option value="Packaging Line">Packaging Line</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <div id="machineListingsList" class="listings-grid">
                    <!-- Machine listings will be populated here -->
                </div>
            </div>

            <!-- Remote Support Timer Screen -->
            <div class="screen remote-support-timer-screen" id="remoteSupportTimerScreen">
                <div class="header">
                    <span class="back-btn" onclick="showScreen('supportServicesScreen')">‚Üê</span>
                    <div class="header-content">
                        <div class="header-title">Remote Support Session</div>
                        <div class="header-subtitle" id="timerRequestId">Request ID: SR-0001</div>
                    </div>
                </div>

                <!-- Session Information -->
                <div class="session-info">
                    <h4 style="margin: 0 0 16px 0; color: #231628; font-size: 16px;">üìã Session Information</h4>
                    <div class="info-row">
                        <div class="info-label">Customer</div>
                        <div class="info-value" id="sessionCustomer">John Smith</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Machine Type</div>
                        <div class="info-value" id="sessionMachineType">Tetra Pak A3/Speed</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Machine ID</div>
                        <div class="info-value" id="sessionMachineId">TPK-12345</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Priority</div>
                        <div class="info-value" id="sessionPriority">High</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Started At</div>
                        <div class="info-value" id="sessionStartTime">--:--</div>
                    </div>
                </div>

                <!-- Timer Card -->
                <div class="timer-card">
                    <span class="timer-status running" id="timerStatus">‚è∏Ô∏è Paused</span>
                    <div class="timer-display" id="timerDisplay">02:00:00</div>
                    <div style="text-align: center; color: #898491; font-size: 14px; margin-top: 8px;">
                        <span>Minimum: 2 hours</span>
                        <span class="minimum-hours-badge">120 minutes</span>
                    </div>

                    <!-- Timer Controls - Support Team Only -->
                    <div class="timer-controls">
                        <button class="timer-btn timer-btn-start" id="startTimerBtn" onclick="startTimer()">
                            ‚ñ∂Ô∏è Start Timer
                        </button>
                        <button class="timer-btn timer-btn-pause" id="pauseTimerBtn" onclick="pauseTimer()" disabled>
                            ‚è∏Ô∏è Pause
                        </button>
                        <button class="timer-btn timer-btn-stop" id="stopTimerBtn" onclick="stopTimer()" disabled>
                            ‚èπÔ∏è Stop Session
                        </button>
                    </div>

                    <div class="support-team-badge">
                        üîí Support Team Controls Only
                    </div>
                </div>

                <!-- Cost Calculator -->
                <div class="cost-calculator">
                    <h4 style="margin: 0 0 20px 0; color: #231628; font-size: 18px;">üí∞ Cost Breakdown</h4>

                    <div class="cost-row">
                        <div class="cost-label">Hourly Rate</div>
                        <div class="cost-value" id="displayHourlyRate">$75.00/hr</div>
                    </div>

                    <div class="cost-row">
                        <div class="cost-label">Elapsed Time</div>
                        <div class="cost-value" id="displayElapsedTime">0 hrs 0 mins</div>
                    </div>

                    <div class="cost-row">
                        <div class="cost-label">Minimum Charge (2 hours)</div>
                        <div class="cost-value" id="displayMinimumCharge">$150.00</div>
                    </div>

                    <div class="cost-row">
                        <div class="cost-label" style="font-size: 20px; font-weight: 700;">TOTAL COST</div>
                        <div class="cost-value total-cost" id="displayTotalCost">$150.00</div>
                    </div>
                </div>

                <!-- Session Notes -->
                <div class="session-info">
                    <h4 style="margin: 0 0 12px 0; color: #231628; font-size: 16px;">üìù Session Notes</h4>
                    <textarea id="sessionNotes" class="form-input" rows="4" placeholder="Add notes about the support session..." style="width: 100%; resize: vertical;"></textarea>
                    <button onclick="saveSessionNotes()" class="submit-btn" style="margin-top: 12px; width: 100%;">üíæ Save Notes</button>
                </div>
            </div>

            <!-- Machine Detail Modal -->
            <div class="marketplace-detail-modal" id="machineDetailModal" style="display: none;">
                <div class="marketplace-detail-content">
                    <div class="marketplace-detail-header">
                        <div>
                            <h3 id="machineDetailTitle">Machine Details</h3>
                            <p id="machineDetailSubtitle" style="color: white; margin-top: 4px; opacity: 0.9;"></p>
                        </div>
                        <span class="close-modal" onclick="closeMachineDetail()">&times;</span>
                    </div>

                    <div class="marketplace-detail-body" id="machineDetailBody">
                        <!-- Machine details will be populated here -->
                    </div>

                    <!-- Price Negotiation Chat -->
                    <div class="negotiation-chat-section">
                        <div class="chat-header">
                            <h4>üí¨ Price Negotiation</h4>
                            <p style="font-size: 12px; color: #898491; margin-top: 4px;">Chat with seller about price and details</p>
                        </div>
                        <div class="negotiation-chat-messages" id="negotiationChatMessages">
                            <!-- Chat messages will be populated here -->
                        </div>
                        <div class="negotiation-chat-input">
                            <input type="text" id="negotiationChatInput" placeholder="Make an offer or ask a question..." />
                            <button onclick="sendNegotiationChat()">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Supplier Modal -->
    <div class="supplier-modal" id="addSupplierModal">
        <div class="supplier-modal-content">
            <div class="supplier-modal-header">
                <h3>‚ûï Register New Supplier</h3>
                <span class="close-modal" onclick="closeAddSupplierForm()">&times;</span>
            </div>
            <form id="addSupplierForm" onsubmit="addNewSupplier(event)">
                <div class="form-group">
                    <label>Company Name *</label>
                    <input type="text" id="newSupplierName" required placeholder="e.g., ABC Industrial Supplies" />
                </div>
                <div class="form-group">
                    <label>Contact Person *</label>
                    <input type="text" id="newSupplierContact" required placeholder="e.g., John Smith" />
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="newSupplierEmail" required placeholder="contact@supplier.com" />
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="newSupplierPhone" placeholder="+1 234 567 8900" />
                    </div>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <textarea id="newSupplierAddress" class="form-textarea" rows="2" placeholder="Business address..."></textarea>
                </div>
                <div class="form-group">
                    <label>Specialization</label>
                    <select id="newSupplierCategory" class="form-select">
                        <option value="General">General Parts Supplier</option>
                        <option value="Bearings">Bearings Specialist</option>
                        <option value="Motors">Motors & Drives</option>
                        <option value="Hydraulics">Hydraulics & Pneumatics</option>
                        <option value="Electrical">Electrical Components</option>
                        <option value="Mechanical">Mechanical Parts</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeAddSupplierForm()">Cancel</button>
                    <button type="submit" class="btn-primary">Register Supplier</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h3 id="modalProfileName">Team Member Profile</h3>
                <span class="close-profile" onclick="closeProfile()">&times;</span>
            </div>
            <div class="profile-modal-body">
                <div class="modal-profile-card">
                    <div class="modal-avatar" id="modalAvatar">JS</div>
                    <div class="modal-profile-info">
                        <h4 id="modalName">John Smith</h4>
                        <p id="modalRole">Senior Technician</p>
                        <div class="modal-stats">
                            <div class="modal-stat">
                                <span class="modal-stat-number" id="modalPoints">92</span>
                                <span class="modal-stat-label">Total Points</span>
                            </div>
                            <div class="modal-stat">
                                <span class="modal-stat-number" id="modalSolved">15</span>
                                <span class="modal-stat-label">Tickets Solved</span>
                            </div>
                            <div class="modal-stat">
                                <span class="modal-stat-number" id="modalRating">4.7</span>
                                <span class="modal-stat-label">Avg Rating</span>
                            </div>
                            <div class="modal-stat">
                                <span class="modal-stat-number" id="modalRank">#2</span>
                                <span class="modal-stat-label">Current Rank</span>
                            </div>
                        </div>
                        <div class="modal-achievements">
                            <h5>Achievements</h5>
                            <div class="modal-badges" id="modalBadges">
                                <span class="badge expert">‚≠ê Expert Solver</span>
                                <span class="badge speed">‚ö° Quick Response</span>
                                <span class="badge helpful">ü§ù Team Player</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-header">
            <div class="chat-header-left">
                <span class="chat-back" onclick="closeChat()">‚Üê</span>
                <div class="chat-info">
                    <h3 id="chatTitle">Problem Discussion</h3>
                    <p>üü¢ 3 online</p>
                </div>
            </div>
            <div class="chat-actions">
                <span class="chat-action">‚öôÔ∏è</span>
                <span class="chat-action">üìπ</span>
                <span class="chat-action">üìû</span>
                <span class="chat-action">‚ãÆ</span>
            </div>
        </div>

        <!-- Todo List Section -->
        <div class="chat-todos" id="chatTodos">
            <div class="todos-header">
                <h4>üéØ Actions Tried</h4>
                <button class="add-todo-btn" onclick="showAddTodoForm()">+ Add Action</button>
            </div>
            <div class="todos-list" id="todosList">
                <!-- Todos will be populated here -->
            </div>
            <div class="add-todo-form" id="addTodoForm" style="display: none;">
                <input type="text" id="todoInput" placeholder="What action was tried?">
                <div class="todo-form-actions">
                    <button onclick="addTodo()">Add</button>
                    <button onclick="hideAddTodoForm()">Cancel</button>
                </div>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message other">
                <div class="message-user">John Smith</div>
                <div class="message-text">I had a similar issue last week. Try checking the temperature settings.</div>
                <div class="message-time">10:30 AM</div>
            </div>
            <div class="message own">
                <div class="message-text">Thanks! What temperature should I check?</div>
                <div class="message-time">10:35 AM</div>
            </div>
            <div class="message other">
                <div class="message-user">John Smith</div>
                <div class="message-text">Check if it's between 75-80¬∞C. Also make sure the cooling system is working.</div>
                <div class="message-time">10:40 AM</div>
            </div>
            <div class="message other">
                <div class="message-user">Sarah Johnson</div>
                <div class="message-text">I agree with John. Also check the pressure valve - that was my issue.</div>
                <div class="message-time">11:15 AM</div>
            </div>
        </div>

        <div class="chat-input">
            <div class="input-container">
                <span>üìé</span>
                <input type="text" placeholder="Type a message" id="messageInput">
                <span>üòä</span>
            </div>
            <button class="send-button" onclick="sendMessage()">‚Üí</button>
        </div>
    </div>

    <!-- Summary Modal -->
    <div class="summary-modal" id="summaryModal">
        <div class="summary-content">
            <div class="summary-header">
                <button class="summary-close" onclick="closeSummary()">√ó</button>
                <div class="summary-title" id="summaryTitle">Ticket Summary</div>
                <div class="summary-meta" id="summaryMeta">
                    <span>Ticket #1234</span>
                    <span>Created Dec 18</span>
                    <span>by John Smith</span>
                </div>
            </div>
            <div class="summary-body">
                <div class="summary-section">
                    <div class="summary-tags" id="summaryTags">
                        <div class="summary-tag">Alpha Machine</div>
                        <div class="summary-tag">Mechanical</div>
                        <div class="summary-tag status">SOLVED</div>
                    </div>
                </div>

                <div class="summary-section">
                    <h3>üìù Description</h3>
                    <div class="summary-description" id="summaryDescription">
                        Original problem description will appear here...
                    </div>
                </div>

                <div class="summary-section" id="attachmentsSection">
                    <h3>üìé Attachments</h3>
                    <div id="attachmentsContainer">
                        <!-- Attachments will be populated here -->
                    </div>
                </div>

                <div class="summary-section">
                    <h3>üìã Meeting Points & Key Decisions</h3>
                    <div class="meeting-points" id="meetingPointsContent">
                        <div class="meeting-point">
                            <span class="point-icon">üå°Ô∏è</span>
                            <span class="point-text">Temperature issue confirmed: Machine running 5¬∞C above normal range</span>
                        </div>
                        <div class="meeting-point">
                            <span class="point-icon">üîç</span>
                            <span class="point-text">Root cause identified: Cooling fan #3 bearing worn, running slower</span>
                        </div>
                        <div class="meeting-point">
                            <span class="point-icon">üìã</span>
                            <span class="point-text">Action required: Order replacement bearings for fan #3</span>
                        </div>
                    </div>
                </div>

                <div class="summary-section">
                    <h3>üéØ Resolution</h3>
                    <div class="resolution-info" id="resolutionInfo">
                        <div class="resolution-icon">‚úÖ</div>
                        <div class="resolution-text">Issue Resolved</div>
                        <div style="font-size: 14px; margin-top: 8px; opacity: 0.8;">This ticket was closed and marked as solved.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Solver Selection Modal -->
    <div class="solver-modal" id="solverModal">
        <div class="solver-modal-content">
            <div class="solver-header">
                <h3>üèÜ Who Solved This Issue?</h3>
                <span class="close-solver" onclick="closeSolverModal()">&times;</span>
            </div>
            <div class="solver-body">
                <div class="solver-section">
                    <label class="solver-label">Select the person who solved this problem:</label>
                    <select id="solverSelect" class="solver-select">
                        <option value="">Choose from chat participants...</option>
                    </select>
                </div>
                <div class="solver-section">
                    <label class="solver-label">Rate their solution (1-5 stars):</label>
                    <div class="star-rating" id="starRating">
                        <span class="star" data-rating="1">‚òÖ</span>
                        <span class="star" data-rating="2">‚òÖ</span>
                        <span class="star" data-rating="3">‚òÖ</span>
                        <span class="star" data-rating="4">‚òÖ</span>
                        <span class="star" data-rating="5">‚òÖ</span>
                    </div>
                    <div class="rating-text" id="ratingText">Click to rate</div>
                </div>
                <div class="solver-section">
                    <label class="solver-label">Additional feedback (optional):</label>
                    <textarea id="solverComment" class="solver-comment" placeholder="Great work on diagnosing the issue quickly..."></textarea>
                </div>
                <div class="solver-actions">
                    <button class="solver-btn cancel" onclick="closeSolverModal()">Cancel</button>
                    <button class="solver-btn submit" onclick="submitSolverRating()">Mark as Solved</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');

            // Update leaderboard when showing team screen
            if (screenId === 'teamScreen') {
                updateLeaderboard();
            }
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === 'admin' && password === 'admin123') {
                showScreen('roomsScreen');
            } else {
                alert('Invalid credentials! Use admin/admin123');
            }
        }

        function logout() {
            showScreen('loginScreen');
        }

        function goToRoom(roomId) {
            if (roomId === 2) {
                showScreen('supplierPartsScreen');
                loadSuppliersList();
            } else if (roomId === 3) {
                showScreen('qualityLabScreen');
                loadLabReportsList();
            } else if (roomId === 4) {
                showScreen('supportServicesScreen');
                loadSupportRequestsList();
            } else if (roomId === 5) {
                showScreen('machineMarketplaceScreen');
                loadMarketplaceListings();
            } else {
                showScreen('roomDetailScreen');
            }
        }

        function showMachineCategories() {
            alert('Machine Categories: Alpha, Beta, Gamma, Delta machines available');
        }

        function reportProblem() {
            document.getElementById('submissionTitle').textContent = 'Report Problem';
            document.getElementById('problemType').required = true;
            showScreen('submissionScreen');
        }

        function askQuestion() {
            document.getElementById('submissionTitle').textContent = 'Ask Question';
            document.getElementById('problemType').required = false;
            showScreen('submissionScreen');
        }

        function openChat(title, description, ticketId = null) {
            // If no ticketId provided, try to find it from active tickets
            if (!ticketId) {
                const activeTickets = tickets.filter(t => t.state === 'ACTIVE');
                const matchingTicket = activeTickets.find(t => t.title === title && t.description === description);
                ticketId = matchingTicket ? matchingTicket.id : null;
            }

            currentActiveTicket = ticketId;
            document.getElementById('chatTitle').textContent = title;

            // Load existing messages for this ticket
            loadChatMessages(ticketId);

            // Load existing todos for this ticket
            loadChatTodos(ticketId);

            document.getElementById('chatModal').classList.add('show');
        }

        function loadChatMessages(ticketId) {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';

            if (ticketId && ticketChats[ticketId]) {
                const messages = ticketChats[ticketId].messages;

                messages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    const isOwnMessage = message.author === currentUser;
                    messageDiv.className = isOwnMessage ? 'message own' : 'message other';

                    messageDiv.innerHTML = `
                        ${!isOwnMessage ? `<div class="message-user">${message.author}</div>` : ''}
                        <div class="message-text">${message.text}</div>
                        <div class="message-time">${message.timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    `;

                    messagesContainer.appendChild(messageDiv);
                });

                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            } else {
                // No existing chat - show empty state or starter message
                const welcomeDiv = document.createElement('div');
                welcomeDiv.className = 'message other';
                welcomeDiv.innerHTML = `
                    <div class="message-user">System</div>
                    <div class="message-text">Chat started for this ticket. Team members will be notified.</div>
                    <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                `;
                messagesContainer.appendChild(welcomeDiv);
            }
        }

        function closeChat() {
            document.getElementById('chatModal').classList.remove('show');
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (!message || !currentActiveTicket) return;

            const timestamp = new Date();
            const messagesContainer = document.getElementById('chatMessages');

            // Create and add the user's message
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message own';
            messageDiv.innerHTML = `
                <div class="message-text">${message}</div>
                <div class="message-time">${timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Save message to ticket's chat history
            if (!ticketChats[currentActiveTicket]) {
                ticketChats[currentActiveTicket] = { messages: [], meetingPoints: [] };
            }

            const userMessage = {
                id: Date.now(),
                author: currentUser,
                timestamp: timestamp,
                text: message
            };

            ticketChats[currentActiveTicket].messages.push(userMessage);

            // Track participant in this ticket's chat
            if (!ticketParticipants[currentActiveTicket]) {
                ticketParticipants[currentActiveTicket] = new Set();
            }
            ticketParticipants[currentActiveTicket].add(currentUser);

            input.value = '';

            // Simulate team member response
            setTimeout(() => {
                const responses = [
                    "Let me check the maintenance logs for that.",
                    "I'll head over to check that right away.",
                    "Thanks for reporting this issue.",
                    "I've seen this before - try restarting the system.",
                    "Adding this to our priority list now.",
                    "Can you provide more details about when this started?",
                    "I'll coordinate with the maintenance team on this.",
                    "Let me run some diagnostics and get back to you."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                const responseTimestamp = new Date();

                const responseDiv = document.createElement('div');
                responseDiv.className = 'message other';
                responseDiv.innerHTML = `
                    <div class="message-user">Team Member</div>
                    <div class="message-text">${randomResponse}</div>
                    <div class="message-time">${responseTimestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                `;
                messagesContainer.appendChild(responseDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                // Save response to chat history
                const responseMessage = {
                    id: Date.now() + 1,
                    author: 'Team Member',
                    timestamp: responseTimestamp,
                    text: randomResponse
                };

                ticketChats[currentActiveTicket].messages.push(responseMessage);

                // Track responder as participant
                if (!ticketParticipants[currentActiveTicket]) {
                    ticketParticipants[currentActiveTicket] = new Set();
                }
                ticketParticipants[currentActiveTicket].add(randomResponder);

            }, 1000 + Math.random() * 2000);
        }

        // Allow Enter key to send message
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Close modal when clicking outside
        document.getElementById('chatModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeChat();
            }
        });

        // Todo Management Functions for Chat
        function loadChatTodos(ticketId) {
            const todosList = document.getElementById('todosList');
            todosList.innerHTML = '';

            if (ticketId && ticketTodos[ticketId]) {
                const todos = ticketTodos[ticketId];
                todos.forEach((todo, index) => {
                    const todoDiv = document.createElement('div');
                    todoDiv.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                    todoDiv.innerHTML = `
                        <div class="todo-text">${todo.text}</div>
                        <div class="todo-actions">
                            ${!todo.completed ?
                                `<button class="todo-action-btn complete" onclick="toggleTodo(${index})" title="Mark as tried">‚úì</button>` :
                                `<button class="todo-action-btn complete" onclick="toggleTodo(${index})" title="Mark as not tried">‚Ü∂</button>`
                            }
                            <button class="todo-action-btn delete" onclick="deleteTodo(${index})" title="Delete">√ó</button>
                        </div>
                    `;
                    todosList.appendChild(todoDiv);
                });
            } else {
                // Show some default todos for demo
                const defaultTodos = [
                    { text: 'Checked temperature settings', completed: true },
                    { text: 'Restarted the machine', completed: true },
                    { text: 'Verified cooling system status', completed: false }
                ];

                if (ticketId) {
                    ticketTodos[ticketId] = defaultTodos;
                    loadChatTodos(ticketId); // Reload with the default todos
                }
            }
        }

        function showAddTodoForm() {
            document.getElementById('addTodoForm').style.display = 'block';
            document.getElementById('todoInput').focus();
        }

        function hideAddTodoForm() {
            document.getElementById('addTodoForm').style.display = 'none';
            document.getElementById('todoInput').value = '';
        }

        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            if (!text || !currentActiveTicket) return;

            if (!ticketTodos[currentActiveTicket]) {
                ticketTodos[currentActiveTicket] = [];
            }

            const newTodo = {
                text: text,
                completed: false,
                timestamp: new Date()
            };

            ticketTodos[currentActiveTicket].push(newTodo);
            loadChatTodos(currentActiveTicket);
            hideAddTodoForm();
        }

        function toggleTodo(index) {
            if (!currentActiveTicket || !ticketTodos[currentActiveTicket]) return;

            ticketTodos[currentActiveTicket][index].completed = !ticketTodos[currentActiveTicket][index].completed;
            loadChatTodos(currentActiveTicket);
        }

        function deleteTodo(index) {
            if (!currentActiveTicket || !ticketTodos[currentActiveTicket]) return;

            ticketTodos[currentActiveTicket].splice(index, 1);
            loadChatTodos(currentActiveTicket);
        }

        // Ticket Management System
        let tickets = [];
        let ticketChats = {}; // Store chat messages for each ticket ID
        let ticketTodos = {}; // Store todo lists for each ticket ID
        let currentActiveTicket = null; // Track which ticket's chat is currently open
        const currentUser = 'Current User';

        // User profiles and points system
        let userProfiles = {
            'Current User': { name: 'Current User', points: 45, ticketsSolved: 8, totalRatings: 15, averageRating: 4.2 },
            'John Smith': { name: 'John Smith', points: 92, ticketsSolved: 15, totalRatings: 25, averageRating: 4.7 },
            'Sarah Wilson': { name: 'Sarah Wilson', points: 78, ticketsSolved: 12, totalRatings: 20, averageRating: 4.1 },
            'Mike Johnson': { name: 'Mike Johnson', points: 134, ticketsSolved: 22, totalRatings: 35, averageRating: 4.8 },
            'Emma Davis': { name: 'Emma Davis', points: 56, ticketsSolved: 9, totalRatings: 18, averageRating: 4.3 },
            'Alex Rodriguez': { name: 'Alex Rodriguez', points: 89, ticketsSolved: 14, totalRatings: 22, averageRating: 4.5 }
        };

        // Allow Enter key to add todo
        document.addEventListener('DOMContentLoaded', function() {
            const todoInput = document.getElementById('todoInput');
            if (todoInput) {
                todoInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addTodo();
                    }
                });
            }

            // Initialize leaderboard on page load
            updateLeaderboard();
        });

        // Track chat participants per ticket
        let ticketParticipants = {};

        // Initialize with some demo tickets for testing
        function initializeDemoTickets() {
            const now = new Date();

            // Add some existing tickets with different timer states
            tickets = [
                {
                    id: 1001,
                    title: 'Machine overheating issue',
                    description: 'Alpha Machine temperature exceeding normal range',
                    machineCategory: 'Alpha Machine',
                    problemType: 'Mechanical',
                    priority: 'High',
                    creator: 'John Smith',
                    state: 'CLOSED',
                    resolution: 'UNSOLVED',
                    createdAt: new Date(now - 5 * 24 * 60 * 60 * 1000), // 5 days ago
                    expiresAt: new Date(now - 2 * 24 * 60 * 60 * 1000), // expired 2 days ago
                    autoCloseWarned: true,
                    files: []
                },
                {
                    id: 1002,
                    title: 'Production line question',
                    description: 'How to optimize packaging speed for new product line',
                    machineCategory: 'Beta Machine',
                    problemType: 'General Question',
                    priority: 'Medium',
                    creator: 'Sarah Johnson',
                    state: 'CLOSED',
                    resolution: 'SOLVED',
                    createdAt: new Date(now - 4 * 24 * 60 * 60 * 1000), // 4 days ago
                    expiresAt: new Date(now - 1 * 24 * 60 * 60 * 1000), // expired 1 day ago
                    autoCloseWarned: true,
                    files: []
                },
                {
                    id: 1003,
                    title: 'Electrical fault detected',
                    description: 'Power fluctuations in main control panel',
                    machineCategory: 'Gamma Machine',
                    problemType: 'Electrical',
                    priority: 'Critical',
                    creator: 'Mike Wilson',
                    state: 'CLOSED',
                    resolution: 'SOLVED',
                    createdAt: new Date(now - 3 * 24 * 60 * 60 * 1000), // 3 days ago
                    expiresAt: new Date(now - 6 * 60 * 60 * 1000), // expired 6 hours ago
                    autoCloseWarned: true,
                    files: []
                },
                {
                    id: 1004,
                    title: 'Current User Test Ticket',
                    description: 'This is your test ticket to try the new system!',
                    machineCategory: 'Alpha Machine',
                    problemType: 'Mechanical',
                    priority: 'Medium',
                    creator: 'Current User',
                    state: 'ACTIVE',
                    resolution: 'UNSOLVED',
                    createdAt: new Date(now - 1 * 60 * 60 * 1000), // 1 hour ago
                    expiresAt: new Date(now.getTime() + 2 * 24 * 60 * 60 * 1000 + 23 * 60 * 60 * 1000), // 2d 23h from now
                    autoCloseWarned: false,
                    files: []
                },
                {
                    id: 1005,
                    title: 'Urgent Warning Test',
                    description: 'This ticket will warn about auto-close soon',
                    machineCategory: 'Beta Machine',
                    problemType: 'Electrical',
                    priority: 'High',
                    creator: 'Current User',
                    state: 'ACTIVE',
                    resolution: 'UNSOLVED',
                    createdAt: new Date(now - 2 * 24 * 60 * 60 * 1000), // 2 days ago
                    expiresAt: new Date(now.getTime() + 12 * 60 * 60 * 1000), // 12 hours from now (warning zone)
                    autoCloseWarned: false,
                    files: []
                }
            ];

            // Initialize chat histories for demo tickets
            ticketChats = {
                1001: {
                    messages: [
                        { id: 1, author: 'John Smith', timestamp: new Date(now - 4 * 60 * 60 * 1000), text: 'Machine is running at 85¬∞C consistently. Normal range should be 75-80¬∞C.' },
                        { id: 2, author: 'Team Lead', timestamp: new Date(now - 3 * 60 * 60 * 1000), text: 'Let me check the maintenance logs for this machine.' },
                        { id: 3, author: 'Team Lead', timestamp: new Date(now - 3 * 60 * 60 * 1000), text: 'Last maintenance was 2 weeks ago. Cooling system looks normal in logs.' },
                        { id: 4, author: 'Technician Mike', timestamp: new Date(now - 2 * 60 * 60 * 1000), text: 'I\'ll check the cooling fans and temperature sensors physically.' },
                        { id: 5, author: 'John Smith', timestamp: new Date(now - 2 * 60 * 60 * 1000), text: 'Thanks! The issue started this morning around 9 AM.' },
                        { id: 6, author: 'Technician Mike', timestamp: new Date(now - 1 * 60 * 60 * 1000), text: 'Found the issue - cooling fan #3 is running slower than normal. Bearing seems worn.' },
                        { id: 7, author: 'Team Lead', timestamp: new Date(now - 1 * 60 * 60 * 1000), text: 'Do we have replacement bearings in stock?' },
                        { id: 8, author: 'John Smith', timestamp: new Date(now - 30 * 60 * 1000), text: 'Need to order new bearings. Issue will persist until replacement.' }
                    ],
                    meetingPoints: [
                        'üå°Ô∏è Temperature issue confirmed: Machine running 5¬∞C above normal range',
                        'üîç Root cause identified: Cooling fan #3 bearing worn, running slower',
                        'üìã Action required: Order replacement bearings for fan #3',
                        '‚è±Ô∏è Timeline: Issue will persist until parts arrive and replacement completed',
                        'üë§ Assigned: Technician Mike to handle replacement when parts arrive'
                    ]
                },
                1002: {
                    messages: [
                        { id: 1, author: 'Sarah Johnson', timestamp: new Date(now - 5 * 24 * 60 * 60 * 1000), text: 'Need help optimizing packaging speed for the new juice box line.' },
                        { id: 2, author: 'Senior Operator', timestamp: new Date(now - 5 * 24 * 60 * 60 * 1000), text: 'What\'s the current throughput and target speed?' },
                        { id: 3, author: 'Sarah Johnson', timestamp: new Date(now - 5 * 24 * 60 * 60 * 1000), text: 'Currently at 120 units/min, need to reach 150 units/min for production targets.' },
                        { id: 4, author: 'Senior Operator', timestamp: new Date(now - 5 * 24 * 60 * 60 * 1000), text: 'Try these settings: Conveyor speed 85%, Pressure 12 PSI, Cycle timing 2.5 seconds.' },
                        { id: 5, author: 'Production Manager', timestamp: new Date(now - 5 * 24 * 60 * 60 * 1000), text: 'Also check the folding mechanism tension - should be at level 7 for juice boxes.' },
                        { id: 6, author: 'Sarah Johnson', timestamp: new Date(now - 4 * 24 * 60 * 60 * 1000), text: 'Applied all settings. Speed increased to 145 units/min! Almost there.' },
                        { id: 7, author: 'Senior Operator', timestamp: new Date(now - 4 * 24 * 60 * 60 * 1000), text: 'Great! For the final 5 units/min, try reducing dwell time to 1.8 seconds.' },
                        { id: 8, author: 'Sarah Johnson', timestamp: new Date(now - 4 * 24 * 60 * 60 * 1000), text: 'Perfect! Now at 152 units/min. Target achieved! Thanks everyone.' }
                    ],
                    meetingPoints: [
                        'üéØ Goal: Increase packaging speed from 120 to 150 units/min for new juice box line',
                        '‚öôÔ∏è Settings optimized: Conveyor 85%, Pressure 12 PSI, Cycle timing 2.5s',
                        'üîß Folding mechanism adjusted: Tension set to level 7 for juice boxes',
                        'üìà Result: Final speed 152 units/min - target exceeded by 2 units/min',
                        '‚úÖ Resolution: Production targets achieved, settings documented for future use'
                    ]
                },
                1003: {
                    messages: [
                        { id: 1, author: 'Mike Wilson', timestamp: new Date(now - 4 * 24 * 60 * 60 * 1000), text: 'Experiencing power fluctuations in main control panel every 8-10 minutes.' },
                        { id: 2, author: 'Electrical Team', timestamp: new Date(now - 4 * 24 * 60 * 60 * 1000), text: 'We\'ll investigate immediately. Any pattern to the timing?' },
                        { id: 3, author: 'Mike Wilson', timestamp: new Date(now - 4 * 24 * 60 * 60 * 1000), text: 'Very consistent - exactly every 9 minutes. Voltage drops from 220V to 205V briefly.' },
                        { id: 4, author: 'Electrical Team', timestamp: new Date(now - 4 * 24 * 60 * 60 * 1000), text: 'Checking panel C3 connections and reviewing load balancing.' },
                        { id: 5, author: 'Electrical Team', timestamp: new Date(now - 3 * 24 * 60 * 60 * 1000), text: 'Found loose connection in panel C3, terminal 7. Tightened and testing now.' },
                        { id: 6, author: 'Mike Wilson', timestamp: new Date(now - 3 * 24 * 60 * 60 * 1000), text: 'Monitoring for the past 30 minutes - no fluctuations detected!' },
                        { id: 7, author: 'Electrical Team', timestamp: new Date(now - 3 * 24 * 60 * 60 * 1000), text: 'Will continue monitoring for 24 hours to confirm stability.' },
                        { id: 8, author: 'Mike Wilson', timestamp: new Date(now - 3 * 24 * 60 * 60 * 1000), text: 'Confirmed stable for 24 hours. Issue resolved!' }
                    ],
                    meetingPoints: [
                        '‚ö° Issue: Power fluctuations every 9 minutes, voltage drops from 220V to 205V',
                        'üîç Investigation: Focused on panel C3 connections and load balancing',
                        'üîß Root cause: Loose connection found in panel C3, terminal 7',
                        '‚úÖ Solution: Connection tightened and system tested',
                        'üìä Verification: 24-hour monitoring confirmed stable power supply'
                    ]
                },
                1004: {
                    messages: [
                        { id: 1, author: 'Current User', timestamp: new Date(now - 1 * 60 * 60 * 1000), text: 'This is a test ticket to demonstrate the new chat system!' },
                        { id: 2, author: 'Team Lead', timestamp: new Date(now - 45 * 60 * 1000), text: 'I can see this ticket in the system. What specific issue are you testing?' },
                        { id: 3, author: 'Current User', timestamp: new Date(now - 30 * 60 * 1000), text: 'Testing that each ticket has its own chat history and that messages persist.' }
                    ],
                    meetingPoints: [
                        'üß™ Purpose: Test ticket to demonstrate new chat system functionality',
                        'üí¨ Chat persistence: Each ticket maintains its own message history',
                        'üîÑ System status: New ticket management system working as expected'
                    ]
                },
                1005: {
                    messages: [
                        { id: 1, author: 'Current User', timestamp: new Date(now - 2 * 24 * 60 * 60 * 1000), text: 'Beta Machine electrical panel showing warning lights intermittently.' },
                        { id: 2, author: 'Electrical Team', timestamp: new Date(now - 2 * 24 * 60 * 60 * 1000), text: 'Which specific warning lights? Main power, motor, or control system?' },
                        { id: 3, author: 'Current User', timestamp: new Date(now - 2 * 24 * 60 * 60 * 1000), text: 'Motor warning light flashes red every few hours. No pattern detected yet.' }
                    ],
                    meetingPoints: [
                        'üö® Issue: Intermittent motor warning lights on Beta Machine',
                        'üîç Status: Under investigation by Electrical Team',
                        '‚è∞ Timeline: Warning occurs every few hours, pattern analysis ongoing'
                    ]
                }
            };
        }

        // Timer and notification system
        function updateTicketTimers() {
            const now = new Date();

            tickets.forEach(ticket => {
                if (ticket.state === 'ACTIVE') {
                    const timeLeft = ticket.expiresAt - now;
                    const hoursLeft = timeLeft / (1000 * 60 * 60);

                    // Auto-close if expired
                    if (timeLeft <= 0) {
                        ticket.state = 'CLOSED';
                        showNotification(`üîí Ticket #${ticket.id} auto-closed due to timeout`);
                    }
                    // Warn if 24 hours or less remaining and not already warned
                    else if (hoursLeft <= 24 && !ticket.autoCloseWarned) {
                        ticket.autoCloseWarned = true;
                        showNotification(`‚ö†Ô∏è Ticket #${ticket.id} will auto-close in ${Math.ceil(hoursLeft)} hours`);
                    }
                }
            });

            // Update displays
            renderActiveTickets();
            renderHistoryTickets();
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'warning-notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function getTimeLeftText(expiresAt) {
            const now = new Date();
            const timeLeft = expiresAt - now;

            if (timeLeft <= 0) return 'Expired';

            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

            if (days > 0) {
                return `${days}d ${hours}h left`;
            } else if (hours > 0) {
                return `${hours}h left`;
            } else {
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                return `${minutes}m left`;
            }
        }

        function getTimerClass(expiresAt) {
            const now = new Date();
            const timeLeft = expiresAt - now;
            const hoursLeft = timeLeft / (1000 * 60 * 60);

            if (timeLeft <= 0) return 'urgent';
            if (hoursLeft <= 24) return 'warning';
            return '';
        }

        // File handling
        let attachedFiles = [];

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            files.forEach(file => {
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    alert(`File "${file.name}" is too large. Maximum size is 10MB.`);
                    return;
                }

                const fileObj = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    file: file
                };

                attachedFiles.push(fileObj);
                displayAttachedFiles();
            });

            // Clear the input
            e.target.value = '';
        });

        function displayAttachedFiles() {
            const container = document.getElementById('attachedFiles');
            container.innerHTML = '';

            attachedFiles.forEach(fileObj => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';

                const fileIcon = getFileIcon(fileObj.type);
                const fileSize = formatFileSize(fileObj.size);

                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-icon">${fileIcon}</div>
                        <div class="file-details">
                            <h4>${fileObj.name}</h4>
                            <p>${fileSize}</p>
                        </div>
                    </div>
                    <span class="file-remove" onclick="removeFile('${fileObj.id}')">√ó</span>
                `;

                container.appendChild(fileItem);
            });
        }

        function getFileIcon(fileType) {
            if (fileType.startsWith('image/')) return 'üñºÔ∏è';
            if (fileType.startsWith('video/')) return 'üé•';
            if (fileType.includes('pdf')) return 'üìÑ';
            if (fileType.includes('doc')) return 'üìù';
            return 'üìé';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function removeFile(fileId) {
            attachedFiles = attachedFiles.filter(file => file.id != fileId);
            displayAttachedFiles();
        }

        // Tab switching functionality
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (tabName === 'myTickets') {
                document.getElementById('myTicketsTab').classList.add('active');
                document.getElementById('myTicketsContent').classList.add('active');
            } else if (tabName === 'allTickets') {
                document.getElementById('allTicketsTab').classList.add('active');
                document.getElementById('allTicketsContent').classList.add('active');
            }
        }

        // Render ticket element
        function createTicketElement(ticket) {
            const ticketElement = document.createElement('div');
            const timerClass = getTimerClass(ticket.expiresAt);
            const isCreator = ticket.creator === currentUser;

            ticketElement.className = `active-ticket ${timerClass}`;
            ticketElement.onclick = function(e) {
                if (!e.target.classList.contains('ticket-btn')) {
                    openChat(ticket.title, ticket.description, ticket.id);
                }
            };

            const icon = ticket.problemType === 'General Question' ? '‚ùì' : '‚ö†Ô∏è';
            const iconClass = ticket.problemType === 'General Question' ? 'question-icon' : 'problem-icon';

            ticketElement.innerHTML = `
                <div class="ticket-timer ${timerClass}">${getTimeLeftText(ticket.expiresAt)}</div>
                <div class="item-header">
                    <div class="item-left">
                        <div class="type-icon ${iconClass}">${icon}</div>
                        <div>
                            <div class="item-title">${ticket.title}${isCreator ? '<span class="creator-badge">YOU</span>' : ''}${ticket.lastUpdatedAt ? '<span class="updated-badge">UPDATED</span>' : ''}</div>
                            <div class="item-description">${ticket.description}</div>
                        </div>
                    </div>
                    <span>‚Üí</span>
                </div>
                <div class="item-tags">
                    <div class="tag">${ticket.machineCategory}</div>
                    <div class="tag">${ticket.problemType}</div>
                    <div class="tag">${ticket.priority}</div>
                    <div class="status-tag ${ticket.resolution === 'SOLVED' ? 'solved-tag' : 'unsolved-tag'}">${ticket.resolution}</div>
                </div>
                <div class="item-footer">
                    <span>by ${ticket.creator}</span>
                    <span>${formatTimestamp(ticket.createdAt)}</span>
                    <span style="color: #2196F3; font-weight: 600;">#${ticket.id}</span>
                </div>
                ${isCreator ? `
                    <div class="ticket-actions">
                        <button class="ticket-btn edit" onclick="editTicket(${ticket.id})">‚úèÔ∏è Edit</button>
                        <button class="ticket-btn extend" onclick="extendTicket(${ticket.id})">üîÑ Extend +3d</button>
                        <button class="ticket-btn close" onclick="closeTicket(${ticket.id})">üîí Close</button>
                        <button class="ticket-btn ${ticket.resolution === 'SOLVED' ? 'unsolve' : 'solve'}" onclick="toggleResolution(${ticket.id})">
                            ${ticket.resolution === 'SOLVED' ? '‚ùå Mark Unsolved' : '‚úÖ Mark Solved'}
                        </button>
                    </div>
                ` : ''}
            `;

            return ticketElement;
        }

        // Render active tickets with tabs
        function renderActiveTickets() {
            const activeTickets = tickets.filter(t => t.state === 'ACTIVE');
            const myTickets = activeTickets.filter(t => t.creator === currentUser);
            const allTickets = activeTickets;

            // Update tab counts
            document.getElementById('myTicketsCount').textContent = myTickets.length;
            document.getElementById('allTicketsCount').textContent = allTickets.length;

            // Render My Tickets tab
            const myContainer = document.getElementById('myTicketsContainer');
            const myEmptyState = document.getElementById('myTicketsEmptyState');

            myContainer.innerHTML = '';

            if (myTickets.length === 0) {
                myEmptyState.style.display = 'block';
            } else {
                myEmptyState.style.display = 'none';
                myTickets.forEach(ticket => {
                    myContainer.appendChild(createTicketElement(ticket));
                });
            }

            // Render All Tickets tab
            const allContainer = document.getElementById('allTicketsContainer');
            const allEmptyState = document.getElementById('allTicketsEmptyState');

            allContainer.innerHTML = '';

            if (allTickets.length === 0) {
                allEmptyState.style.display = 'block';
            } else {
                allEmptyState.style.display = 'none';
                allTickets.forEach(ticket => {
                    allContainer.appendChild(createTicketElement(ticket));
                });
            }
        }

        // Render history tickets (closed only) with filtering
        function renderHistoryTickets() {
            const historyContainer = document.querySelector('#historyScreen');
            const existingItems = historyContainer.querySelectorAll('.history-item');

            // Remove all existing history items except demo ones
            existingItems.forEach(item => {
                const id = item.getAttribute('data-ticket-id');
                if (id) {
                    item.remove();
                }
            });

            const closedTickets = tickets.filter(t => t.state === 'CLOSED');
            const filteredTickets = filterTickets(closedTickets);

            // Update results count
            updateResultsCount(filteredTickets.length, closedTickets.length);

            // Find insertion point (after results count)
            const resultsCount = historyContainer.querySelector('#resultsCount');
            let insertAfter = resultsCount;

            // Show all existing demo items if no filters applied
            const demoItems = historyContainer.querySelectorAll('.history-item:not([data-ticket-id])');
            if (Object.values(currentFilters).every(f => !f)) {
                demoItems.forEach(item => item.style.display = 'block');
            } else {
                // Hide demo items when filters are active and filter them too
                demoItems.forEach(item => {
                    // Try to extract data from demo items for filtering
                    const title = item.querySelector('.item-title')?.textContent || '';
                    const description = item.querySelector('.item-description')?.textContent || '';
                    const tags = Array.from(item.querySelectorAll('.tag')).map(tag => tag.textContent);
                    const machineCategory = tags[0] || '';
                    const problemType = tags[1] || '';
                    const resolution = item.querySelector('.solved-tag') ? 'SOLVED' : 'UNSOLVED';

                    const demoTicket = {
                        title: title,
                        description: description,
                        machineCategory: machineCategory,
                        problemType: problemType,
                        resolution: resolution
                    };

                    const matches = filterTickets([demoTicket]).length > 0;
                    item.style.display = matches ? 'block' : 'none';
                });
            }

            filteredTickets.forEach(ticket => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.setAttribute('data-ticket-id', ticket.id);
                historyItem.onclick = function() {
                    openSummary(ticket);
                };

                const icon = ticket.problemType === 'General Question' ? '‚ùì' : '‚ö†Ô∏è';
                const iconClass = ticket.problemType === 'General Question' ? 'question-icon' : 'problem-icon';
                const statusTag = ticket.resolution === 'SOLVED' ? 'solved-tag' : 'unsolved-tag';

                historyItem.innerHTML = `
                    <div class="item-header">
                        <div class="item-left">
                            <div class="type-icon ${iconClass}">${icon}</div>
                            <div>
                                <div class="item-title">${ticket.title}</div>
                                <div class="item-description">${ticket.description}</div>
                            </div>
                        </div>
                        <span>‚Üí</span>
                    </div>
                    <div class="item-tags">
                        <div class="tag">${ticket.machineCategory}</div>
                        <div class="tag">${ticket.problemType}</div>
                        <div class="status-tag ${statusTag}">${ticket.resolution}</div>
                    </div>
                    <div class="item-footer">
                        <span>by ${ticket.creator}</span>
                        <span>${formatTimestamp(ticket.createdAt)}</span>
                        <span style="color: #2196F3; font-weight: 600;">#${ticket.id}</span>
                    </div>
                `;

                insertAfter.parentNode.insertBefore(historyItem, insertAfter.nextSibling);
                insertAfter = historyItem;
            });
        }

        // Ticket action functions
        function extendTicket(ticketId) {
            const ticket = tickets.find(t => t.id === ticketId);
            if (ticket && ticket.creator === currentUser) {
                const now = new Date();
                ticket.expiresAt = new Date(now.getTime() + 3 * 24 * 60 * 60 * 1000); // +3 days
                ticket.autoCloseWarned = false;
                showNotification(`‚úÖ Ticket #${ticketId} extended by 3 days`);
                renderActiveTickets();
            }
        }

        function closeTicket(ticketId) {
            const ticket = tickets.find(t => t.id === ticketId);
            if (ticket && ticket.creator === currentUser) {
                ticket.state = 'CLOSED';
                showNotification(`üîí Ticket #${ticketId} closed`);
                renderActiveTickets();
                renderHistoryTickets();
            }
        }

        function toggleResolution(ticketId) {
            const ticket = tickets.find(t => t.id === ticketId);
            if (ticket && ticket.creator === currentUser) {
                if (ticket.resolution === 'SOLVED') {
                    // Mark as unsolved - no rating needed
                    ticket.resolution = 'UNSOLVED';
                    showNotification('‚ùå Ticket #' + ticketId + ' marked as unsolved');
                    renderActiveTickets();
                } else {
                    // Mark as solved - show solver selection modal
                    showSolverModal(ticketId);
                }
            }
        }

        // Fishbone Diagram - Track selections
        function updateFishboneSummary() {
            const categories = ['man', 'machine', 'method', 'material', 'measurement', 'environment'];
            const selected = [];

            categories.forEach(category => {
                // Get checked checkboxes
                const checkboxes = document.querySelectorAll(`input[name="fishbone_${category}"]:checked`);
                checkboxes.forEach(cb => {
                    selected.push(`${category.toUpperCase()}: ${cb.value}`);
                });

                // Get custom text input
                const customInput = document.getElementById(`fishbone_${category}_other`);
                if (customInput && customInput.value.trim()) {
                    selected.push(`${category.toUpperCase()}: ${customInput.value.trim()}`);
                }
            });

            const summaryDiv = document.getElementById('fishboneSummary');
            const summaryContent = document.getElementById('fishboneSummaryContent');

            if (selected.length > 0) {
                summaryDiv.style.display = 'block';
                summaryContent.innerHTML = selected.map(item => `‚Ä¢ ${item}`).join('<br>');
            } else {
                summaryDiv.style.display = 'none';
            }

            return selected;
        }

        // Add event listeners to all fishbone inputs
        document.addEventListener('DOMContentLoaded', function() {
            const fishboneCheckboxes = document.querySelectorAll('.fishbone-section input[type="checkbox"]');
            const fishboneTextInputs = document.querySelectorAll('.fishbone-section input[type="text"]');

            fishboneCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateFishboneSummary);
            });

            fishboneTextInputs.forEach(input => {
                input.addEventListener('input', updateFishboneSummary);
            });
        });

        // Track if we're editing an existing ticket
        let editingTicketId = null;

        // Edit Ticket Function - Allows creator to update their issue
        function editTicket(ticketId) {
            const ticket = tickets.find(t => t.id === ticketId);
            if (!ticket) {
                alert('‚ùå Ticket not found!');
                return;
            }

            // Only creator can edit
            if (ticket.creator !== currentUser) {
                alert('‚ùå You can only edit your own tickets!');
                return;
            }

            // Store editing ticket ID
            editingTicketId = ticketId;

            // Populate form with ticket data
            document.getElementById('submissionTitleInput').value = ticket.title;
            document.getElementById('submissionDescription').value = ticket.description;
            document.getElementById('machineCategory').value = ticket.machineCategory;
            document.getElementById('problemType').value = ticket.problemType;
            document.getElementById('priorityLevel').value = ticket.priority;

            // Restore fishbone analysis if exists
            if (ticket.fishboneAnalysis && ticket.fishboneAnalysis.length > 0) {
                // First clear all selections
                document.querySelectorAll('.fishbone-section input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('.fishbone-section input[type="text"]').forEach(input => input.value = '');

                // Restore selections
                ticket.fishboneAnalysis.forEach(cause => {
                    // Parse format "CATEGORY: Value"
                    const parts = cause.split(': ');
                    if (parts.length === 2) {
                        const category = parts[0].toLowerCase();
                        const value = parts[1];

                        // Try to find matching checkbox
                        const checkbox = document.querySelector(`input[name="fishbone_${category}"][value="${value}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                        } else {
                            // Must be custom input
                            const customInput = document.getElementById(`fishbone_${category}_other`);
                            if (customInput) {
                                customInput.value = value;
                            }
                        }
                    }
                });

                // Update summary
                updateFishboneSummary();
            }

            // Update form title to show editing mode
            document.getElementById('submissionTitle').textContent = '‚úèÔ∏è Edit Problem Report';
            document.querySelector('.btn-primary').textContent = 'Update';

            // Show form
            showScreen('submissionScreen');
        }

        // Form submission - now creates ACTIVE tickets or updates existing ones
        document.getElementById('submissionForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const now = new Date();
            const fishboneCauses = updateFishboneSummary();

            const title = document.getElementById('submissionTitleInput').value.trim();
            const description = document.getElementById('submissionDescription').value.trim();
            const machineCategory = document.getElementById('machineCategory').value;
            const problemType = document.getElementById('problemType').value || 'General Question';
            const priority = document.getElementById('priorityLevel').value;

            if (!title || !machineCategory || !description) {
                alert('Please fill in all required fields.');
                return;
            }

            // Check if we're editing or creating
            if (editingTicketId) {
                // UPDATE existing ticket
                const ticketIndex = tickets.findIndex(t => t.id === editingTicketId);
                if (ticketIndex !== -1) {
                    const ticket = tickets[ticketIndex];

                    // Track update history
                    if (!ticket.updateHistory) {
                        ticket.updateHistory = [];
                    }
                    ticket.updateHistory.push({
                        updatedAt: now,
                        updatedBy: currentUser,
                        changes: {
                            title: { old: ticket.title, new: title },
                            description: { old: ticket.description, new: description },
                            machineCategory: { old: ticket.machineCategory, new: machineCategory },
                            problemType: { old: ticket.problemType, new: problemType },
                            priority: { old: ticket.priority, new: priority },
                            fishboneAnalysis: {
                                old: ticket.fishboneAnalysis,
                                new: fishboneCauses.length > 0 ? fishboneCauses : null
                            }
                        }
                    });

                    // Update ticket data
                    ticket.title = title;
                    ticket.description = description;
                    ticket.machineCategory = machineCategory;
                    ticket.problemType = problemType;
                    ticket.priority = priority;
                    ticket.fishboneAnalysis = fishboneCauses.length > 0 ? fishboneCauses : null;
                    ticket.lastUpdatedAt = now;
                    ticket.files = [...attachedFiles];

                    // Show success message
                    alert('‚úÖ Ticket updated successfully!');
                }

                // Clear editing state
                editingTicketId = null;
                document.getElementById('submissionTitle').textContent = 'Report Problem';
                document.querySelector('.btn-primary').textContent = 'Submit';
            } else {
                // CREATE new ticket
                const formData = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    machineCategory: machineCategory,
                    problemType: problemType,
                    priority: priority,
                    creator: currentUser,
                    state: 'ACTIVE',
                    resolution: 'UNSOLVED',
                    createdAt: now,
                    expiresAt: new Date(now.getTime() + 3 * 24 * 60 * 60 * 1000), // +3 days
                    autoCloseWarned: false,
                    files: [...attachedFiles],
                    fishboneAnalysis: fishboneCauses.length > 0 ? fishboneCauses : null,
                    updateHistory: []
                };

                // Add to tickets array
                tickets.push(formData);

                // Show success message
                alert('‚úÖ Successfully submitted! Check Active Issues to manage your ticket.');
            }

            // Reset form and go back
            resetForm();
            showScreen('roomDetailScreen');

            // Update displays
            renderActiveTickets();
        });

        function addToHistory(submission) {
            const historyContainer = document.querySelector('#historyScreen');
            const firstHistoryItem = historyContainer.querySelector('.history-item');

            // Create new history item
            const newHistoryItem = document.createElement('div');
            newHistoryItem.className = 'history-item';
            newHistoryItem.onclick = function() {
                openChat(submission.title, submission.description);
            };

            const isQuestion = document.getElementById('submissionTitle').textContent === 'Ask Question';
            const icon = isQuestion ? '‚ùì' : '‚ö†Ô∏è';
            const iconClass = isQuestion ? 'question-icon' : 'problem-icon';
            const statusTag = submission.status === 'SOLVED' ? 'solved-tag' : 'unsolved-tag';

            newHistoryItem.innerHTML = `
                <div class="item-header">
                    <div class="item-left">
                        <div class="type-icon ${iconClass}">${icon}</div>
                        <div>
                            <div class="item-title">${submission.title}</div>
                            <div class="item-description">${submission.description}</div>
                        </div>
                    </div>
                    <span>‚Üí</span>
                </div>
                <div class="item-tags">
                    <div class="tag">${submission.machineCategory}</div>
                    <div class="tag">${submission.problemType || 'Question'}</div>
                    <div class="status-tag ${statusTag}">${submission.status}</div>
                </div>
                <div class="item-footer">
                    <span>by ${submission.author}</span>
                    <span>${formatTimestamp(submission.timestamp)}</span>
                    <span style="color: #2196F3; font-weight: 600;">#${submission.id}</span>
                </div>
            `;

            // Insert at the top (after the highlight box)
            const highlightBox = historyContainer.querySelector('.highlight');
            highlightBox.parentNode.insertBefore(newHistoryItem, highlightBox.nextSibling);
        }

        function formatTimestamp(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min ago`;

            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `${diffHours}h ago`;

            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function resetForm() {
            document.getElementById('submissionForm').reset();
            attachedFiles = [];
            displayAttachedFiles();

            // Hide fishbone summary
            document.getElementById('fishboneSummary').style.display = 'none';
            document.getElementById('fishboneSummaryContent').innerHTML = '';

            // Clear editing state
            editingTicketId = null;
            document.getElementById('submissionTitle').textContent = 'Report Problem';
            document.querySelector('.btn-primary').textContent = 'Submit';
        }

        // Initialize app
        function initializeApp() {
            initializeDemoTickets();
            renderActiveTickets();
            renderHistoryTickets();

            // Set up timer to check for auto-close every minute
            setInterval(updateTicketTimers, 60000);

            // Initial timer check
            updateTicketTimers();
        }

        // Remove the old addToHistory function since we now use the ticket system
        function addToHistory(submission) {
            // This is now handled by the ticket system
        }

        // Filter functionality for History page
        let currentFilters = {
            search: '',
            resolution: '',
            machine: '',
            problemType: ''
        };

        function applyFilters() {
            // Get current filter values
            currentFilters.search = document.getElementById('searchInput').value.toLowerCase();
            currentFilters.resolution = document.getElementById('resolutionFilter').value;
            currentFilters.machine = document.getElementById('machineFilter').value;
            currentFilters.problemType = document.getElementById('problemTypeFilter').value;

            // Update filter chips
            updateFilterChips();

            // Re-render history with filters
            renderHistoryTickets();

            // Update statistics since dashboard is always visible
            updateStatistics();
        }

        function updateFilterChips() {
            const chipsContainer = document.getElementById('activeFilters');
            chipsContainer.innerHTML = '';

            const filters = [];

            if (currentFilters.search) {
                filters.push({ type: 'search', label: `Search: "${currentFilters.search}"`, value: currentFilters.search });
            }
            if (currentFilters.resolution) {
                filters.push({ type: 'resolution', label: `Status: ${currentFilters.resolution}`, value: currentFilters.resolution });
            }
            if (currentFilters.machine) {
                filters.push({ type: 'machine', label: `Machine: ${currentFilters.machine}`, value: currentFilters.machine });
            }
            if (currentFilters.problemType) {
                filters.push({ type: 'problemType', label: `Type: ${currentFilters.problemType}`, value: currentFilters.problemType });
            }

            filters.forEach(filter => {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.innerHTML = `
                    ${filter.label}
                    <span class="remove" onclick="removeFilter('${filter.type}')">√ó</span>
                `;
                chipsContainer.appendChild(chip);
            });
        }

        function removeFilter(filterType) {
            currentFilters[filterType] = '';

            // Update UI elements
            if (filterType === 'search') document.getElementById('searchInput').value = '';
            if (filterType === 'resolution') document.getElementById('resolutionFilter').value = '';
            if (filterType === 'machine') document.getElementById('machineFilter').value = '';
            if (filterType === 'problemType') document.getElementById('problemTypeFilter').value = '';

            applyFilters();
        }

        function clearAllFilters() {
            currentFilters = { search: '', resolution: '', machine: '', problemType: '' };

            // Clear all UI elements
            document.getElementById('searchInput').value = '';
            document.getElementById('resolutionFilter').value = '';
            document.getElementById('machineFilter').value = '';
            document.getElementById('problemTypeFilter').value = '';

            applyFilters();
        }

        function filterTickets(tickets) {
            return tickets.filter(ticket => {
                // Search filter
                if (currentFilters.search) {
                    const searchTerm = currentFilters.search;
                    const titleMatch = ticket.title.toLowerCase().includes(searchTerm);
                    const descMatch = ticket.description.toLowerCase().includes(searchTerm);
                    const machineMatch = ticket.machineCategory.toLowerCase().includes(searchTerm);

                    if (!titleMatch && !descMatch && !machineMatch) {
                        return false;
                    }
                }

                // Resolution filter
                if (currentFilters.resolution && ticket.resolution !== currentFilters.resolution) {
                    return false;
                }

                // Machine filter
                if (currentFilters.machine && ticket.machineCategory !== currentFilters.machine) {
                    return false;
                }

                // Problem type filter
                if (currentFilters.problemType && ticket.problemType !== currentFilters.problemType) {
                    return false;
                }

                return true;
            });
        }

        function updateResultsCount(filteredCount, totalCount) {
            const resultsElement = document.getElementById('resultsCount');
            if (filteredCount === totalCount) {
                resultsElement.textContent = `Showing all ${totalCount} tickets`;
            } else {
                resultsElement.textContent = `Showing ${filteredCount} of ${totalCount} tickets`;
            }
        }

        // Summary modal functions
        function openSummary(ticket) {
            // Populate summary modal with ticket data
            document.getElementById('summaryTitle').textContent = ticket.title;

            const meta = document.getElementById('summaryMeta');
            meta.innerHTML = `
                <span>Ticket #${ticket.id}</span>
                <span>Created ${formatTimestamp(ticket.createdAt)}</span>
                <span>by ${ticket.creator}</span>
            `;

            // Update tags
            const tagsContainer = document.getElementById('summaryTags');
            const statusClass = ticket.resolution === 'SOLVED' ? 'status' : 'status unsolved';
            tagsContainer.innerHTML = `
                <div class="summary-tag">${ticket.machineCategory}</div>
                <div class="summary-tag">${ticket.problemType}</div>
                <div class="summary-tag ${statusClass}">${ticket.resolution}</div>
            `;

            // Update description
            document.getElementById('summaryDescription').textContent = ticket.description;

            // Display meeting points from ticket's chat history
            const meetingPoints = ticketChats[ticket.id] ? ticketChats[ticket.id].meetingPoints : [];
            displayMeetingPoints(meetingPoints);

            // Update resolution info
            const resolutionInfo = document.getElementById('resolutionInfo');
            if (ticket.resolution === 'SOLVED') {
                resolutionInfo.className = 'resolution-info';
                resolutionInfo.innerHTML = `
                    <div class="resolution-icon">‚úÖ</div>
                    <div class="resolution-text">Issue Resolved</div>
                    <div style="font-size: 14px; margin-top: 8px; opacity: 0.8;">This ticket was closed and marked as solved.</div>
                `;
            } else {
                resolutionInfo.className = 'resolution-info unsolved';
                resolutionInfo.innerHTML = `
                    <div class="resolution-icon">‚è∞</div>
                    <div class="resolution-text unsolved">Issue Unresolved</div>
                    <div style="font-size: 14px; margin-top: 8px; opacity: 0.8;">This ticket was closed but the issue remains unresolved.</div>
                `;
            }

            // Show modal
            document.getElementById('summaryModal').classList.add('show');
        }

        function displayAttachments(attachments) {
            const container = document.getElementById('attachmentsContainer');

            if (!attachments || attachments.length === 0) {
                container.innerHTML = '<div class="no-attachments">No attachments for this ticket</div>';
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'attachments-grid';

            attachments.forEach(attachment => {
                const card = document.createElement('div');
                card.className = 'attachment-card';
                card.onclick = () => alert(`Opening: ${attachment.name}`);

                let content = '';
                if (attachment.type === 'image') {
                    content = `
                        <img src="${attachment.url}" alt="${attachment.name}" class="attachment-preview"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div class="attachment-icon" style="display:none;">üì∑</div>
                    `;
                } else if (attachment.type === 'video') {
                    content = '<div class="attachment-icon">üé•</div>';
                } else {
                    content = '<div class="attachment-icon">üìÑ</div>';
                }

                content += `
                    <div class="attachment-name">${attachment.name}</div>
                    <div class="attachment-size">${attachment.size}</div>
                `;

                card.innerHTML = content;
                grid.appendChild(card);
            });

            container.innerHTML = '';
            container.appendChild(grid);
        }

        function openDemoSummary(title, description, machine, problemType, resolution, ticketId, creator, timestamp, attachments) {
            // Handle demo tickets
            const demoTicket = {
                id: ticketId,
                title: title,
                description: description,
                machineCategory: machine,
                problemType: problemType,
                resolution: resolution,
                creator: creator,
                createdAt: new Date() // Will be overridden by timestamp display
            };

            // Populate summary modal
            document.getElementById('summaryTitle').textContent = title;

            const meta = document.getElementById('summaryMeta');
            meta.innerHTML = `
                <span>Ticket #${ticketId}</span>
                <span>Created ${timestamp}</span>
                <span>by ${creator}</span>
            `;

            // Update tags
            const tagsContainer = document.getElementById('summaryTags');
            const statusClass = resolution === 'SOLVED' ? 'status' : 'status unsolved';
            tagsContainer.innerHTML = `
                <div class="summary-tag">${machine}</div>
                <div class="summary-tag">${problemType}</div>
                <div class="summary-tag ${statusClass}">${resolution}</div>
            `;

            // Update description
            document.getElementById('summaryDescription').textContent = description;

            // Display attachments
            displayAttachments(attachments);

            // Display demo meeting points
            const demoMeetingPoints = getDemoMeetingPoints(title, problemType, resolution);
            displayMeetingPoints(demoMeetingPoints);

            // Update resolution info
            const resolutionInfo = document.getElementById('resolutionInfo');
            if (resolution === 'SOLVED') {
                resolutionInfo.className = 'resolution-info';
                resolutionInfo.innerHTML = `
                    <div class="resolution-icon">‚úÖ</div>
                    <div class="resolution-text">Issue Resolved</div>
                    <div style="font-size: 14px; margin-top: 8px; opacity: 0.8;">This ticket was closed and marked as solved.</div>
                `;
            } else {
                resolutionInfo.className = 'resolution-info unsolved';
                resolutionInfo.innerHTML = `
                    <div class="resolution-icon">‚è∞</div>
                    <div class="resolution-text unsolved">Issue Unresolved</div>
                    <div style="font-size: 14px; margin-top: 8px; opacity: 0.8;">This ticket was closed but the issue remains unresolved.</div>
                `;
            }

            // Show modal
            document.getElementById('summaryModal').classList.add('show');
        }

        function closeSummary() {
            document.getElementById('summaryModal').classList.remove('show');
        }

        function displayMeetingPoints(meetingPoints) {
            const container = document.getElementById('meetingPointsContent');

            if (!meetingPoints || meetingPoints.length === 0) {
                container.innerHTML = `
                    <div class="meeting-point">
                        <span class="point-icon">üìù</span>
                        <span class="point-text">No meeting points recorded yet for this ticket.</span>
                    </div>
                `;
                return;
            }

            container.innerHTML = meetingPoints.map(point => {
                // Extract icon from the beginning of the text if it exists
                const iconMatch = point.match(/^(\p{Emoji})/u);
                const icon = iconMatch ? iconMatch[1] : 'üìã';
                const text = point.replace(/^(\p{Emoji})\s*/u, '');

                return `
                    <div class="meeting-point">
                        <span class="point-icon">${icon}</span>
                        <span class="point-text">${text}</span>
                    </div>
                `;
            }).join('');
        }

        function getDemoMeetingPoints(title, problemType, resolution) {
            if (title.includes('overheating')) {
                return [
                    'üå°Ô∏è Temperature issue confirmed: Machine running 5¬∞C above normal range',
                    'üîç Root cause identified: Cooling fan #3 bearing worn, running slower',
                    'üìã Action required: Order replacement bearings for fan #3',
                    '‚è±Ô∏è Timeline: Issue will persist until parts arrive and replacement completed',
                    'üë§ Assigned: Technician Mike to handle replacement when parts arrive'
                ];
            } else if (title.includes('Production line')) {
                return [
                    'üéØ Goal: Increase packaging speed from 120 to 150 units/min for new juice box line',
                    '‚öôÔ∏è Settings optimized: Conveyor 85%, Pressure 12 PSI, Cycle timing 2.5s',
                    'üîß Folding mechanism adjusted: Tension set to level 7 for juice boxes',
                    'üìà Result: Final speed 152 units/min - target exceeded by 2 units/min',
                    '‚úÖ Resolution: Production targets achieved, settings documented for future use'
                ];
            } else if (title.includes('Electrical fault')) {
                return [
                    '‚ö° Issue: Power fluctuations every 9 minutes, voltage drops from 220V to 205V',
                    'üîç Investigation: Focused on panel C3 connections and load balancing',
                    'üîß Root cause: Loose connection found in panel C3, terminal 7',
                    '‚úÖ Solution: Connection tightened and system tested',
                    'üìä Verification: 24-hour monitoring confirmed stable power supply'
                ];
            } else {
                return [
                    'üìã Issue reported and team notified',
                    'üîç Investigation initiated by relevant specialists',
                    '‚öôÔ∏è Diagnostic procedures completed',
                    resolution === 'SOLVED' ? '‚úÖ Issue resolved successfully' : '‚è∞ Resolution still in progress'
                ];
            }
        }

        // Close summary modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('summary-modal')) {
                closeSummary();
            }
        });

        // Statistics Dashboard Functions


        function updateStatistics() {
            // Get all closed tickets (both filtered and unfiltered)
            const allClosedTickets = [...tickets.filter(t => t.state === 'CLOSED')];

            // Add demo tickets to the calculation
            const demoTickets = [
                { resolution: 'UNSOLVED', machineCategory: 'Alpha Machine', problemType: 'Mechanical', priority: 'High' },
                { resolution: 'SOLVED', machineCategory: 'Beta Machine', problemType: 'General Question', priority: 'Medium' },
                { resolution: 'SOLVED', machineCategory: 'Gamma Machine', problemType: 'Electrical', priority: 'Critical' }
            ];

            const allTickets = [...allClosedTickets, ...demoTickets];

            // Calculate resolution rate
            const solvedCount = allTickets.filter(t => t.resolution === 'SOLVED').length;
            const unsolvedCount = allTickets.filter(t => t.resolution === 'UNSOLVED').length;
            const totalCount = allTickets.length;
            const resolutionRate = totalCount > 0 ? Math.round((solvedCount / totalCount) * 100) : 0;

            // Update resolution rate card
            document.getElementById('resolutionRate').textContent = `${resolutionRate}%`;
            document.getElementById('solvedCount').textContent = `${solvedCount} solved`;
            document.getElementById('unsolvedCount').textContent = `${unsolvedCount} unsolved`;
            document.getElementById('resolutionProgress').style.width = `${resolutionRate}%`;

            // Update total tickets
            document.getElementById('totalTickets').textContent = totalCount;


            // Calculate problem type distribution
            const problemTypes = {};
            allTickets.forEach(ticket => {
                problemTypes[ticket.problemType] = (problemTypes[ticket.problemType] || 0) + 1;
            });

            updateProblemTypeStats(problemTypes, totalCount);

            // Calculate priority distribution
            const priorities = {};
            allTickets.forEach(ticket => {
                priorities[ticket.priority] = (priorities[ticket.priority] || 0) + 1;
            });

            updatePriorityStats(priorities);

        }

        function updateProblemTypeStats(problemTypes, total) {
            const typeOrder = ['Mechanical', 'Electrical', 'General Question', 'Software', 'Quality', 'Safety'];
            const container = document.getElementById('problemTypeStats');

            const sortedTypes = typeOrder
                .map(type => ({
                    type: type === 'General Question' ? 'Questions' : type,
                    count: problemTypes[type] || 0,
                    percentage: total > 0 ? (problemTypes[type] || 0) / total * 100 : 0
                }))
                .filter(item => item.count > 0)
                .sort((a, b) => b.count - a.count)
                .slice(0, 3); // Show top 3

            container.innerHTML = sortedTypes.map(item => `
                <div class="problem-type-item">
                    <span class="type-label">${item.type}</span>
                    <span class="type-count">${item.count}</span>
                    <div class="type-bar">
                        <div class="type-progress" style="width: ${item.percentage}%"></div>
                    </div>
                </div>
            `).join('');
        }

        function updatePriorityStats(priorities) {
            const priorityOrder = ['Critical', 'High', 'Medium', 'Low'];
            const colors = ['critical', 'high', 'medium', 'low'];

            const container = document.getElementById('priorityStats');

            container.innerHTML = priorityOrder.map((priority, index) => `
                <div class="priority-item ${colors[index]}">
                    <span class="priority-dot"></span>
                    <span class="priority-label">${priority}</span>
                    <span class="priority-count">${priorities[priority] || 0}</span>
                </div>
            `).join('');
        }

        // Leaderboard Functions
        function updateLeaderboard() {
            const sortedUsers = Object.entries(userProfiles)
                .sort((a, b) => b[1].points - a[1].points);

            updatePodium(sortedUsers.slice(0, 3));
            updateTeamList(sortedUsers);
        }

        function updatePodium(topThree) {
            const podiumContainer = document.getElementById('podiumContainer');
            podiumContainer.innerHTML = '';

            const positions = ['second', 'first', 'third'];
            const medals = ['ü•à', 'ü•á', 'ü•â'];
            const order = [1, 0, 2]; // Display order: 2nd, 1st, 3rd

            order.forEach((index, displayIndex) => {
                if (topThree[index]) {
                    const [userName, profile] = topThree[index];
                    const podiumItem = document.createElement('div');
                    podiumItem.className = `podium-item ${positions[index]}`;
                    podiumItem.innerHTML = `
                        <div class="podium-profile" onclick="showProfile('${userName}')">
                            <div class="podium-avatar">${getInitials(userName)}</div>
                            <div class="podium-medal">${medals[index]}</div>
                        </div>
                        <div class="podium-info">
                            <h4>${userName}</h4>
                            <p>${profile.points} pts</p>
                        </div>
                        <div class="podium-bar ${positions[index]}"></div>
                    `;
                    podiumContainer.appendChild(podiumItem);
                }
            });
        }

        function updateTeamList(sortedUsers) {
            const teamList = document.getElementById('teamList');
            teamList.innerHTML = '';

            // Skip top 3 (already shown in podium)
            const restOfTeam = sortedUsers.slice(3);

            restOfTeam.forEach(([userName, profile], index) => {
                const rank = index + 4; // Rank starts from 4 (after top 3)
                const isCurrentUser = userName === currentUser;

                const teamMember = document.createElement('div');
                teamMember.className = `team-member ${isCurrentUser ? 'current-user-row' : ''}`;
                teamMember.onclick = () => showProfile(userName);

                const trendClass = Math.random() > 0.5 ? 'up' : 'down';
                const trendValue = Math.floor(Math.random() * 20) + 1;
                const trendSign = trendClass === 'up' ? '+' : '-';

                teamMember.innerHTML = `
                    <div class="member-rank">#${rank}</div>
                    <div class="member-avatar ${isCurrentUser ? 'current' : ''}">${getInitials(userName)}</div>
                    <div class="member-info">
                        <h4>${userName}${isCurrentUser ? ' <span class="you-badge">YOU</span>' : ''}</h4>
                        <p>${profile.points} pts ‚Ä¢ ${profile.ticketsSolved} solved ‚Ä¢ ‚≠ê ${profile.averageRating}</p>
                    </div>
                    <div class="member-trend ${trendClass}">${trendSign}${trendValue}</div>
                `;

                teamList.appendChild(teamMember);
            });
        }

        // Profile Functions
        function showProfile(userName) {
            const profile = userProfiles[userName];
            if (!profile) return;

            const modal = document.getElementById('profileModal');

            // Update modal content
            document.getElementById('modalProfileName').textContent = `${userName} Profile`;
            document.getElementById('modalAvatar').textContent = getInitials(userName);
            document.getElementById('modalName').textContent = userName;
            document.getElementById('modalRole').textContent = getUserRole(userName);
            document.getElementById('modalPoints').textContent = profile.points;
            document.getElementById('modalSolved').textContent = profile.ticketsSolved;
            document.getElementById('modalRating').textContent = profile.averageRating;

            // Calculate rank
            const sortedUsers = Object.values(userProfiles).sort((a, b) => b.points - a.points);
            const rank = sortedUsers.findIndex(user => user.name === userName) + 1;
            document.getElementById('modalRank').textContent = `#${rank}`;

            // Update badges
            const badges = getUserBadges(profile);
            document.getElementById('modalBadges').innerHTML = badges.map(badge =>
                `<span class="badge ${badge.class}">${badge.text}</span>`
            ).join('');

            modal.classList.add('show');
        }

        function closeProfile() {
            document.getElementById('profileModal').classList.remove('show');
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase();
        }

        function getUserRole(userName) {
            const roles = {
                'Mike Johnson': 'Senior Technician',
                'John Smith': 'Lead Engineer',
                'Alex Rodriguez': 'Maintenance Specialist',
                'Sarah Wilson': 'Quality Inspector',
                'Emma Davis': 'Operations Assistant',
                'Current User': 'Team Member'
            };
            return roles[userName] || 'Team Member';
        }

        function getUserBadges(profile) {
            const badges = [];

            if (profile.averageRating >= 4.5) {
                badges.push({ class: 'expert', text: '‚≠ê Expert Solver' });
            }
            if (profile.ticketsSolved >= 20) {
                badges.push({ class: 'speed', text: '‚ö° Super Solver' });
            } else if (profile.ticketsSolved >= 10) {
                badges.push({ class: 'speed', text: '‚ö° Quick Response' });
            }
            if (profile.points >= 100) {
                badges.push({ class: 'helpful', text: 'üèÜ High Performer' });
            }
            badges.push({ class: 'helpful', text: 'ü§ù Team Player' });

            return badges;
        }

        // Solver Modal Functions
        let currentSolverTicketId = null;
        let selectedRating = 0;

        function showSolverModal(ticketId) {
            currentSolverTicketId = ticketId;
            const modal = document.getElementById('solverModal');
            const select = document.getElementById('solverSelect');

            // Clear previous selections
            select.innerHTML = '<option value="">Choose from chat participants...</option>';
            selectedRating = 0;
            updateStarDisplay();
            document.getElementById('solverComment').value = '';

            // Populate dropdown with chat participants
            const participants = ticketParticipants[ticketId] || new Set();
            participants.forEach(participant => {
                if (participant !== currentUser) { // Don't include the ticket creator
                    const option = document.createElement('option');
                    option.value = participant;
                    option.textContent = participant;
                    select.appendChild(option);
                }
            });

            modal.classList.add('show');
        }

        function closeSolverModal() {
            document.getElementById('solverModal').classList.remove('show');
            currentSolverTicketId = null;
            selectedRating = 0;
        }

        function submitSolverRating() {
            const solver = document.getElementById('solverSelect').value;
            const comment = document.getElementById('solverComment').value;

            if (!solver) {
                alert('Please select who solved the issue');
                return;
            }

            if (selectedRating === 0) {
                alert('Please rate the solution (1-5 stars)');
                return;
            }

            // Update ticket resolution
            const ticket = tickets.find(t => t.id === currentSolverTicketId);
            if (ticket) {
                ticket.resolution = 'SOLVED';
                ticket.solver = solver;
                ticket.rating = selectedRating;
                ticket.solverComment = comment;

                // Award points to solver
                awardPoints(solver, selectedRating);

                showNotification(`‚úÖ Ticket #${currentSolverTicketId} marked as solved! ${solver} earned points.`);
                renderActiveTickets();
                updateStatistics(); // Update statistics
                updateCurrentUserProfile(); // Update current user profile if it changed
            }

            closeSolverModal();
        }

        function awardPoints(solver, rating) {
            if (!userProfiles[solver]) {
                userProfiles[solver] = {
                    name: solver,
                    points: 0,
                    ticketsSolved: 0,
                    totalRatings: 0,
                    averageRating: 0
                };
            }

            const profile = userProfiles[solver];

            // Base points: 10 for solving + 2 per star rating
            const pointsEarned = 10 + (rating * 2);

            // Quick resolution bonus (simulate - in real app would check timestamps)
            const bonus = Math.random() > 0.5 ? 5 : 0; // 50% chance of quick bonus

            profile.points += pointsEarned + bonus;
            profile.ticketsSolved += 1;

            // Update average rating
            const totalRatingPoints = (profile.averageRating * profile.totalRatings) + rating;
            profile.totalRatings += 1;
            profile.averageRating = Math.round((totalRatingPoints / profile.totalRatings) * 10) / 10;

            // Update leaderboard display
            updateLeaderboard();
        }

        // Star rating functionality
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('star')) {
                selectedRating = parseInt(e.target.dataset.rating);
                updateStarDisplay();
            }
        });

        function updateStarDisplay() {
            const stars = document.querySelectorAll('.star');
            const ratingText = document.getElementById('ratingText');

            stars.forEach((star, index) => {
                if (index < selectedRating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });

            const ratingLabels = ['', 'Poor', 'Fair', 'Good', 'Very Good', 'Excellent'];
            ratingText.textContent = selectedRating > 0 ? `${selectedRating} star${selectedRating > 1 ? 's' : ''} - ${ratingLabels[selectedRating]}` : 'Click to rate';
        }

        // Update current user profile display
        function updateCurrentUserProfile() {
            const currentProfile = userProfiles[currentUser];
            if (!currentProfile) return;

            // Update profile stats
            document.getElementById('currentUserPoints').textContent = currentProfile.points;
            document.getElementById('currentUserSolved').textContent = currentProfile.ticketsSolved;
            document.getElementById('currentUserRating').textContent = currentProfile.averageRating;

            // Calculate and update rank
            const sortedUsers = Object.values(userProfiles).sort((a, b) => b.points - a.points);
            const rank = sortedUsers.findIndex(user => user.name === currentUser) + 1;
            document.getElementById('currentUserRank').textContent = `#${rank}`;
        }

        // =========================
        // SUPPLIER PARTS SYSTEM
        // =========================

        // Parts database - stores all parts from all suppliers
        // ========================================
        // SUPPLIER MANAGEMENT SYSTEM
        // ========================================

        // Database: Suppliers with their account information
        let suppliers = [
            {
                id: 1,
                name: 'ABC Industrial Supplies',
                contact: 'Michael Chen',
                email: 'contact@abc-industrial.com',
                phone: '+1 (555) 123-4567',
                address: '123 Industrial Park, NY 10001',
                category: 'General',
                parts: [
                    { id: 1, partNumber: 'P-1001', partName: 'Bearing 6205', price: 15.50, stock: 100, category: 'Bearings', description: 'High-quality deep groove ball bearing' },
                    { id: 2, partNumber: 'P-2003', partName: 'Motor 5HP', price: 250.00, stock: 20, category: 'Motors', description: '3-phase industrial motor' },
                    { id: 3, partNumber: 'P-5010', partName: 'V-Belt A65', price: 12.75, stock: 150, category: 'Mechanical', description: 'Industrial V-belt, 65" length' }
                ]
            },
            {
                id: 2,
                name: 'XYZ Industrial Parts',
                contact: 'Sarah Johnson',
                email: 'sales@xyz-parts.com',
                phone: '+1 (555) 234-5678',
                address: '456 Manufacturing Ave, CA 90210',
                category: 'Bearings',
                parts: [
                    { id: 4, partNumber: 'P-1001', partName: 'Bearing 6205', price: 14.25, stock: 75, category: 'Bearings', description: 'Premium bearing with extended life' },
                    { id: 5, partNumber: 'P-3045', partName: 'Control Panel', price: 450.00, stock: 10, category: 'Electrical', description: 'Industrial control panel with PLC' }
                ]
            },
            {
                id: 3,
                name: 'Global Parts Inc',
                contact: 'David Martinez',
                email: 'info@globalparts.com',
                phone: '+1 (555) 345-6789',
                address: '789 Factory Rd, TX 75001',
                category: 'Hydraulics',
                parts: [
                    { id: 6, partNumber: 'P-1001', partName: 'Bearing 6205', price: 16.00, stock: 50, category: 'Bearings', description: 'Standard industrial bearing' },
                    { id: 7, partNumber: 'P-4012', partName: 'Hydraulic Pump', price: 380.50, stock: 8, category: 'Hydraulics', description: 'Heavy-duty hydraulic pump, 3000 PSI' }
                ]
            },
            {
                id: 4,
                name: 'Motor World Suppliers',
                contact: 'Emily Watson',
                email: 'contact@motorworld.com',
                phone: '+1 (555) 456-7890',
                address: '321 Engine Street, MI 48201',
                category: 'Motors',
                parts: [
                    { id: 8, partNumber: 'P-2003', partName: 'Motor 5HP', price: 245.99, stock: 15, category: 'Motors', description: 'Energy-efficient 5HP motor' }
                ]
            },
            {
                id: 5,
                name: 'Hydraulics Pro',
                contact: 'James Wilson',
                email: 'sales@hydraulicspro.com',
                phone: '+1 (555) 567-8901',
                address: '654 Pressure Lane, OH 44101',
                category: 'Hydraulics',
                parts: [
                    { id: 9, partNumber: 'P-4012', partName: 'Hydraulic Pump', price: 375.00, stock: 12, category: 'Hydraulics', description: 'Professional grade hydraulic pump' }
                ]
            }
        ];

        // Current supplier ID for dashboard view
        let currentSupplierId = null;

        // Initialize suppliers list on load
        function loadSuppliersList() {
            const suppliersList = document.getElementById('suppliersList');
            const suppliersCount = document.getElementById('suppliersCount');

            if (!suppliersList) return;

            suppliersCount.textContent = suppliers.length;

            if (suppliers.length === 0) {
                suppliersList.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üì¶</div>
                        <h3>No Suppliers Registered</h3>
                        <p>Click "Add Supplier" to register your first supplier account.</p>
                    </div>
                `;
                return;
            }

            let html = '';
            suppliers.forEach(supplier => {
                const initials = supplier.name.split(' ').map(word => word[0]).join('').substring(0, 2).toUpperCase();
                const totalParts = supplier.parts.length;
                const totalValue = supplier.parts.reduce((sum, part) => sum + (part.price * part.stock), 0);

                html += `
                    <div class="supplier-card" onclick="openSupplierDashboard(${supplier.id})">
                        <div class="supplier-card-header">
                            <div class="supplier-avatar">${initials}</div>
                            <div class="supplier-info">
                                <h3>${supplier.name}</h3>
                                <div class="supplier-category">${supplier.category} Specialist</div>
                            </div>
                        </div>
                        <div class="supplier-meta">
                            <div class="meta-stat">
                                <div class="stat-number">${totalParts}</div>
                                <div class="stat-label">Parts</div>
                            </div>
                            <div class="meta-stat">
                                <div class="stat-number">$${(totalValue / 1000).toFixed(1)}k</div>
                                <div class="stat-label">Value</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            suppliersList.innerHTML = html;
        }

        // Open supplier dashboard
        function openSupplierDashboard(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            currentSupplierId = supplierId;

            // Update dashboard header
            document.getElementById('supplierDashTitle').textContent = supplier.name;
            document.getElementById('supplierDashSubtitle').textContent = `${supplier.category} Supplier`;

            // Update supplier info card
            const initials = supplier.name.split(' ').map(word => word[0]).join('').substring(0, 2).toUpperCase();
            document.getElementById('dashSupplierAvatar').textContent = initials;
            document.getElementById('dashSupplierName').textContent = supplier.name;
            document.getElementById('dashSupplierContact').textContent = `Contact: ${supplier.contact}`;
            document.getElementById('dashSupplierEmail').textContent = supplier.email;

            // Update stats
            const totalParts = supplier.parts.length;
            const totalValue = supplier.parts.reduce((sum, part) => sum + (part.price * part.stock), 0);
            document.getElementById('dashTotalParts').textContent = totalParts;
            document.getElementById('dashTotalValue').textContent = `$${totalValue.toLocaleString()}`;
            document.getElementById('dashPartsCount').textContent = totalParts;

            // Load supplier's inventory
            loadSupplierInventory();

            // Show dashboard screen
            showScreen('supplierDashboardScreen');
        }

        // Load supplier's inventory
        function loadSupplierInventory(filterCategory = '') {
            const supplier = suppliers.find(s => s.id === currentSupplierId);
            if (!supplier) return;

            const inventoryList = document.getElementById('supplierInventoryList');
            let parts = supplier.parts;

            // Apply category filter
            if (filterCategory) {
                parts = parts.filter(part => part.category === filterCategory);
            }

            if (parts.length === 0) {
                inventoryList.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üì¶</div>
                        <p>No parts in inventory${filterCategory ? ' for this category' : ''}.</p>
                    </div>
                `;
                return;
            }

            // Sort by part number
            parts.sort((a, b) => a.partNumber.localeCompare(b.partNumber));

            let html = '';
            parts.forEach(part => {
                const lowStock = part.stock < 10;
                html += `
                    <div class="inventory-part-card">
                        <div class="part-header">
                            <div class="part-main-info">
                                <h4>${part.partName}</h4>
                                <div class="part-number">Part #: ${part.partNumber}</div>
                            </div>
                            <div class="part-category-badge">${part.category}</div>
                        </div>
                        <div class="part-price-section">
                            <div class="part-price">$${part.price.toFixed(2)}</div>
                            <div class="part-stock ${lowStock ? 'low-stock' : ''}">
                                ${lowStock ? '‚ö†Ô∏è ' : ''}Stock: ${part.stock} units
                            </div>
                        </div>
                        ${part.description ? `<p style="margin: 12px 0 0 0; font-size: 13px; color: #898491;">${part.description}</p>` : ''}
                        <div class="part-actions">
                            <button class="part-action-btn" onclick="editPart(${currentSupplierId}, ${part.id})">Edit</button>
                            <button class="part-action-btn delete" onclick="deletePart(${currentSupplierId}, ${part.id})">Delete</button>
                        </div>
                    </div>
                `;
            });

            inventoryList.innerHTML = html;
        }

        // Filter supplier parts by category
        function filterSupplierParts() {
            const filterCategory = document.getElementById('categoryFilter').value;
            loadSupplierInventory(filterCategory);
        }

        // Add part to supplier's inventory
        function addPartToSupplier(event) {
            event.preventDefault();

            const supplier = suppliers.find(s => s.id === currentSupplierId);
            if (!supplier) return;

            const partNumber = document.getElementById('dashPartNumber').value.trim().toUpperCase();
            const partName = document.getElementById('dashPartName').value.trim();
            const price = parseFloat(document.getElementById('dashPartPrice').value);
            const stock = parseInt(document.getElementById('dashPartStock').value);
            const category = document.getElementById('dashPartCategory').value;
            const description = document.getElementById('dashPartDescription').value.trim();

            // Generate new part ID
            const newId = Math.max(0, ...supplier.parts.map(p => p.id)) + 1;

            // Add part to supplier's inventory
            supplier.parts.push({
                id: newId,
                partNumber,
                partName,
                price,
                stock,
                category,
                description
            });

            // Clear form
            event.target.reset();

            // Reload inventory
            loadSupplierInventory();

            // Update stats
            const totalParts = supplier.parts.length;
            const totalValue = supplier.parts.reduce((sum, part) => sum + (part.price * part.stock), 0);
            document.getElementById('dashTotalParts').textContent = totalParts;
            document.getElementById('dashTotalValue').textContent = `$${totalValue.toLocaleString()}`;
            document.getElementById('dashPartsCount').textContent = totalParts;

            // Reload suppliers list to update counts
            loadSuppliersList();

            alert(`‚úÖ Part added successfully to ${supplier.name}!\n\nPart: ${partName} (${partNumber})\nPrice: $${price.toFixed(2)}`);
        }

        // Edit part
        function editPart(supplierId, partId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            const part = supplier.parts.find(p => p.id === partId);
            if (!part) return;

            const newPrice = prompt(`Edit price for ${part.partName} (${part.partNumber}):`, part.price);
            if (newPrice && !isNaN(newPrice)) {
                part.price = parseFloat(newPrice);
            }

            const newStock = prompt(`Edit stock for ${part.partName} (${part.partNumber}):`, part.stock);
            if (newStock && !isNaN(newStock)) {
                part.stock = parseInt(newStock);
            }

            loadSupplierInventory();

            // Update stats
            const totalValue = supplier.parts.reduce((sum, part) => sum + (part.price * part.stock), 0);
            document.getElementById('dashTotalValue').textContent = `$${totalValue.toLocaleString()}`;

            loadSuppliersList();
        }

        // Delete part
        function deletePart(supplierId, partId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            const part = supplier.parts.find(p => p.id === partId);
            if (!part) return;

            if (!confirm(`Are you sure you want to delete ${part.partName} (${part.partNumber}) from inventory?`)) {
                return;
            }

            supplier.parts = supplier.parts.filter(p => p.id !== partId);

            loadSupplierInventory();

            // Update stats
            const totalParts = supplier.parts.length;
            const totalValue = supplier.parts.reduce((sum, part) => sum + (part.price * part.stock), 0);
            document.getElementById('dashTotalParts').textContent = totalParts;
            document.getElementById('dashTotalValue').textContent = `$${totalValue.toLocaleString()}`;
            document.getElementById('dashPartsCount').textContent = totalParts;

            loadSuppliersList();

            alert(`‚úÖ Part deleted successfully from ${supplier.name}`);
        }

        // Global search across all suppliers
        function globalSearchPart() {
            const searchInput = document.getElementById('globalPartSearch');
            const searchValue = searchInput.value.trim().toUpperCase();

            if (!searchValue) {
                alert('Please enter a part number to search');
                return;
            }

            // Search across all suppliers
            let allMatches = [];
            suppliers.forEach(supplier => {
                const matches = supplier.parts.filter(part =>
                    part.partNumber.toUpperCase() === searchValue
                );
                matches.forEach(part => {
                    allMatches.push({
                        ...part,
                        supplierName: supplier.name,
                        supplierContact: supplier.contact,
                        supplierEmail: supplier.email
                    });
                });
            });

            if (allMatches.length === 0) {
                displayGlobalNoResults();
                return;
            }

            displayGlobalSearchResults(allMatches);
        }

        // Display global search results
        function displayGlobalSearchResults(parts) {
            const resultsContainer = document.getElementById('globalResultsContainer');
            const searchResults = document.getElementById('globalSearchResults');

            const partNumber = parts[0].partNumber;
            const partName = parts[0].partName;

            // Sort by price (lowest first)
            parts.sort((a, b) => a.price - b.price);

            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="part-info">
                            <h4>${partName}</h4>
                            <div class="part-number">Part #: ${partNumber}</div>
                        </div>
                    </div>
                    <div class="supplier-list">
                        <h4 style="margin: 8px 0 12px 0; font-size: 14px; color: #898491;">
                            Found ${parts.length} supplier${parts.length > 1 ? 's' : ''} offering this part:
                        </h4>
            `;

            parts.forEach((part, index) => {
                const bestPrice = index === 0;
                html += `
                    <div class="supplier-item ${bestPrice ? 'best-price' : ''}">
                        <div>
                            <div class="supplier-name">
                                ${part.supplierName}
                                ${bestPrice ? '<span class="best-price-badge">BEST PRICE</span>' : ''}
                            </div>
                            <div class="supplier-stock">Stock: ${part.stock} units | ${part.supplierContact}</div>
                        </div>
                        <div style="text-align: right;">
                            <div class="supplier-price">$${part.price.toFixed(2)}</div>
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            resultsContainer.innerHTML = html;
            searchResults.style.display = 'block';
        }

        // Display no results for global search
        function displayGlobalNoResults() {
            const resultsContainer = document.getElementById('globalResultsContainer');
            const searchResults = document.getElementById('globalSearchResults');

            resultsContainer.innerHTML = `
                <div class="no-results">
                    <div class="no-results-icon">üîç</div>
                    <h3>No Results Found</h3>
                    <p>This part number is not available from any registered supplier.</p>
                    <p style="margin-top: 12px; font-size: 14px;">Contact a supplier to add this part to their inventory.</p>
                </div>
            `;

            searchResults.style.display = 'block';
        }

        // Clear global search
        function clearGlobalSearch() {
            document.getElementById('globalSearchResults').style.display = 'none';
            document.getElementById('globalPartSearch').value = '';
        }

        // Show add supplier modal
        function showAddSupplierForm() {
            document.getElementById('addSupplierModal').style.display = 'block';
        }

        // Close add supplier modal
        function closeAddSupplierForm() {
            document.getElementById('addSupplierModal').style.display = 'none';
            document.getElementById('addSupplierForm').reset();
        }

        // Add new supplier
        function addNewSupplier(event) {
            event.preventDefault();

            const name = document.getElementById('newSupplierName').value.trim();
            const contact = document.getElementById('newSupplierContact').value.trim();
            const email = document.getElementById('newSupplierEmail').value.trim();
            const phone = document.getElementById('newSupplierPhone').value.trim();
            const address = document.getElementById('newSupplierAddress').value.trim();
            const category = document.getElementById('newSupplierCategory').value;

            // Generate new ID
            const newId = Math.max(0, ...suppliers.map(s => s.id)) + 1;

            // Add new supplier
            suppliers.push({
                id: newId,
                name,
                contact,
                email,
                phone,
                address,
                category,
                parts: []
            });

            // Close modal
            closeAddSupplierForm();

            // Reload suppliers list
            loadSuppliersList();

            alert(`‚úÖ Supplier registered successfully!\n\n${name} has been added to the system.`);
        }

        // Enable Enter key for global search
        document.addEventListener('DOMContentLoaded', function() {
            const globalSearch = document.getElementById('globalPartSearch');
            if (globalSearch) {
                globalSearch.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        globalSearchPart();
                    }
                });
            }
        });

        // ========================================
        // QUALITY LAB DIAGNOSTICS SYSTEM
        // ========================================

        // Lab reports database
        let labReports = [];
        let currentLabReportId = null;
        let labAttachments = [];

        // Bacteria knowledge base for diagnostics
        const bacteriaKnowledge = {
            'Clostridium': {
                defects: ['Blow'],
                sources: [
                    'Raw milk contamination',
                    'Inadequate pasteurization (temperature/time)',
                    'Post-pasteurization contamination',
                    'Storage tank contamination',
                    'Spore survival in pasteurizer'
                ],
                checks: [
                    'Verify pasteurization temperature (‚â•72¬∞C for 15 seconds)',
                    'Check raw milk quality and storage temperature',
                    'Inspect pasteurizer heating elements and sensors',
                    'Test pasteurizer holding time',
                    'Check for post-pasteurization contamination points',
                    'Inspect and sanitize storage tanks',
                    'Review CIP (Clean-in-Place) procedures'
                ],
                severity: 'high'
            },
            'Bacillus': {
                defects: ['Blow', 'Curdle'],
                sources: [
                    'Raw milk contamination from farm',
                    'Equipment biofilm formation',
                    'Inadequate cleaning of pipes and tanks',
                    'Spore survival after pasteurization',
                    'Environmental contamination'
                ],
                checks: [
                    'Test raw milk for spore counts',
                    'Inspect and deep-clean filling equipment',
                    'Check CIP system effectiveness',
                    'Verify pasteurization parameters',
                    'Inspect for biofilm in pipes and tanks',
                    'Review farm hygiene practices',
                    'Check air quality in production area'
                ],
                severity: 'medium'
            },
            'Coliform': {
                defects: ['Blow', 'Curdle'],
                sources: [
                    'Post-pasteurization contamination',
                    'Inadequate equipment sanitization',
                    'Poor personal hygiene',
                    'Contaminated water supply',
                    'Packaging contamination'
                ],
                checks: [
                    'Check water quality and chlorine levels',
                    'Inspect filling machine sanitization',
                    'Review operator hygiene practices',
                    'Test packaging material sterility',
                    'Check for leaks in pasteurized product lines',
                    'Verify CIP chemical concentrations',
                    'Inspect product contact surfaces'
                ],
                severity: 'high'
            },
            'Lactobacillus': {
                defects: ['Curdle'],
                sources: [
                    'Natural milk flora not eliminated',
                    'Insufficient pasteurization',
                    'Environmental contamination',
                    'Equipment contamination'
                ],
                checks: [
                    'Verify pasteurization time and temperature',
                    'Check milk pre-heating system',
                    'Inspect heat exchanger efficiency',
                    'Review raw milk handling procedures',
                    'Check cooling system contamination',
                    'Test sanitizer effectiveness'
                ],
                severity: 'medium'
            },
            'Yeast': {
                defects: ['Blow', 'Both'],
                sources: [
                    'Fruit/flavor contamination',
                    'Sugar contamination',
                    'Air contamination',
                    'Equipment contamination',
                    'Packaging contamination'
                ],
                checks: [
                    'Check ingredient quality and storage',
                    'Inspect air filtration systems',
                    'Review cleaning procedures for mixers',
                    'Test packaging integrity',
                    'Check product pH levels',
                    'Inspect filling environment'
                ],
                severity: 'medium'
            },
            'Mold': {
                defects: ['Both'],
                sources: [
                    'Air contamination',
                    'Packaging defects',
                    'Storage environment',
                    'Equipment contamination'
                ],
                checks: [
                    'Check air quality and HVAC filters',
                    'Inspect packaging seals and integrity',
                    'Review storage humidity and temperature',
                    'Check for condensation in production area',
                    'Inspect walls and ceilings for mold',
                    'Test air pressure differentials'
                ],
                severity: 'medium'
            },
            'Unknown': {
                defects: ['Blow', 'Curdle', 'Both'],
                sources: [
                    'Multiple possible contamination sources',
                    'Requires microbiological testing'
                ],
                checks: [
                    'Collect samples for lab testing',
                    'Perform full microbiological analysis',
                    'Check all critical control points',
                    'Review HACCP plan compliance',
                    'Inspect entire production line',
                    'Conduct environmental swab testing'
                ],
                severity: 'high'
            }
        };

        // Calculate defect rate
        function calculateDefectRate() {
            const defectPacks = parseInt(document.getElementById('labDefectPacks').value) || 0;
            const totalPacks = parseInt(document.getElementById('labTotalPacks').value) || 1;
            const rate = (defectPacks / totalPacks) * 100;
            document.getElementById('labDefectRate').value = rate.toFixed(2) + '%';
        }

        // Handle file attachments
        let labFilesList = [];
        function displayLabFiles() {
            const fileInput = document.getElementById('labFileInput');
            const filesContainer = document.getElementById('labAttachedFiles');

            labFilesList = Array.from(fileInput.files);

            let html = '';
            labFilesList.forEach((file, index) => {
                html += `
                    <div class="attached-file">
                        <span>üìé ${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
                        <span class="remove-file" onclick="removeLabFile(${index})">&times;</span>
                    </div>
                `;
            });

            filesContainer.innerHTML = html;
        }

        function removeLabFile(index) {
            labFilesList.splice(index, 1);
            const dataTransfer = new DataTransfer();
            labFilesList.forEach(file => dataTransfer.items.add(file));
            document.getElementById('labFileInput').files = dataTransfer.files;
            displayLabFiles();
        }

        // Categorize causes for fishbone diagram
        function categorizeCause(cause) {
            const causeLower = cause.toLowerCase();

            // Man (People/Methods)
            if (causeLower.includes('hygiene') || causeLower.includes('operator') || causeLower.includes('personnel') || causeLower.includes('training')) {
                return 'Man';
            }
            // Machine/Equipment
            if (causeLower.includes('equipment') || causeLower.includes('machine') || causeLower.includes('pipe') || causeLower.includes('tank') || causeLower.includes('pasteuriz') || causeLower.includes('filling') || causeLower.includes('heating')) {
                return 'Machine';
            }
            // Material
            if (causeLower.includes('raw milk') || causeLower.includes('ingredient') || causeLower.includes('packaging') || causeLower.includes('water') || causeLower.includes('sugar')) {
                return 'Material';
            }
            // Method
            if (causeLower.includes('procedure') || causeLower.includes('cleaning') || causeLower.includes('cip') || causeLower.includes('sanitiz') || causeLower.includes('pasteuriz')) {
                return 'Method';
            }
            // Measurement
            if (causeLower.includes('temperature') || causeLower.includes('time') || causeLower.includes('test') || causeLower.includes('monitor')) {
                return 'Measurement';
            }
            // Environment
            if (causeLower.includes('air') || causeLower.includes('environment') || causeLower.includes('storage') || causeLower.includes('humidity') || causeLower.includes('contamination')) {
                return 'Environment';
            }

            return 'Other';
        }

        // Submit lab report
        function submitLabReport(event) {
            event.preventDefault();

            const machineType = document.getElementById('labMachineType').value;
            const defectType = document.getElementById('labDefectType').value;
            const bacteriaType = document.getElementById('labBacteriaType').value;
            const batchNumber = document.getElementById('labBatchNumber').value;
            const defectPacks = parseInt(document.getElementById('labDefectPacks').value);
            const totalPacks = parseInt(document.getElementById('labTotalPacks').value);
            const defectRate = document.getElementById('labDefectRate').value;
            const description = document.getElementById('labDescription').value;

            // Generate report ID
            const reportId = 'LAB-' + Date.now();

            // Get bacteria knowledge
            const bacteria = bacteriaKnowledge[bacteriaType];

            // Create action items from checks
            const actionItems = bacteria.checks.map((check, index) => ({
                id: index,
                action: check,
                completed: false,
                notes: ''
            }));

            // Create root causes for fishbone
            const rootCauses = bacteria.sources.map((source, index) => ({
                id: index,
                cause: source,
                category: categorizeCause(source),
                verified: false,
                notes: ''
            }));

            // Create report object
            const report = {
                id: reportId,
                timestamp: new Date().toLocaleString(),
                machineType,
                defectType,
                bacteriaType,
                batchNumber,
                defectPacks,
                totalPacks,
                defectRate,
                description,
                attachments: labFilesList.map(f => ({ name: f.name, size: f.size })),
                actionItems: actionItems,
                rootCauses: rootCauses,
                chat: []
            };

            // Add to reports database
            labReports.unshift(report);

            // Generate and display diagnostics
            displayDiagnostics(report);

            // Update reports list
            loadLabReportsList();

            // Clear form
            document.getElementById('labReportForm').reset();
            document.getElementById('labAttachedFiles').innerHTML = '';
            labFilesList = [];

            // Show success message
            alert(`‚úÖ Lab report submitted successfully!\n\nReport ID: ${reportId}\nDiagnostic analysis is ready.`);
        }

        // Display diagnostic analysis with fishbone and action tracking
        function displayDiagnostics(report) {
            const diagnosticContent = document.getElementById('diagnosticContent');
            const diagnosticResults = document.getElementById('diagnosticResults');

            const bacteria = bacteriaKnowledge[report.bacteriaType];
            const severity = bacteria.severity;
            const severityClass = severity === 'high' ? 'severity-high' : severity === 'medium' ? 'severity-medium' : 'severity-low';
            const severityText = severity.toUpperCase();

            // Calculate action completion percentage
            const completedActions = report.actionItems.filter(a => a.completed).length;
            const actionProgress = report.actionItems.length > 0 ? (completedActions / report.actionItems.length * 100) : 0;

            // Group root causes by category for fishbone
            const categorizedCauses = {};
            report.rootCauses.forEach(rc => {
                if (!categorizedCauses[rc.category]) {
                    categorizedCauses[rc.category] = [];
                }
                categorizedCauses[rc.category].push(rc);
            });

            let html = `
                <div class="diagnostic-card">
                    <!-- Header -->
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                        <div>
                            <h3 style="margin: 0 0 8px 0;">Report ${report.id}</h3>
                            <div style="color: #898491; font-size: 14px;">
                                ${report.machineType} ‚Ä¢ ${report.defectType} defect ‚Ä¢ Defect rate: ${report.defectRate}
                            </div>
                        </div>
                        <div class="severity-badge ${severityClass}">
                            ${severityText} PRIORITY
                        </div>
                    </div>

                    <!-- Bacteria Info -->
                    <div class="diagnostic-section">
                        <h4>ü¶† Bacteria Identified: ${report.bacteriaType}</h4>
                        <p style="margin: 0; color: #231628;">
                            This bacteria is typically associated with <strong>${bacteria.defects.join(' and ')}</strong> defects in dairy products.
                        </p>
                    </div>

                    <!-- FISHBONE DIAGRAM - Root Cause Analysis -->
                    <div class="diagnostic-section">
                        <h4>üêü Fishbone Analysis - Root Cause Investigation</h4>
                        <div class="fishbone-container">
                            <div class="fishbone-grid">
                                ${Object.keys(categorizedCauses).map(category => `
                                    <div class="fishbone-category">
                                        <div class="fishbone-category-header">${category}</div>
                                        <div class="fishbone-causes">
                                            ${categorizedCauses[category].map(cause => `
                                                <div class="fishbone-cause-item">
                                                    <input type="checkbox"
                                                           id="cause-${report.id}-${cause.id}"
                                                           ${cause.verified ? 'checked' : ''}
                                                           onchange="toggleCauseVerified('${report.id}', ${cause.id})">
                                                    <label for="cause-${report.id}-${cause.id}">${cause.cause}</label>
                                                    <textarea
                                                        class="cause-notes"
                                                        placeholder="Notes..."
                                                        onblur="updateCauseNotes('${report.id}', ${cause.id}, this.value)">${cause.notes}</textarea>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="fishbone-arrow">
                                <div class="arrow-line"></div>
                                <div class="arrow-head">‚ñ∂</div>
                                <div class="arrow-label">ROOT CAUSE</div>
                            </div>
                        </div>
                    </div>

                    <!-- ACTION ITEMS with Tracking -->
                    <div class="diagnostic-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h4 style="margin: 0;">‚úÖ Corrective Actions Required</h4>
                            <div class="action-progress">
                                <span style="font-size: 12px; color: #898491;">Progress:</span>
                                <span style="font-size: 16px; font-weight: 700; color: #6A57FF; margin-left: 8px;">
                                    ${completedActions}/${report.actionItems.length} (${actionProgress.toFixed(0)}%)
                                </span>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${actionProgress}%"></div>
                        </div>

                        <div class="action-items-list">
                            ${report.actionItems.map((action, index) => `
                                <div class="action-item ${action.completed ? 'completed' : ''}">
                                    <div class="action-checkbox-container">
                                        <input type="checkbox"
                                               id="action-${report.id}-${action.id}"
                                               ${action.completed ? 'checked' : ''}
                                               onchange="toggleActionCompleted('${report.id}', ${action.id})">
                                        <label for="action-${report.id}-${action.id}">${index + 1}. ${action.action}</label>
                                    </div>
                                    <textarea
                                        class="action-notes"
                                        placeholder="Add notes: findings, results, person responsible..."
                                        onblur="updateActionNotes('${report.id}', ${action.id}, this.value)">${action.notes}</textarea>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Alerts -->
                    ${report.defectPacks > 10 ? `
                        <div class="diagnostic-section">
                            <h4>‚ö†Ô∏è High Defect Count Alert:</h4>
                            <p style="margin: 0; color: #D32F2F; font-weight: 600;">
                                ${report.defectPacks} defect packs detected. Immediate action required to prevent batch rejection.
                                Consider halting production until root cause is identified.
                            </p>
                        </div>
                    ` : ''}

                    ${parseFloat(report.defectRate) > 5 ? `
                        <div class="diagnostic-section">
                            <h4>üìä High Defect Rate:</h4>
                            <p style="margin: 0; color: #FF9800; font-weight: 600;">
                                Defect rate of ${report.defectRate} exceeds acceptable limit (typically <2%).
                                Investigate immediately and document corrective actions.
                            </p>
                        </div>
                    ` : ''}

                    <!-- Next Steps -->
                    <div style="background: #F8F9FF; border: 1px solid #6A57FF; border-radius: 8px; padding: 16px; margin-top: 20px;">
                        <strong style="color: #6A57FF;">üí° Professional Problem-Solving Process:</strong>
                        <p style="margin: 8px 0 0 0; color: #231628;">
                            1. <strong>Verify root causes</strong> - Check each item in fishbone diagram<br>
                            2. <strong>Complete corrective actions</strong> - Check off each action as completed<br>
                            3. <strong>Document findings</strong> - Add notes to each action item<br>
                            4. <strong>Collaborate with team</strong> - Use chat for discussion<br>
                            5. <strong>Monitor results</strong> - Track defect rate improvement
                        </p>
                    </div>
                </div>
            `;

            diagnosticContent.innerHTML = html;
            diagnosticResults.style.display = 'block';

            // Scroll to results
            diagnosticResults.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Toggle action item completed status
        function toggleActionCompleted(reportId, actionId) {
            const report = labReports.find(r => r.id === reportId);
            if (!report) return;

            const action = report.actionItems.find(a => a.id === actionId);
            if (!action) return;

            action.completed = !action.completed;

            // Refresh display
            displayDiagnostics(report);
        }

        // Update action notes
        function updateActionNotes(reportId, actionId, notes) {
            const report = labReports.find(r => r.id === reportId);
            if (!report) return;

            const action = report.actionItems.find(a => a.id === actionId);
            if (!action) return;

            action.notes = notes;
        }

        // Toggle cause verified status
        function toggleCauseVerified(reportId, causeId) {
            const report = labReports.find(r => r.id === reportId);
            if (!report) return;

            const cause = report.rootCauses.find(c => c.id === causeId);
            if (!cause) return;

            cause.verified = !cause.verified;
        }

        // Update cause notes
        function updateCauseNotes(reportId, causeId, notes) {
            const report = labReports.find(r => r.id === reportId);
            if (!report) return;

            const cause = report.rootCauses.find(c => c.id === causeId);
            if (!cause) return;

            cause.notes = notes;
        }

        // Clear diagnostics
        function clearDiagnostics() {
            document.getElementById('diagnosticResults').style.display = 'none';
        }

        // Load lab reports list
        function loadLabReportsList() {
            const labReportsList = document.getElementById('labReportsList');
            const labReportsCount = document.getElementById('labReportsCount');

            labReportsCount.textContent = labReports.length;

            if (labReports.length === 0) {
                labReportsList.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üî¨</div>
                        <p>No lab reports yet. Submit your first quality report above.</p>
                    </div>
                `;
                return;
            }

            let html = '';
            labReports.forEach(report => {
                html += `
                    <div class="lab-report-card" onclick="openLabReportDetail('${report.id}')">
                        <div class="lab-report-header">
                            <div>
                                <div class="lab-report-title">${report.id} - ${report.machineType}</div>
                                <div class="lab-report-meta">
                                    <span>${report.timestamp}</span>
                                    <span>Defect rate: ${report.defectRate}</span>
                                    <span>${report.defectPacks} defects / ${report.totalPacks} packs</span>
                                </div>
                            </div>
                            <div>
                                <span class="defect-badge">${report.defectType}</span>
                                <span class="bacteria-badge">${report.bacteriaType}</span>
                            </div>
                        </div>
                        ${report.description ? `<p style="margin: 8px 0 0 0; color: #898491; font-size: 13px;">${report.description.substring(0, 100)}${report.description.length > 100 ? '...' : ''}</p>` : ''}
                        ${report.chat.length > 0 ? `<div style="margin-top: 8px; font-size: 12px; color: #6A57FF;">üí¨ ${report.chat.length} ${report.chat.length === 1 ? 'comment' : 'comments'}</div>` : ''}
                    </div>
                `;
            });

            labReportsList.innerHTML = html;
        }

        // Open lab report detail with chat
        function openLabReportDetail(reportId) {
            const report = labReports.find(r => r.id === reportId);
            if (!report) return;

            currentLabReportId = reportId;

            document.getElementById('labDetailTitle').textContent = `Lab Report: ${reportId}`;

            const bacteria = bacteriaKnowledge[report.bacteriaType];

            let html = `
                <div style="background: #F8F9FF; border: 1px solid #E6E3EB; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <div>
                            <h4 style="margin: 0 0 4px 0;">${report.machineType}</h4>
                            <div style="font-size: 13px; color: #898491;">${report.timestamp}</div>
                        </div>
                        <div>
                            <span class="defect-badge">${report.defectType}</span>
                            <span class="bacteria-badge">${report.bacteriaType}</span>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 12px;">
                        <div>
                            <div style="font-size: 11px; color: #898491;">Batch Number</div>
                            <div style="font-weight: 600;">${report.batchNumber || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #898491;">Defect Count</div>
                            <div style="font-weight: 600; color: #D32F2F;">${report.defectPacks} / ${report.totalPacks}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #898491;">Defect Rate</div>
                            <div style="font-weight: 600; color: #D32F2F;">${report.defectRate}</div>
                        </div>
                    </div>
                    ${report.description ? `<p style="margin: 12px 0 0 0; padding-top: 12px; border-top: 1px solid #E6E3EB;">${report.description}</p>` : ''}
                    ${report.attachments.length > 0 ? `
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #E6E3EB;">
                            <strong>Attachments:</strong><br>
                            ${report.attachments.map(att => `üìé ${att.name} (${(att.size / 1024).toFixed(1)} KB)`).join('<br>')}
                        </div>
                    ` : ''}
                </div>

                <div style="background: white; border: 1px solid #E6E3EB; border-radius: 8px; padding: 16px;">
                    <h4 style="margin: 0 0 12px 0; color: #6A57FF;">üî¨ Diagnostic Analysis</h4>
                    <p><strong>Possible Sources:</strong></p>
                    <ul style="margin: 8px 0;">
                        ${bacteria.sources.slice(0, 3).map(s => `<li>${s}</li>`).join('')}
                    </ul>
                    <p><strong>Recommended Actions:</strong></p>
                    <ul style="margin: 8px 0;">
                        ${bacteria.checks.slice(0, 3).map(c => `<li>${c}</li>`).join('')}
                    </ul>
                </div>
            `;

            document.getElementById('labDetailContent').innerHTML = html;

            // Load chat messages
            loadLabChat();

            // Show modal
            document.getElementById('labDetailModal').style.display = 'block';
        }

        // Close lab detail modal
        function closeLabDetail() {
            document.getElementById('labDetailModal').style.display = 'none';
            currentLabReportId = null;
        }

        // Load chat messages for current report
        function loadLabChat() {
            const report = labReports.find(r => r.id === currentLabReportId);
            if (!report) return;

            const chatMessages = document.getElementById('labChatMessages');

            if (report.chat.length === 0) {
                chatMessages.innerHTML = `
                    <div style="text-align: center; color: #898491; padding: 20px;">
                        No messages yet. Start the discussion to collaborate on this issue.
                    </div>
                `;
                return;
            }

            let html = '';
            report.chat.forEach(msg => {
                html += `
                    <div class="lab-chat-message">
                        <div class="lab-chat-sender">${msg.sender}</div>
                        <div class="lab-chat-text">${msg.message}</div>
                        <div class="lab-chat-time">${msg.timestamp}</div>
                    </div>
                `;
            });

            chatMessages.innerHTML = html;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Send chat message
        function sendLabChat() {
            const input = document.getElementById('labChatInput');
            const message = input.value.trim();

            if (!message) return;

            const report = labReports.find(r => r.id === currentLabReportId);
            if (!report) return;

            // Add message to report
            report.chat.push({
                sender: 'Current User', // In real app, this would be the logged-in user
                message: message,
                timestamp: new Date().toLocaleTimeString()
            });

            // Reload chat
            loadLabChat();

            // Clear input
            input.value = '';

            // Reload reports list to update comment count
            loadLabReportsList();
        }

        // Enable Enter key for chat
        document.addEventListener('DOMContentLoaded', function() {
            const labChatInput = document.getElementById('labChatInput');
            if (labChatInput) {
                labChatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendLabChat();
                    }
                });
            }
        });

        // ==================== SUPPORT SERVICES FUNCTIONS ====================

        // Support requests storage
        let supportRequests = [];
        let currentSupportRequestId = null;
        let supportRequestCounter = 1;

        // Select support type
        function selectSupportType(type) {
            // Clear previous selections
            document.querySelectorAll('.support-type-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Select the clicked card
            const selectedCard = event.currentTarget;
            selectedCard.classList.add('selected');

            // Check the radio button
            document.getElementById('support' + type.charAt(0).toUpperCase() + type.slice(1)).checked = true;
        }

        // Display support files
        function displaySupportFiles() {
            const fileInput = document.getElementById('supportFileInput');
            const container = document.getElementById('supportAttachedFiles');

            container.innerHTML = '';
            Array.from(fileInput.files).forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'attached-file';
                fileDiv.innerHTML = `
                    <span>${file.name}</span>
                    <span class="remove-file" onclick="removeSupportFile(${index})">√ó</span>
                `;
                container.appendChild(fileDiv);
            });
        }

        // Remove support file
        function removeSupportFile(index) {
            const fileInput = document.getElementById('supportFileInput');
            const dt = new DataTransfer();

            Array.from(fileInput.files).forEach((file, i) => {
                if (i !== index) dt.items.add(file);
            });

            fileInput.files = dt.files;
            displaySupportFiles();
        }

        // Submit support request
        function submitSupportRequest(event) {
            event.preventDefault();

            // Get form data
            const supportType = document.querySelector('input[name="supportType"]:checked').value;
            const machineType = document.getElementById('supportMachineType').value;
            const machineId = document.getElementById('supportMachineId').value;
            const runningHours = document.getElementById('supportRunningHours').value;
            const volume = document.getElementById('supportVolume').value;
            const description = document.getElementById('supportDescription').value;
            const priority = document.getElementById('supportPriority').value;
            const preferredDate = document.getElementById('supportPreferredDate').value;
            const files = document.getElementById('supportFileInput').files;

            // Create request object
            const request = {
                id: 'SR-' + String(supportRequestCounter++).padStart(4, '0'),
                supportType: supportType,
                machineType: machineType,
                machineId: machineId || 'N/A',
                runningHours: runningHours || '0',
                volume: volume || '0',
                description: description,
                priority: priority,
                preferredDate: preferredDate || 'Not specified',
                files: Array.from(files).map(f => f.name),
                status: 'pending',
                createdAt: new Date().toLocaleString(),
                quote: null,
                chat: []
            };

            // Add to requests array
            supportRequests.unshift(request);

            // Show success message
            alert('‚úÖ Service request submitted successfully!\n\nRequest ID: ' + request.id + '\n\nOptirva will review your request and provide a quote shortly.');

            // Reset form
            document.getElementById('supportRequestForm').reset();
            document.getElementById('supportAttachedFiles').innerHTML = '';
            document.querySelectorAll('.support-type-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Reload requests list
            loadSupportRequestsList();
        }

        // Load support requests list
        function loadSupportRequestsList() {
            const container = document.getElementById('supportRequestsList');

            if (supportRequests.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #898491;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
                        <p>No service requests yet</p>
                        <p style="font-size: 13px;">Submit a request to get started</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = supportRequests.map(request => {
                const supportTypeIcons = {
                    'remote': 'üåê',
                    'onsite': 'üë®‚Äçüîß',
                    'tpms': '‚öôÔ∏è'
                };
                const supportTypeNames = {
                    'remote': 'Remote Support',
                    'onsite': 'On-Site Support',
                    'tpms': 'TPMS Service'
                };
                const priorityIcons = {
                    'low': 'üü¢',
                    'medium': 'üü°',
                    'high': 'üü†',
                    'critical': 'üî¥'
                };

                return `
                    <div class="request-card" onclick="viewSupportRequest('${request.id}')">
                        <div class="request-header">
                            <span class="request-id">${request.id}</span>
                            <span class="request-status ${request.status}">${request.status.toUpperCase()}</span>
                        </div>
                        <div class="request-title">
                            ${supportTypeIcons[request.supportType]} ${supportTypeNames[request.supportType]} - ${request.machineType}
                        </div>
                        <div class="request-meta">
                            <span class="request-meta-item">${priorityIcons[request.priority]} ${request.priority.toUpperCase()}</span>
                            <span class="request-meta-item">üìÖ ${request.createdAt}</span>
                            ${request.quote ? `<span class="request-meta-item">üí∞ $${request.quote.total.toFixed(2)}</span>` : ''}
                            ${request.chat.length > 0 ? `<span class="request-meta-item">üí¨ ${request.chat.length}</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // View support request details
        function viewSupportRequest(requestId) {
            const request = supportRequests.find(r => r.id === requestId);
            if (!request) return;

            currentSupportRequestId = requestId;

            const supportTypeNames = {
                'remote': 'Remote Support',
                'onsite': 'On-Site Support',
                'tpms': 'TPMS Service'
            };

            // Set title
            document.getElementById('supportDetailTitle').textContent = request.id + ' - Service Request';
            document.getElementById('supportDetailSubtitle').textContent = supportTypeNames[request.supportType] + ' ‚Ä¢ ' + request.createdAt;

            // Build request details
            const detailsHTML = `
                <div class="detail-section">
                    <h4>REQUEST INFORMATION</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Support Type</div>
                            <div class="detail-value">${supportTypeNames[request.supportType]}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Priority</div>
                            <div class="detail-value">${request.priority.toUpperCase()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Status</div>
                            <div class="detail-value">${request.status.toUpperCase()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Preferred Date</div>
                            <div class="detail-value">${request.preferredDate}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>MACHINE DETAILS</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Machine Type</div>
                            <div class="detail-value">${request.machineType}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Machine ID</div>
                            <div class="detail-value">${request.machineId}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Running Hours</div>
                            <div class="detail-value">${request.runningHours} hrs</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Volume</div>
                            <div class="detail-value">${request.volume} units/day</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>ISSUE DESCRIPTION</h4>
                    <div style="background: #F8F9FF; padding: 16px; border-radius: 8px; line-height: 1.6;">
                        ${request.description}
                    </div>
                </div>

                ${request.files.length > 0 ? `
                    <div class="detail-section">
                        <h4>ATTACHMENTS</h4>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            ${request.files.map(file => `
                                <span style="background: #F8F9FF; padding: 8px 12px; border-radius: 6px; font-size: 13px;">
                                    üìé ${file}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;

            document.getElementById('supportDetailBody').innerHTML = detailsHTML;

            // Show/hide quote form or display
            if (request.quote) {
                document.getElementById('quoteForm').style.display = 'none';
                document.getElementById('quoteDisplay').style.display = 'block';
                displayQuote(request);
            } else {
                document.getElementById('quoteForm').style.display = 'block';
                document.getElementById('quoteDisplay').style.display = 'none';
                // Clear quote form and validation
                const engineersField = document.getElementById('quoteEngineers');
                const hoursField = document.getElementById('quoteHours');
                const rateField = document.getElementById('quoteHourRate');

                engineersField.value = '';
                hoursField.value = '';
                rateField.value = '';
                document.getElementById('quoteTotal').value = '$0.00';
                document.getElementById('quoteNotes').value = '';
                document.getElementById('calculationFormula').textContent = 'Fill in all fields to calculate';
                document.getElementById('quoteValidationMessage').style.display = 'none';

                // Remove validation classes
                engineersField.classList.remove('valid', 'invalid');
                hoursField.classList.remove('valid', 'invalid');
                rateField.classList.remove('valid', 'invalid');
            }

            // Load chat
            loadSupportChat();

            // Show modal
            document.getElementById('supportDetailModal').style.display = 'flex';
        }

        // Calculate quote
        // Validate quote field
        function validateQuoteField(field) {
            const value = field.value.trim();

            if (!value || parseFloat(value) <= 0) {
                field.classList.remove('valid');
                field.classList.add('invalid');
            } else {
                field.classList.remove('invalid');
                field.classList.add('valid');
            }
        }

        // Calculate quote with hours
        function calculateQuote() {
            const engineers = parseFloat(document.getElementById('quoteEngineers').value) || 0;
            const hours = parseFloat(document.getElementById('quoteHours').value) || 0;
            const hourRate = parseFloat(document.getElementById('quoteHourRate').value) || 0;

            // Calculate total: Engineers √ó Hours √ó Hour Rate
            const total = engineers * hours * hourRate;

            // Update total price field
            const totalField = document.getElementById('quoteTotal');
            if (total > 0) {
                totalField.value = '$' + total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                // Show calculation formula
                const formulaElement = document.getElementById('calculationFormula');
                formulaElement.textContent = `${engineers} engineer(s) √ó ${hours} hour(s) √ó $${hourRate.toFixed(2)}/hr = $${total.toFixed(2)}`;
            } else {
                totalField.value = '$0.00';
                document.getElementById('calculationFormula').textContent = 'Fill in all fields to calculate';
            }
        }

        // Submit quote with validation
        function submitQuote() {
            const engineers = parseFloat(document.getElementById('quoteEngineers').value);
            const hours = parseFloat(document.getElementById('quoteHours').value);
            const hourRate = parseFloat(document.getElementById('quoteHourRate').value);
            const notes = document.getElementById('quoteNotes').value;

            // Validate all required fields
            const validationMessage = document.getElementById('quoteValidationMessage');
            const missingFields = [];

            if (!engineers || engineers <= 0) {
                missingFields.push('Number of Engineers');
                document.getElementById('quoteEngineers').classList.add('invalid');
            }
            if (!hours || hours <= 0) {
                missingFields.push('Number of Hours');
                document.getElementById('quoteHours').classList.add('invalid');
            }
            if (!hourRate || hourRate <= 0) {
                missingFields.push('Hour Rate');
                document.getElementById('quoteHourRate').classList.add('invalid');
            }

            if (missingFields.length > 0) {
                validationMessage.textContent = 'Please fill in all required fields: ' + missingFields.join(', ');
                validationMessage.style.display = 'flex';

                // Scroll to validation message
                validationMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });

                return;
            }

            // Hide validation message
            validationMessage.style.display = 'none';

            const total = engineers * hours * hourRate;

            const request = supportRequests.find(r => r.id === currentSupportRequestId);
            if (!request) return;

            request.quote = {
                engineers: engineers,
                hours: hours,
                hourRate: hourRate,
                total: total,
                notes: notes,
                submittedAt: new Date().toLocaleString()
            };

            request.status = 'quoted';

            // Add system message to chat
            request.chat.push({
                sender: 'Optirva System',
                message: `üíº Quote submitted: ${engineers} engineer(s) √ó ${hours} hour(s) √ó $${hourRate.toFixed(2)}/hr = $${total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`,
                timestamp: new Date().toLocaleTimeString(),
                type: 'system'
            });

            alert('‚úÖ Quote sent to customer successfully!\n\nTotal: $' + total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));

            // Refresh display
            viewSupportRequest(currentSupportRequestId);
            loadSupportRequestsList();
        }

        // Display quote
        function displayQuote(request) {
            const quote = request.quote;
            const html = `
                <div class="quote-summary">
                    <div class="quote-item">
                        <div class="quote-item-label">Engineers</div>
                        <div class="quote-item-value">${quote.engineers}</div>
                    </div>
                    <div class="quote-item">
                        <div class="quote-item-label">Total Hours</div>
                        <div class="quote-item-value">${quote.hours} hrs</div>
                    </div>
                    <div class="quote-item">
                        <div class="quote-item-label">Hour Rate</div>
                        <div class="quote-item-value">$${quote.hourRate.toFixed(2)}/hr</div>
                    </div>
                    <div class="quote-item">
                        <div class="quote-item-label">Total Cost</div>
                        <div class="quote-item-value" style="color: #6A57FF; font-size: 24px;">$${quote.total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                    </div>
                </div>

                <div style="background: #F8F9FF; padding: 16px; border-radius: 8px; margin-top: 16px; border-left: 4px solid #6A57FF;">
                    <div style="font-size: 12px; color: #898491; margin-bottom: 8px;">CALCULATION</div>
                    <div style="font-weight: 600; color: #6A57FF; font-size: 16px;">
                        ${quote.engineers} engineer(s) √ó ${quote.hours} hour(s) √ó $${quote.hourRate.toFixed(2)}/hr = $${quote.total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                    </div>
                </div>

                ${quote.notes ? `
                    <div style="background: #F8F9FF; padding: 16px; border-radius: 8px; margin-top: 16px;">
                        <div style="font-size: 12px; color: #898491; margin-bottom: 8px;">üìù ADDITIONAL NOTES / TERMS</div>
                        <div style="line-height: 1.6;">${quote.notes}</div>
                    </div>
                ` : ''}

                <div class="quote-total">
                    <div class="quote-total-label">TOTAL SERVICE COST</div>
                    <div class="quote-total-value">$${quote.total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                </div>

                ${request.supportType === 'remote' ? `
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="startRemoteSupportSession('${request.id}'); closeSupportDetail();" class="submit-btn" style="background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); width: 100%; font-size: 18px; padding: 16px; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
                            üñ•Ô∏è Start Remote Support Session
                        </button>
                        <p style="font-size: 12px; color: #898491; margin-top: 8px;">
                            Start timer-based remote support with real-time cost tracking
                        </p>
                    </div>
                ` : ''}

                <div style="text-align: center; margin-top: 16px;">
                    <span class="quote-status">‚úì Quote Submitted on ${quote.submittedAt}</span>
                </div>
            `;

            document.getElementById('quoteDisplay').innerHTML = html;
        }

        // Load support chat
        function loadSupportChat() {
            const request = supportRequests.find(r => r.id === currentSupportRequestId);
            if (!request) return;

            const container = document.getElementById('supportChatMessages');

            if (request.chat.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #898491;">
                        <p>No messages yet</p>
                        <p style="font-size: 12px;">Start a conversation with the customer</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = request.chat.map(msg => {
                const isOptirva = msg.sender.toLowerCase().includes('optirva') || msg.type === 'system';
                return `
                    <div class="chat-message ${isOptirva ? 'optirva' : 'customer'}">
                        <div class="chat-message-header">
                            <span class="chat-message-sender">${msg.sender}</span>
                            <span>${msg.timestamp}</span>
                        </div>
                        <div class="chat-message-text">${msg.message}</div>
                    </div>
                `;
            }).join('');

            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        // Send support chat message
        function sendSupportChat() {
            const input = document.getElementById('supportChatInput');
            const message = input.value.trim();

            if (!message) return;

            const request = supportRequests.find(r => r.id === currentSupportRequestId);
            if (!request) return;

            // Add message to request
            request.chat.push({
                sender: 'Optirva Support',
                message: message,
                timestamp: new Date().toLocaleTimeString(),
                type: 'optirva'
            });

            // Reload chat
            loadSupportChat();

            // Clear input
            input.value = '';

            // Reload requests list to update comment count
            loadSupportRequestsList();
        }

        // Close support detail modal
        function closeSupportDetail() {
            document.getElementById('supportDetailModal').style.display = 'none';
            currentSupportRequestId = null;
        }

        // Enable Enter key for support chat
        document.addEventListener('DOMContentLoaded', function() {
            const supportChatInput = document.getElementById('supportChatInput');
            if (supportChatInput) {
                supportChatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendSupportChat();
                    }
                });
            }
        });

        // ==================== MACHINE MARKETPLACE FUNCTIONS ====================

        // Machine listings storage
        let machineListings = [];
        let currentMachineListingId = null;
        let machineListingCounter = 1;

        // Display marketplace files
        function displayMarketplaceFiles() {
            const fileInput = document.getElementById('marketplaceFiles');
            const container = document.getElementById('marketplaceAttachedFiles');

            container.innerHTML = '';
            Array.from(fileInput.files).forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'attached-file';
                fileDiv.innerHTML = `
                    <span>${file.name}</span>
                    <span class="remove-file" onclick="removeMarketplaceFile(${index})">√ó</span>
                `;
                container.appendChild(fileDiv);
            });
        }

        // Remove marketplace file
        function removeMarketplaceFile(index) {
            const fileInput = document.getElementById('marketplaceFiles');
            const dt = new DataTransfer();

            Array.from(fileInput.files).forEach((file, i) => {
                if (i !== index) dt.items.add(file);
            });

            fileInput.files = dt.files;
            displayMarketplaceFiles();
        }

        // Submit machine listing
        function submitMachineListing(event) {
            event.preventDefault();

            const listing = {
                id: 'ML-' + String(machineListingCounter++).padStart(4, '0'),
                machineType: document.getElementById('marketplaceMachineType').value,
                model: document.getElementById('marketplaceMachineModel').value,
                packageVolume: document.getElementById('marketplacePackageVolume').value || 'Not Applicable',
                year: document.getElementById('marketplaceYear').value || 'N/A',
                runningHours: document.getElementById('marketplaceRunningHours').value,
                condition: document.getElementById('marketplaceCondition').value,
                serviceStatus: document.getElementById('marketplaceServiceStatus').value,
                tetrapakService: document.querySelector('input[name="tetrapakService"]:checked').value,
                price: parseFloat(document.getElementById('marketplacePrice').value),
                description: document.getElementById('marketplaceDescription').value,
                location: document.getElementById('marketplaceLocation').value || 'Not specified',
                contact: document.getElementById('marketplaceContact').value || 'Anonymous Seller',
                files: Array.from(document.getElementById('marketplaceFiles').files).map(f => f.name),
                listedAt: new Date().toLocaleString(),
                chat: []
            };

            machineListings.unshift(listing);

            alert('‚úÖ Machine listed successfully!\n\nListing ID: ' + listing.id + '\n\nYour machine is now visible to buyers on the marketplace.');

            // Reset form
            document.getElementById('machineListingForm').reset();
            document.getElementById('marketplaceAttachedFiles').innerHTML = '';

            // Reload listings
            loadMarketplaceListings();
        }

        // Load marketplace listings
        function loadMarketplaceListings() {
            const container = document.getElementById('machineListingsList');
            const countElement = document.getElementById('machineListingsCount');

            if (machineListings.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #898491; grid-column: 1 / -1;">
                        <div style="font-size: 64px; margin-bottom: 16px;">üè™</div>
                        <h3>No machines listed yet</h3>
                        <p style="font-size: 14px;">Be the first to list a machine for sale!</p>
                    </div>
                `;
                countElement.textContent = '0';
                return;
            }

            countElement.textContent = machineListings.length;

            container.innerHTML = machineListings.map(listing => {
                const conditionClass = listing.condition.toLowerCase().replace(' ', '-');
                return `
                    <div class="machine-listing-card" onclick="viewMachineDetail('${listing.id}')">
                        <div class="machine-listing-header">
                            <span class="machine-type-badge">${listing.machineType}</span>
                            <span class="machine-condition-badge ${conditionClass}">${listing.condition}</span>
                        </div>
                        <div class="machine-listing-title">${listing.machineType}</div>
                        <div class="machine-listing-model">${listing.model}</div>
                        ${listing.packageVolume && listing.packageVolume !== 'Not Applicable' ? `<div style="font-size: 13px; color: #6A57FF; font-weight: 600; margin-top: 4px;">üì¶ ${listing.packageVolume}</div>` : ''}
                        <div class="machine-listing-specs">
                            <div class="spec-item">‚è±Ô∏è Hours: <span class="spec-value">${parseInt(listing.runningHours).toLocaleString()}</span></div>
                            <div class="spec-item">üìÖ Year: <span class="spec-value">${listing.year}</span></div>
                            <div class="spec-item">üîß Service: <span class="spec-value">${listing.serviceStatus.replace('‚úÖ ', '').replace('‚ö†Ô∏è ', '').replace('‚ùå ', '').replace('‚ùì ', '')}</span></div>
                            <div class="spec-item">üìç Location: <span class="spec-value">${listing.location}</span></div>
                        </div>
                        ${listing.tetrapakService === 'Yes' ? '<div class="tetrapak-badge">‚úÖ Tetrapak Service</div>' : ''}
                        <div class="machine-listing-price">$${listing.price.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</div>
                    </div>
                `;
            }).join('');
        }

        // View machine detail
        function viewMachineDetail(listingId) {
            const listing = machineListings.find(l => l.id === listingId);
            if (!listing) return;

            currentMachineListingId = listingId;

            document.getElementById('machineDetailTitle').textContent = listing.machineType;
            document.getElementById('machineDetailSubtitle').textContent = listing.model + ' ‚Ä¢ ' + listing.id;

            const detailsHTML = `
                <div class="price-highlight">
                    <div class="price-highlight-label">ASKING PRICE</div>
                    <div class="price-highlight-value">$${listing.price.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</div>
                </div>

                <div class="machine-detail-grid">
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Machine Type</div>
                        <div class="machine-detail-value">${listing.machineType}</div>
                    </div>
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Model</div>
                        <div class="machine-detail-value">${listing.model}</div>
                    </div>
                    ${listing.packageVolume && listing.packageVolume !== 'Not Applicable' ? `
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Package Volume</div>
                        <div class="machine-detail-value" style="color: #6A57FF; font-weight: 600;">üì¶ ${listing.packageVolume}</div>
                    </div>
                    ` : ''}
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Year</div>
                        <div class="machine-detail-value">${listing.year}</div>
                    </div>
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Running Hours</div>
                        <div class="machine-detail-value">${parseInt(listing.runningHours).toLocaleString()} hrs</div>
                    </div>
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Condition</div>
                        <div class="machine-detail-value">${listing.condition}</div>
                    </div>
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Service Status</div>
                        <div class="machine-detail-value">${listing.serviceStatus}</div>
                    </div>
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Tetrapak Service</div>
                        <div class="machine-detail-value">${listing.tetrapakService}</div>
                    </div>
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Location</div>
                        <div class="machine-detail-value">${listing.location}</div>
                    </div>
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Seller Contact</div>
                        <div class="machine-detail-value">${listing.contact}</div>
                    </div>
                    <div class="machine-detail-item">
                        <div class="machine-detail-label">Listed Date</div>
                        <div class="machine-detail-value">${listing.listedAt}</div>
                    </div>
                </div>

                <div style="margin: 24px 0;">
                    <h4 style="margin-bottom: 12px; color: #6A57FF;">üìù DESCRIPTION</h4>
                    <div style="background: #F8F9FF; padding: 16px; border-radius: 8px; line-height: 1.6;">
                        ${listing.description}
                    </div>
                </div>

                ${listing.files.length > 0 ? `
                    <div style="margin: 24px 0;">
                        <h4 style="margin-bottom: 12px; color: #6A57FF;">üì∏ PHOTOS & VIDEOS (${listing.files.length})</h4>
                        <div class="machine-photos-grid">
                            ${listing.files.map(file => `
                                <div class="machine-photo">üì∑</div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;

            document.getElementById('machineDetailBody').innerHTML = detailsHTML;

            // Load negotiation chat
            loadNegotiationChat();

            // Show modal
            document.getElementById('machineDetailModal').style.display = 'flex';
        }

        // Load negotiation chat
        function loadNegotiationChat() {
            const listing = machineListings.find(l => l.id === currentMachineListingId);
            if (!listing) return;

            const container = document.getElementById('negotiationChatMessages');

            if (listing.chat.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #898491;">
                        <p>üí¨ No messages yet</p>
                        <p style="font-size: 12px;">Start negotiating the price with the seller</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = listing.chat.map(msg => {
                const isSeller = msg.type === 'seller';
                return `
                    <div class="negotiation-message ${msg.type}">
                        <div class="negotiation-message-header">
                            <span class="negotiation-message-sender">${msg.sender}</span>
                            <span>${msg.timestamp}</span>
                        </div>
                        <div class="negotiation-message-text">${msg.message}</div>
                    </div>
                `;
            }).join('');

            container.scrollTop = container.scrollHeight;
        }

        // Send negotiation chat
        function sendNegotiationChat() {
            const input = document.getElementById('negotiationChatInput');
            const message = input.value.trim();

            if (!message) return;

            const listing = machineListings.find(l => l.id === currentMachineListingId);
            if (!listing) return;

            listing.chat.push({
                sender: 'Buyer',
                message: message,
                timestamp: new Date().toLocaleTimeString(),
                type: 'buyer'
            });

            loadNegotiationChat();
            input.value = '';
        }

        // Close machine detail
        function closeMachineDetail() {
            document.getElementById('machineDetailModal').style.display = 'none';
            currentMachineListingId = null;
        }

        // Filter marketplace
        function filterMarketplace() {
            const filterType = document.getElementById('filterMachineType').value;
            // Simple filter implementation
            loadMarketplaceListings();
        }

        // Switch marketplace role (Supplier/Customer)
        function switchMarketplaceRole(role) {
            // Update button active states
            document.getElementById('supplierRoleBtn').classList.remove('active');
            document.getElementById('customerRoleBtn').classList.remove('active');

            if (role === 'supplier') {
                document.getElementById('supplierRoleBtn').classList.add('active');
                document.getElementById('customerSearchSection').style.display = 'none';
                document.getElementById('supplierFormSection').style.display = 'block';
            } else if (role === 'customer') {
                document.getElementById('customerRoleBtn').classList.add('active');
                document.getElementById('customerSearchSection').style.display = 'block';
                document.getElementById('supplierFormSection').style.display = 'none';
            }
        }

        // Perform marketplace search
        function performMarketplaceSearch() {
            const searchMachineType = document.getElementById('searchMachineType').value;
            const searchPackageVolume = document.getElementById('searchPackageVolume').value;
            const searchPriceRange = document.getElementById('searchPriceRange').value;
            const searchCondition = document.getElementById('searchCondition').value;

            // Filter the listings based on search criteria
            let filteredListings = [...machineListings];

            // Filter by machine type
            if (searchMachineType) {
                filteredListings = filteredListings.filter(listing =>
                    listing.machineType === searchMachineType
                );
            }

            // Filter by package volume
            if (searchPackageVolume) {
                filteredListings = filteredListings.filter(listing =>
                    listing.packageVolume === searchPackageVolume
                );
            }

            // Filter by price range
            if (searchPriceRange) {
                const [min, max] = searchPriceRange.split('-').map(v => parseInt(v));
                filteredListings = filteredListings.filter(listing => {
                    if (max) {
                        return listing.price >= min && listing.price <= max;
                    } else {
                        return listing.price >= min;
                    }
                });
            }

            // Filter by condition
            if (searchCondition) {
                filteredListings = filteredListings.filter(listing =>
                    listing.condition === searchCondition
                );
            }

            // Display filtered results
            const container = document.getElementById('machineListingsList');
            const countElement = document.getElementById('machineListingsCount');

            if (filteredListings.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #898491; grid-column: 1 / -1;">
                        <div style="font-size: 64px; margin-bottom: 16px;">üîç</div>
                        <h3>No machines found</h3>
                        <p style="font-size: 14px;">Try adjusting your search filters</p>
                        <button onclick="resetMarketplaceSearch()" style="margin-top: 16px; padding: 12px 24px; background: #6A57FF; color: white; border: none; border-radius: 8px; cursor: pointer;">Reset Search</button>
                    </div>
                `;
                countElement.textContent = '0';
                return;
            }

            countElement.textContent = filteredListings.length;

            container.innerHTML = filteredListings.map(listing => {
                const conditionClass = listing.condition.toLowerCase().replace(' ', '-');
                return `
                    <div class="machine-listing-card" onclick="viewMachineDetail('${listing.id}')">
                        <div class="machine-listing-header">
                            <span class="machine-type-badge">${listing.machineType}</span>
                            <span class="machine-condition-badge ${conditionClass}">${listing.condition}</span>
                        </div>
                        <div class="machine-listing-title">${listing.machineType}</div>
                        <div class="machine-listing-model">${listing.model}</div>
                        ${listing.packageVolume && listing.packageVolume !== 'Not Applicable' ? `<div style="font-size: 13px; color: #6A57FF; font-weight: 600; margin-top: 4px;">üì¶ ${listing.packageVolume}</div>` : ''}
                        <div class="machine-listing-specs">
                            <div class="spec-item">‚è±Ô∏è Hours: <span class="spec-value">${parseInt(listing.runningHours).toLocaleString()}</span></div>
                            <div class="spec-item">üìÖ Year: <span class="spec-value">${listing.year}</span></div>
                            <div class="spec-item">üîß Service: <span class="spec-value">${listing.serviceStatus.replace('‚úÖ ', '').replace('‚ö†Ô∏è ', '').replace('‚ùå ', '').replace('‚ùì ', '')}</span></div>
                            <div class="spec-item">üìç Location: <span class="spec-value">${listing.location}</span></div>
                        </div>
                        ${listing.tetrapakService === 'Yes' ? '<div class="tetrapak-badge">‚úÖ Tetrapak Service</div>' : ''}
                        <div class="machine-listing-price">$${listing.price.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</div>
                    </div>
                `;
            }).join('');

            // Scroll to results
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Reset marketplace search
        function resetMarketplaceSearch() {
            document.getElementById('searchMachineType').value = '';
            document.getElementById('searchPackageVolume').value = '';
            document.getElementById('searchPriceRange').value = '';
            document.getElementById('searchCondition').value = '';
            loadMarketplaceListings();
        }

        // Remote Support Timer Functions
        let timerInterval = null;
        let timerSeconds = 7200; // Start at 2 hours (minimum)
        let timerRunning = false;
        let sessionStartTime = null;
        let currentSessionData = null;
        const MINIMUM_HOURS = 2;
        const MINIMUM_SECONDS = 7200; // 2 hours in seconds

        // Start remote support session
        function startRemoteSupportSession(requestId) {
            const request = supportRequests.find(r => r.id === requestId);
            if (!request) return;

            currentSessionData = {
                requestId: request.id,
                customer: 'Customer Name', // In real app, get from user data
                machineType: request.machineType,
                machineId: request.machineId,
                priority: request.priority,
                hourlyRate: request.quote ? parseFloat(request.quote.hourlyRate) : 75.00,
                startTime: null,
                notes: ''
            };

            // Populate session info
            document.getElementById('timerRequestId').textContent = 'Request ID: ' + request.id;
            document.getElementById('sessionCustomer').textContent = currentSessionData.customer;
            document.getElementById('sessionMachineType').textContent = request.machineType;
            document.getElementById('sessionMachineId').textContent = request.machineId || 'N/A';
            document.getElementById('sessionPriority').textContent = request.priority;
            document.getElementById('displayHourlyRate').textContent = '$' + currentSessionData.hourlyRate.toFixed(2) + '/hr';

            // Calculate minimum charge
            const minimumCharge = currentSessionData.hourlyRate * MINIMUM_HOURS;
            document.getElementById('displayMinimumCharge').textContent = '$' + minimumCharge.toFixed(2);
            document.getElementById('displayTotalCost').textContent = '$' + minimumCharge.toFixed(2);

            // Reset timer to 2 hours
            timerSeconds = MINIMUM_SECONDS;
            updateTimerDisplay();

            // Show timer screen
            showScreen('remoteSupportTimerScreen');
        }

        // Start timer
        function startTimer() {
            if (timerRunning) return;

            timerRunning = true;
            sessionStartTime = sessionStartTime || new Date();

            // Update session start time display
            document.getElementById('sessionStartTime').textContent = sessionStartTime.toLocaleTimeString();

            // Update button states
            document.getElementById('startTimerBtn').disabled = true;
            document.getElementById('pauseTimerBtn').disabled = false;
            document.getElementById('stopTimerBtn').disabled = false;

            // Update status
            const statusEl = document.getElementById('timerStatus');
            statusEl.textContent = '‚ñ∂Ô∏è Running';
            statusEl.className = 'timer-status running';

            // Add running animation to timer display
            document.getElementById('timerDisplay').classList.add('running');

            // Start interval
            timerInterval = setInterval(function() {
                timerSeconds++;
                updateTimerDisplay();
                calculateSessionCost();
            }, 1000);
        }

        // Pause timer
        function pauseTimer() {
            if (!timerRunning) return;

            timerRunning = false;
            clearInterval(timerInterval);

            // Update button states
            document.getElementById('startTimerBtn').disabled = false;
            document.getElementById('pauseTimerBtn').disabled = true;

            // Update status
            const statusEl = document.getElementById('timerStatus');
            statusEl.textContent = '‚è∏Ô∏è Paused';
            statusEl.className = 'timer-status paused';

            // Remove running animation
            document.getElementById('timerDisplay').classList.remove('running');
        }

        // Stop timer
        function stopTimer() {
            if (confirm('‚ö†Ô∏è Are you sure you want to stop this support session?\n\nThis will finalize the session and calculate the final cost.')) {
                timerRunning = false;
                clearInterval(timerInterval);

                // Update button states
                document.getElementById('startTimerBtn').disabled = true;
                document.getElementById('pauseTimerBtn').disabled = true;
                document.getElementById('stopTimerBtn').disabled = true;

                // Update status
                const statusEl = document.getElementById('timerStatus');
                statusEl.textContent = '‚èπÔ∏è Stopped';
                statusEl.className = 'timer-status stopped';

                // Remove running animation
                document.getElementById('timerDisplay').classList.remove('running');

                // Calculate final cost
                calculateSessionCost();

                // Show completion message
                const totalCost = document.getElementById('displayTotalCost').textContent;
                alert('‚úÖ Support Session Completed!\n\n' +
                    'Total Duration: ' + formatTime(timerSeconds) + '\n' +
                    'Total Cost: ' + totalCost + '\n\n' +
                    'Session details have been saved.');
            }
        }

        // Update timer display
        function updateTimerDisplay() {
            const hours = Math.floor(timerSeconds / 3600);
            const minutes = Math.floor((timerSeconds % 3600) / 60);
            const seconds = timerSeconds % 60;

            const display =
                String(hours).padStart(2, '0') + ':' +
                String(minutes).padStart(2, '0') + ':' +
                String(seconds).padStart(2, '0');

            document.getElementById('timerDisplay').textContent = display;
        }

        // Calculate session cost
        function calculateSessionCost() {
            if (!currentSessionData) return;

            const hourlyRate = currentSessionData.hourlyRate;
            const hours = timerSeconds / 3600;
            const minimumHours = MINIMUM_HOURS;

            // Calculate elapsed time display
            const elapsedHours = Math.floor(timerSeconds / 3600);
            const elapsedMinutes = Math.floor((timerSeconds % 3600) / 60);
            document.getElementById('displayElapsedTime').textContent =
                elapsedHours + ' hrs ' + elapsedMinutes + ' mins';

            // Calculate cost (minimum 2 hours)
            const billableHours = Math.max(hours, minimumHours);
            const totalCost = billableHours * hourlyRate;

            document.getElementById('displayTotalCost').textContent = '$' + totalCost.toFixed(2);
        }

        // Format time for display
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return hours + 'h ' + minutes + 'm';
        }

        // Save session notes
        function saveSessionNotes() {
            const notes = document.getElementById('sessionNotes').value.trim();
            if (notes) {
                if (currentSessionData) {
                    currentSessionData.notes = notes;
                }
                alert('‚úÖ Session notes saved successfully!');
            } else {
                alert('‚ö†Ô∏è Please enter some notes before saving.');
            }
        }

        // Enable Enter key for negotiation chat
        document.addEventListener('DOMContentLoaded', function() {
            const negChatInput = document.getElementById('negotiationChatInput');
            if (negChatInput) {
                negChatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendNegotiationChat();
                    }
                });
            }
        });

        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            updateStatistics(); // Initialize statistics on page load
            updateCurrentUserProfile(); // Update current user profile
        });
    </script>
</body>
</html>